"use strict";(self.webpackChunksalaDeJuegos=self.webpackChunksalaDeJuegos||[]).push([[333],{14:(Gu,Nr,$)=>{$.d(Nr,{nm:()=>Te});var I=$(2793);$(5879),$(4097);var B,yn,tr,vn,fi,jt=$(5861),Ot=$(4303),fe=$(4537),mn=$(9058),ht=$(7879);const ne=new Map,pe={activated:!1,tokenObservers:[]},ue={initialized:!1,enabled:!1};function J(T){return ne.get(T)||Object.assign({},pe)}function ot(){return ue}const Me="https://content-firebaseappcheck.googleapis.com/v1",pi="exchangeDebugToken",an={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class It{constructor(w,C,R,L,W){if(this.operation=w,this.retryPolicy=C,this.getWaitDuration=R,this.lowerBound=L,this.upperBound=W,this.pending=null,this.nextErrorWaitInterval=L,L>W)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(w){var C=this;return(0,jt.Z)(function*(){C.stop();try{C.pending=new mn.BH,yield function en(T){return new Promise(w=>{setTimeout(w,T)})}(C.getNextRun(w)),C.pending.resolve(),yield C.pending.promise,C.pending=new mn.BH,yield C.operation(),C.pending.resolve(),yield C.pending.promise,C.process(!0).catch(()=>{})}catch(R){C.retryPolicy(R)?C.process(!1).catch(()=>{}):C.stop()}})()}getNextRun(w){if(w)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const C=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),C}}}const be=new mn.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function un(T){if(!J(T).activated)throw be.create("use-before-activation",{appName:T.name})}function kt(T,w){return(B=B||(0,jt.Z)(function*({url:C,body:R},L){const W={"Content-Type":"application/json"},ce=L.getImmediate({optional:!0});if(ce){const Pe=yield ce.getHeartbeatsHeader();Pe&&(W["X-Firebase-Client"]=Pe)}const Ne={method:"POST",body:JSON.stringify(R),headers:W};let ze,le;try{ze=yield fetch(C,Ne)}catch(Pe){throw be.create("fetch-network-error",{originalErrorMessage:Pe?.message})}if(200!==ze.status)throw be.create("fetch-status-error",{httpStatus:ze.status});try{le=yield ze.json()}catch(Pe){throw be.create("fetch-parse-error",{originalErrorMessage:Pe?.message})}const ft=le.ttl.match(/^([\d.]+)(s)$/);if(!ft||!ft[2]||isNaN(Number(ft[1])))throw be.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${le.ttl}`});const Lt=1e3*Number(ft[1]),Ci=Date.now();return{token:le.token,expireTimeMillis:Ci+Lt,issuedAtTimeMillis:Ci}})).apply(this,arguments)}function Rr(T,w){const{projectId:C,appId:R,apiKey:L}=T.options;return{url:`${Me}/projects/${C}/apps/${R}:${pi}?key=${L}`,body:{debug_token:w}}}const mi="firebase-app-check-database",yi=1,In="firebase-app-check-store";let Dr=null;function ir(T,w){return(yn=yn||(0,jt.Z)(function*(C,R){const W=(yield function Mn(){return Dr||(Dr=new Promise((T,w)=>{try{const C=indexedDB.open(mi,yi);C.onsuccess=R=>{T(R.target.result)},C.onerror=R=>{var L;w(be.create("storage-open",{originalErrorMessage:null===(L=R.target.error)||void 0===L?void 0:L.message}))},C.onupgradeneeded=R=>{0===R.oldVersion&&R.target.result.createObjectStore(In,{keyPath:"compositeKey"})}}catch(C){w(be.create("storage-open",{originalErrorMessage:C?.message}))}}),Dr)}()).transaction(In,"readwrite"),Ne=W.objectStore(In).put({compositeKey:C,value:R});return new Promise((ze,le)=>{Ne.onsuccess=ft=>{ze()},W.onerror=ft=>{var Lt;le(be.create("storage-set",{originalErrorMessage:null===(Lt=ft.target.error)||void 0===Lt?void 0:Lt.message}))}})})).apply(this,arguments)}const Fn=new ht.Yd("@firebase/app-check");function Or(T,w){return(0,mn.hl)()?function rr(T,w){return ir(function hs(T){return`${T.options.appId}-${T.name}`}(T),w)}(T,w).catch(C=>{Fn.warn(`Failed to write token to IndexedDB. Error: ${C}`)}):Promise.resolve()}function sr(){return ot().enabled}function or(){return(tr=tr||(0,jt.Z)(function*(){const T=ot();if(T.enabled&&T.token)return T.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const Ii={error:"UNKNOWN_ERROR"};function fs(T){return mn.US.encodeString(JSON.stringify(T),!1)}function ar(T){return(vn=vn||(0,jt.Z)(function*(w,C=!1){const R=w.app;un(R);const L=J(R);let ce,W=L.token;if(W&&!cn(W)&&(L.token=void 0,W=void 0),!W){const le=yield L.cachedTokenPromise;le&&(cn(le)?W=le:yield Or(R,void 0))}if(!C&&W&&cn(W))return{token:W.token};let ze,Ne=!1;if(sr()){L.exchangeTokenPromise||(L.exchangeTokenPromise=kt(Rr(R,yield or()),w.heartbeatServiceProvider).finally(()=>{L.exchangeTokenPromise=void 0}),Ne=!0);const le=yield L.exchangeTokenPromise;return yield Or(R,le),L.token=le,{token:le.token}}try{L.exchangeTokenPromise||(L.exchangeTokenPromise=L.provider.getToken().finally(()=>{L.exchangeTokenPromise=void 0}),Ne=!0),W=yield J(R).exchangeTokenPromise}catch(le){"appCheck/throttled"===le.code?Fn.warn(le.message):Fn.error(le),ce=le}return W?ce?ze=cn(W)?{token:W.token,internalError:ce}:ys(ce):(ze={token:W.token},L.token=W,yield Or(R,W)):ze=ys(ce),Ne&&function ms(T,w){const C=J(T).tokenObservers;for(const R of C)try{"EXTERNAL"===R.type&&null!=w.error?R.error(w.error):R.next(w)}catch{}}(R,ze),ze})).apply(this,arguments)}function Fr(T,w){const C=J(T),R=C.tokenObservers.filter(L=>L.next!==w);0===R.length&&C.tokenRefresher&&C.tokenRefresher.isRunning()&&C.tokenRefresher.stop(),C.tokenObservers=R}function Ur(T){const{app:w}=T,C=J(w);let R=C.tokenRefresher;R||(R=function gs(T){const{app:w}=T;return new It((0,jt.Z)(function*(){let R;if(R=J(w).token?yield ar(T,!0):yield ar(T),R.error)throw R.error;if(R.internalError)throw R.internalError}),()=>!0,()=>{const C=J(w);if(C.token){let R=C.token.issuedAtTimeMillis+.5*(C.token.expireTimeMillis-C.token.issuedAtTimeMillis)+3e5;return R=Math.min(R,C.token.expireTimeMillis-3e5),Math.max(0,R-Date.now())}return 0},an.RETRIAL_MIN_WAIT,an.RETRIAL_MAX_WAIT)}(T),C.tokenRefresher=R),!R.isRunning()&&C.isTokenAutoRefreshEnabled&&R.start()}function cn(T){return T.expireTimeMillis-Date.now()>0}function ys(T){return{token:fs(Ii),error:T}}class Un{constructor(w,C){this.app=w,this.heartbeatServiceProvider=C}_delete(){const{tokenObservers:w}=J(this.app);for(const C of w)Fr(this.app,C.next);return Promise.resolve()}}const Ei="app-check-internal";!function po(){(0,Ot.Xd)(new fe.wA("app-check",T=>function tt(T,w){return new Un(T,w)}(T.getProvider("app").getImmediate(),T.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((T,w,C)=>{T.getProvider(Ei).initialize()})),(0,Ot.Xd)(new fe.wA(Ei,T=>function ut(T){return{getToken:w=>ar(T,w),getLimitedUseToken:()=>function ps(T){return(fi=fi||(0,jt.Z)(function*(w){const C=w.app;un(C);const{provider:R}=J(C);if(sr()){const L=yield or(),{token:W}=yield kt(Rr(C,L),w.heartbeatServiceProvider);return{token:W}}{const{token:L}=yield R.getToken();return{token:L}}})).apply(this,arguments)}(T),addTokenListener:w=>function Mr(T,w,C,R){const{app:L}=T,W=J(L);if(W.tokenObservers=[...W.tokenObservers,{next:C,error:R,type:w}],W.token&&cn(W.token)){const Ne=W.token;Promise.resolve().then(()=>{C({token:Ne.token}),Ur(T)}).catch(()=>{})}W.cachedTokenPromise.then(()=>Ur(T))}(T,"INTERNAL",w),removeTokenListener:w=>Fr(T.app,w)}}(T.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,Ot.KN)("@firebase/app-check","0.8.0")}();class Te{constructor(){return(0,I.vb)("app-check")}}typeof window<"u"&&window},6796:(Gu,Nr,$)=>{$.d(Nr,{zQ:()=>vn,rT:()=>X,f7:()=>Jt,L6:()=>B,_Q:()=>yn,lh:()=>on,Qv:()=>ht,nw:()=>tr});var I=$(5879),_t=$(8645),O=$(2096),Ge=$(5592),sn=$(2459),Je=$(3019),et=$(3093),it=$(4664),Pn=$(7398),st=$(4552);class We extends _t.x{constructor(me=1/0,ne=1/0,pe=st.l){super(),this._bufferSize=me,this._windowTime=ne,this._timestampProvider=pe,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=ne===1/0,this._bufferSize=Math.max(1,me),this._windowTime=Math.max(1,ne)}next(me){const{isStopped:ne,_buffer:pe,_infiniteTimeWindow:ue,_timestampProvider:J,_windowTime:Re}=this;ne||(pe.push(me),!ue&&pe.push(J.now()+Re)),this._trimBuffer(),super.next(me)}_subscribe(me){this._throwIfClosed(),this._trimBuffer();const ne=this._innerSubscribe(me),{_infiniteTimeWindow:pe,_buffer:ue}=this,J=ue.slice();for(let Re=0;Re<J.length&&!me.closed;Re+=pe?1:2)me.next(J[Re]);return this._checkFinalizedStatuses(me),ne}_trimBuffer(){const{_bufferSize:me,_timestampProvider:ne,_buffer:pe,_infiniteTimeWindow:ue}=this,J=(ue?1:2)*me;if(me<1/0&&J<pe.length&&pe.splice(0,pe.length-J),!ue){const Re=ne.now();let ot=0;for(let Me=1;Me<pe.length&&pe[Me]<=Re;Me+=2)ot=Me;ot&&pe.splice(0,ot+1)}}}var Gt=$(3020);function zt(Ie,me,ne){let pe,ue=!1;return Ie&&"object"==typeof Ie?({bufferSize:pe=1/0,windowTime:me=1/0,refCount:ue=!1,scheduler:ne}=Ie):pe=Ie??1/0,(0,Gt.B)({connector:()=>new We(pe,me,ne),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:ue})}var On=$(1374),gn=$(4674);function hi(Ie,me){return(0,gn.m)(me)?(0,it.w)(()=>Ie,me):(0,it.w)(()=>Ie)}var di=$(5137),cs=$(2181),N=$(2793),$t=$(6304),jt=$(6814),Ot=$(14);$(120);const ht=new I.OlP("angularfire2.auth.use-emulator"),B=new I.OlP("angularfire2.auth.settings"),yn=new I.OlP("angularfire2.auth.tenant-id"),X=new I.OlP("angularfire2.auth.langugage-code"),on=new I.OlP("angularfire2.auth.use-device-language"),Jt=new I.OlP("angularfire.auth.persistence"),tr=(Ie,me,ne,pe,ue,J,Re,ot)=>(0,$t.cc)(`${Ie.name}.auth`,"AngularFireAuth",Ie.name,()=>{const Me=me.runOutsideAngular(()=>Ie.auth());if(ne&&Me.useEmulator(...ne),pe&&(Me.tenantId=pe),Me.languageCode=ue,J&&Me.useDeviceLanguage(),Re)for(const[Ln,Fe]of Object.entries(Re))Me.settings[Ln]=Fe;return ot&&Me.setPersistence(ot),Me},[ne,pe,ue,J,Re,ot]);let vn=(()=>{class Ie{constructor(ne,pe,ue,J,Re,ot,Me,Ln,Fe,pi,an,nr){const It=new _t.x,en=(0,O.of)(void 0).pipe((0,et.Q)(Re.outsideAngular),(0,it.w)(()=>J.runOutsideAngular(()=>Promise.resolve().then($.bind($,8977)))),(0,Pn.U)(()=>(0,$t.on)(ne,J,pe)),(0,Pn.U)(_n=>tr(_n,J,ot,Ln,Fe,pi,Me,an)),zt({bufferSize:1,refCount:!1}));if((0,jt.PM)(ue))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,O.of)(null);else{en.pipe((0,On.P)()).subscribe();const be=en.pipe((0,it.w)(we=>we.getRedirectResult().then(at=>at,()=>null)),N.iC,zt({bufferSize:1,refCount:!1})),wt=en.pipe((0,it.w)(we=>new Ge.y(at=>({unsubscribe:J.runOutsideAngular(()=>we.onAuthStateChanged(kt=>at.next(kt),kt=>at.error(kt),()=>at.complete()))})))),un=en.pipe((0,it.w)(we=>new Ge.y(at=>({unsubscribe:J.runOutsideAngular(()=>we.onIdTokenChanged(kt=>at.next(kt),kt=>at.error(kt),()=>at.complete()))}))));this.authState=be.pipe(hi(wt),(0,di.R)(Re.outsideAngular),(0,et.Q)(Re.insideAngular)),this.user=be.pipe(hi(un),(0,di.R)(Re.outsideAngular),(0,et.Q)(Re.insideAngular)),this.idToken=this.user.pipe((0,it.w)(we=>we?(0,sn.D)(we.getIdToken()):(0,O.of)(null))),this.idTokenResult=this.user.pipe((0,it.w)(we=>we?(0,sn.D)(we.getIdTokenResult()):(0,O.of)(null))),this.credential=(0,Je.T)(be,It,this.authState.pipe((0,cs.h)(we=>!we))).pipe((0,Pn.U)(we=>we?.user?we:null),(0,di.R)(Re.outsideAngular),(0,et.Q)(Re.insideAngular))}return(0,$t.pX)(this,en,J,{spy:{apply:(_n,be,wt)=>{(_n.startsWith("signIn")||_n.startsWith("createUser"))&&wt.then(un=>It.next(un))}}})}}return Ie.\u0275fac=function(ne){return new(ne||Ie)(I.LFG($t.Dh),I.LFG($t.xv,8),I.LFG(I.Lbi),I.LFG(I.R0b),I.LFG(N.HU),I.LFG(ht,8),I.LFG(B,8),I.LFG(yn,8),I.LFG(X,8),I.LFG(on,8),I.LFG(Jt,8),I.LFG(Ot.nm,8))},Ie.\u0275prov=I.Yz7({token:Ie,factory:Ie.\u0275fac,providedIn:"any"}),Ie})()},8022:(Gu,Nr,$)=>{$.d(Nr,{ST:()=>O_});var I=$(5879),_t=$(6321),O=$(5592),Ge=$(2459),sn=$(2096),Je=$(2793),et=$(7921),it=$(9360),Pn=$(8251);function st(){return(0,it.e)((n,e)=>{let t,r=!1;n.subscribe((0,Pn.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var B,We=$(7398),Gt=$(6699),zt=$(3997),On=$(2181),gn=$(6304),hi=$(6814),cs=($(8977),$(3399)),N=$(5861),$t=$(7592),jt=$(4537),Ot=$(7879),fe=$(9058),mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ht={},yn=yn||{},X=mn||self;function on(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Jt(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var vn="closure_uid_"+(1e9*Math.random()>>>0),fi=0;function Ie(n,e,t){return n.call.apply(n.bind,arguments)}function me(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function ne(n,e,t){return(ne=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ie:me).apply(null,arguments)}function pe(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ue(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var u=Array(arguments.length-2),l=2;l<arguments.length;l++)u[l-2]=arguments[l];return e.prototype[i].apply(r,u)}}function J(){this.s=this.s,this.o=this.o}J.prototype.s=!1,J.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function tr(n){Object.prototype.hasOwnProperty.call(n,vn)&&n[vn]||(n[vn]=++fi)}(this)},J.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ot=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Me(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Ln(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(on(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let u=0;u<s;u++)n[i+u]=r[u]}else n.push(r)}}function Fe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Fe.prototype.h=function(){this.defaultPrevented=!0};var pi=function(){if(!X.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{X.addEventListener("test",()=>{},e),X.removeEventListener("test",()=>{},e)}catch{}return n}();function an(n){return/^[\s\xa0]*$/.test(n)}function nr(){var n=X.navigator;return n&&(n=n.userAgent)?n:""}function It(n){return-1!=nr().indexOf(n)}function en(n){return en[" "](n),n}en[" "]=function(){};var gi,n,be=It("Opera"),wt=It("Trident")||It("MSIE"),un=It("Edge"),we=un||wt,at=It("Gecko")&&!(-1!=nr().toLowerCase().indexOf("webkit")&&!It("Edge"))&&!(It("Trident")||It("MSIE"))&&!It("Edge"),kt=-1!=nr().toLowerCase().indexOf("webkit")&&!It("Edge");function ls(){var n=X.document;return n?n.documentMode:void 0}e:{var Rr="",mi=(n=nr(),at?/rv:([^\);]+)(\)|;)/.exec(n):un?/Edge\/([\d\.]+)/.exec(n):wt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):kt?/WebKit\/(\S+)/.exec(n):be?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(mi&&(Rr=mi?mi[1]:""),wt){var yi=ls();if(null!=yi&&yi>parseFloat(Rr)){gi=String(yi);break e}}gi=Rr}var Dr=X.document&&wt&&(ls()||parseInt(gi,10))||void 0;function Mn(n,e){if(Fe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(at){e:{try{en(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:ao[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Mn.$.h.call(this)}}ue(Mn,Fe);var ao={2:"touch",3:"pen",4:"mouse"};Mn.prototype.h=function(){Mn.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var rr="closure_listenable_"+(1e6*Math.random()|0),uo=0;function co(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++uo,this.fa=this.ia=!1}function ir(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Pr(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Fn(n){const e={};for(const t in n)e[t]=n[t];return e}const ds="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Or(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<ds.length;s++)t=ds[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Lr(n){this.src=n,this.g={},this.h=0}function sr(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=ot(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ir(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function or(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Lr.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=or(n,e,r,i);return-1<u?(e=n[u],t||(e.ia=!1)):((e=new co(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var _i="closure_lm_"+(1e6*Math.random()|0),Ii={};function fs(n,e,t,r,i){if(r&&r.once)return Mr(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)fs(n,e[s],t,r,i);return null}return t=Un(t),n&&n[rr]?n.O(e,t,Jt(r)?!!r.capture:!!r,i):ar(n,e,t,!1,r,i)}function ar(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var u=Jt(i)?!!i.capture:!!i,l=cn(n);if(l||(n[_i]=l=new Lr(n)),(t=l.add(e,t,r,u,s)).proxy)return t;if(r=function ps(){const e=ms;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)pi||(i=u),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(gs(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Mr(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Mr(n,e[s],t,r,i);return null}return t=Un(t),n&&n[rr]?n.P(e,t,Jt(r)?!!r.capture:!!r,i):ar(n,e,t,!0,r,i)}function Fr(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Fr(n,e[s],t,r,i);else r=Jt(r)?!!r.capture:!!r,t=Un(t),n&&n[rr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=or(s=n.g[e],t,r,i))&&(ir(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=cn(n))&&(e=n.g[e.toString()],n=-1,e&&(n=or(e,t,r,i)),(t=-1<n?e[n]:null)&&Ur(t))}function Ur(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[rr])sr(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(gs(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=cn(e))?(sr(t,n),0==t.h&&(t.src=null,e[_i]=null)):ir(n)}}}function gs(n){return n in Ii?Ii[n]:Ii[n]="on"+n}function ms(n,e){if(n.fa)n=!0;else{e=new Mn(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Ur(n),n=t.call(r,e)}return n}function cn(n){return(n=n[_i])instanceof Lr?n:null}var ys="__closure_events_fn_"+(1e9*Math.random()>>>0);function Un(n){return"function"==typeof n?n:(n[ys]||(n[ys]=function(e){return n.handleEvent(e)}),n[ys])}function tt(){J.call(this),this.i=new Lr(this),this.S=this,this.J=null}function ut(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Fe(e,n);else if(e instanceof Fe)e.target=e.target||n;else{var i=e;Or(e=new Fe(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];i=ln(u,r,!0,e)&&i}if(i=ln(u=e.g=n,r,!0,e)&&i,i=ln(u,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=ln(u=e.g=t[s],r,!1,e)&&i}function ln(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.fa&&u.capture==t){var l=u.listener,d=u.la||u.src;u.ia&&sr(n.i,u),i=!1!==l.call(d,r)&&i}}return i&&!r.defaultPrevented}ue(tt,J),tt.prototype[rr]=!0,tt.prototype.removeEventListener=function(n,e,t,r){Fr(this,n,e,t,r)},tt.prototype.N=function(){if(tt.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)ir(t[r]);delete n.g[e],n.h--}}this.J=null},tt.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},tt.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var vs=X.JSON.stringify;function Ia(){var n=Ze;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var _s=new class lo{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Is,n=>n.reset());class Is{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Vr(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function ho(n){X.setTimeout(()=>{throw n},0)}let wn,De=!1,Ze=new class wa{constructor(){this.h=this.g=null}add(e,t){const r=_s.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},wi=()=>{const n=X.Promise.resolve(void 0);wn=()=>{n.then(Vn)}};var Vn=()=>{for(var n;n=Ia();){try{n.h.call(n.g)}catch(t){ho(t)}var e=_s;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}De=!1};function Bn(n,e){tt.call(this),this.h=n||1,this.g=e||X,this.j=ne(this.qb,this),this.l=Date.now()}function F(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function bt(n,e,t){if("function"==typeof n)t&&(n=ne(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=ne(n.handleEvent,n)}return 2147483647<Number(e)?-1:X.setTimeout(n,e||0)}function Kt(n){n.g=bt(()=>{n.g=null,n.i&&(n.i=!1,Kt(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ue(Bn,tt),(B=Bn.prototype).ga=!1,B.T=null,B.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ut(this,"tick"),this.ga&&(F(this),this.start()))}},B.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},B.N=function(){Bn.$.N.call(this),F(this),delete this.g};class Br extends J{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Kt(this)}N(){super.N(),this.g&&(X.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ur(n){J.call(this),this.h=n,this.g={}}ue(ur,J);var fo=[];function Ea(n,e,t,r){Array.isArray(t)||(t&&(fo[0]=t.toString()),t=fo);for(var i=0;i<t.length;i++){var s=fs(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Ta(n){Pr(n.g,function(e,t){this.g.hasOwnProperty(t)&&Ur(e)},n),n.g={}}function En(){this.g=!0}function qn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Te(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<i.length;u++)i[u]=""}}}return vs(t)}catch{return e}}(n,t)+(r?" "+r:"")})}ur.prototype.N=function(){ur.$.N.call(this),Ta(this)},ur.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},En.prototype.Ea=function(){this.g=!1},En.prototype.info=function(){};var ve={},qr=null;function Wt(){return qr=qr||new tt}function Es(n){Fe.call(this,ve.Ta,n)}function Ti(n){const e=Wt();ut(e,new Es(e))}function cr(n,e){Fe.call(this,ve.STAT_EVENT,n),this.stat=e}function dt(n){const e=Wt();ut(e,new cr(e,n))}function Sa(n,e){Fe.call(this,ve.Ua,n),this.size=e}function Si(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return X.setTimeout(function(){n()},e)}ve.Ta="serverreachability",ue(Es,Fe),ve.STAT_EVENT="statevent",ue(cr,Fe),ve.Ua="timingevent",ue(Sa,Fe);var Tn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},zu={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function go(){}function Ai(){}go.prototype.h=null;var C,xi={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function T(){Fe.call(this,"d")}function w(){Fe.call(this,"c")}function R(){}function L(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new ur(this),this.P=ce,this.V=new Bn(n=we?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new W}function W(){this.i=null,this.g="",this.h=!1}ue(T,Fe),ue(w,Fe),ue(R,go),R.prototype.g=function(){return new XMLHttpRequest},R.prototype.i=function(){return{}},C=new R;var ce=45e3,Ne={},ze={};function le(n,e,t){n.L=1,n.v=Io(Mt(e)),n.s=t,n.S=!0,ft(n,null)}function ft(n,e){n.G=Date.now(),mo(n),n.A=Mt(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),ba(t.i,"t",r),n.C=0,t=n.l.J,n.h=new W,n.g=Co(n.l,t?e:null,!n.s),0<n.O&&(n.M=new Br(ne(n.Pa,n,n.g),n.O)),Ea(n.U,n.g,"readystatechange",n.nb),e=n.I?Fn(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),Ti(),function Ei(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var u="",l=s.split("&"),d=0;d<l.length;d++){var p=l[d].split("=");if(1<p.length){var m=p[0];p=p[1];var v=m.split("_");u=2<=v.length&&"type"==v[1]?u+(m+"=")+p+"&":u+(m+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.W,n.s)}function Lt(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function Ci(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=Pe(n,t),i==ze){4==e&&(n.o=4,dt(14),r=!1),qn(n.j,n.m,null,"[Incomplete Response]");break}if(i==Ne){n.o=4,dt(15),qn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}qn(n.j,n.m,i,null),yo(n,i)}Lt(n)&&i!=ze&&i!=Ne&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,dt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Oi(e),e.M=!0,dt(11))):(qn(n.j,n.m,t,"[Invalid Chunked Response]"),lr(n),An(n))}function Pe(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?ze:(t=Number(e.substring(t,r)),isNaN(t)?Ne:(r+=1)+t>e.length?ze:(e=e.slice(r,r+t),n.C=r+t,e))}function mo(n){n.Y=Date.now()+n.P,Gr(n,n.P)}function Gr(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Si(ne(n.lb,n),e)}function Sn(n){n.B&&(X.clearTimeout(n.B),n.B=null)}function An(n){0==n.l.H||n.J||fc(n.l,n)}function lr(n){Sn(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,F(n.V),Ta(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function yo(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||wo(t.i,n)))if(!n.K&&wo(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;ks(t),zn(t)}xo(t),dt(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=Si(ne(t.ib,t),6e3));if(1>=ec(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else pr(t,11)}else if((n.K||t.g==n)&&ks(t),!an(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let p=i[e];if(t.V=p[0],p=p[1],2==t.H)if("c"==p[0]){t.K=p[1],t.pa=p[2];const m=p[3];null!=m&&(t.ra=m,t.l.info("VER="+t.ra));const v=p[4];null!=v&&(t.Ga=v,t.l.info("SVER="+t.Ga));const E=p[5];null!=E&&"number"==typeof E&&0<E&&(t.L=r=1.5*E,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const S=n.g;if(S){const D=S.g?S.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(D){var s=r.i;s.g||-1==D.indexOf("spdy")&&-1==D.indexOf("quic")&&-1==D.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Eo(s,s.h),s.h=null))}if(r.F){const U=S.g?S.g.getResponseHeader("X-HTTP-Session-Id"):null;U&&(r.Da=U,Se(r.I,r.F,U))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var u=n;if((r=t).wa=pc(r,r.J?r.pa:null,r.Y),u.K){tc(r.i,u);var l=u,d=r.L;d&&l.setTimeout(d),l.B&&(Sn(l),mo(l)),r.g=u}else Cs(r);0<t.j.length&&xs(t)}else"stop"!=p[0]&&"close"!=p[0]||pr(t,7);else 3==t.H&&("stop"==p[0]||"close"==p[0]?"stop"==p[0]?pr(t,7):fr(t):"noop"!=p[0]&&t.h&&t.h.Aa(p),t.A=0)}Ti()}catch{}}function xa(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(on(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function $u(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(on(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Aa(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(on(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(B=L.prototype).setTimeout=function(n){this.P=n},B.nb=function(n){n=n.target;const e=this.M;e&&3==Et(n)?e.l():this.Pa(n)},B.Pa=function(n){try{if(n==this.g)e:{const m=Et(this.g);var e=this.g.Ia();if(this.g.da(),!(3>m)&&(3!=m||we||this.g&&(this.h.h||this.g.ja()||uc(this.g)))){this.J||4!=m||7==e||Ti(),Sn(this);var t=this.g.da();this.ca=t;t:if(Lt(this)){var r=uc(this.g);n="";var i=r.length,s=4==Et(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){lr(this),An(this);var u="";break t}this.h.i=new X.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.ja();if(this.i=200==t,function po(n,e,t,r,i,s,u){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.W,m,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var l,d=this.g;if((l=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!an(l)){var p=l;break t}}p=null}if(!(t=p)){this.i=!1,this.o=3,dt(12),lr(this),An(this);break e}qn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yo(this,t)}this.S?(Ci(this,m,u),we&&this.i&&3==m&&(Ea(this.U,this.V,"tick",this.mb),this.V.start())):(qn(this.j,this.m,u,null),yo(this,u)),4==m&&lr(this),this.i&&!this.J&&(4==m?fc(this.l,this):(this.i=!1,mo(this)))}else(function ph(n){const e={};n=(n.g&&2<=Et(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(an(n[r]))continue;var t=Vr(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function hs(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<u.indexOf("Unknown SID")?(this.o=3,dt(12)):(this.o=0,dt(13)),lr(this),An(this)}}}catch{}},B.mb=function(){if(this.g){var n=Et(this.g),e=this.g.ja();this.C<e.length&&(Sn(this),Ci(this,n,e),this.i&&4!=n&&mo(this))}},B.cancel=function(){this.J=!0,lr(this)},B.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function ws(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(Ti(),dt(17)),lr(this),this.o=2,An(this)):Gr(this,this.Y-n)};var ki=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hr(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof hr){this.h=n.h,vo(this,n.j),this.s=n.s,this.g=n.g,_o(this,n.m),this.l=n.l;var e=n.i,t=new Ni;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Ku(this,t),this.o=n.o}else n&&(e=String(n).match(ki))?(this.h=!1,vo(this,e[1]||"",!0),this.s=bi(e[2]||""),this.g=bi(e[3]||"",!0),_o(this,e[4]),this.l=bi(e[5]||"",!0),Ku(this,e[6]||"",!0),this.o=bi(e[7]||"")):(this.h=!1,this.i=new Ni(null,this.h))}function Mt(n){return new hr(n)}function vo(n,e,t){n.j=t?bi(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function _o(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ku(n,e,t){e instanceof Ni?(n.i=e,function ch(n,e){e&&!n.j&&(dr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Qu(this,r),ba(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Ss(e,uh)),n.i=new Ni(e,n.h))}function Se(n,e,t){n.i.set(e,t)}function Io(n){return Se(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function bi(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ss(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Wu),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Wu(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}hr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ss(e,Ca,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Ss(e,Ca,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Ss(t,"/"==t.charAt(0)?Hu:Zu,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ss(t,ka)),n.join("")};var Ca=/[#\/\?@]/g,Zu=/[#\?:]/g,Hu=/[#\?]/g,uh=/[#\?@]/g,ka=/#/g;function Ni(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function dr(n){n.g||(n.g=new Map,n.h=0,n.i&&function ju(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Qu(n,e){dr(n),e=Zt(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Yu(n,e){return dr(n),e=Zt(n,e),n.g.has(e)}function ba(n,e,t){Qu(n,e),0<t.length&&(n.i=null,n.g.set(Zt(n,e),Me(t)),n.h+=t.length)}function Zt(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Ue(n){this.l=n||Xu,n=X.PerformanceNavigationTiming?0<(n=X.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(X.g&&X.g.Ka&&X.g.Ka()&&X.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(B=Ni.prototype).add=function(n,e){dr(this),this.i=null,n=Zt(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},B.forEach=function(n,e){dr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},B.ta=function(){dr(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},B.Z=function(n){dr(this);let e=[];if("string"==typeof n)Yu(this,n)&&(e=e.concat(this.g.get(Zt(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},B.set=function(n,e){return dr(this),this.i=null,Yu(this,n=Zt(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},B.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},B.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),u=this.Z(r);for(r=0;r<u.length;r++){var i=s;""!==u[r]&&(i+="="+encodeURIComponent(String(u[r]))),n.push(i)}}return this.i=n.join("&")};var Xu=10;function Ju(n){return!!n.h||!!n.g&&n.g.size>=n.j}function ec(n){return n.h?1:n.g?n.g.size:0}function wo(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Eo(n,e){n.g?n.g.add(e):n.h=e}function tc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Na(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Me(n.i)}Ue.prototype.cancel=function(){if(this.i=Na(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var hh=class{stringify(n){return X.JSON.stringify(n,void 0)}parse(n){return X.JSON.parse(n,void 0)}};function Ri(){this.g=new hh}function nc(n,e,t){const r=t||"";try{xa(n,function(i,s){let u=i;Jt(i)&&(u=vs(i)),e.push(r+s+"="+encodeURIComponent(u))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function To(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function zr(n){this.l=n.fc||null,this.j=n.ob||!1}function $r(n,e){tt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Ra,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ue(zr,go),zr.prototype.g=function(){return new $r(this.l,this.j)},zr.prototype.i=function(n){return function(){return n}}({}),ue($r,tt);var Ra=0;function So(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function jr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,As(n)}function As(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(B=$r.prototype).open=function(n,e){if(this.readyState!=Ra)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,As(this)},B.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||X).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},B.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jr(this)),this.readyState=Ra},B.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,As(this)),this.g&&(this.readyState=3,As(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof X.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;So(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},B.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?jr(this):As(this),3==this.readyState&&So(this)}},B.Za=function(n){this.g&&(this.response=this.responseText=n,jr(this))},B.Ya=function(n){this.g&&(this.response=n,jr(this))},B.ka=function(){this.g&&jr(this)},B.setRequestHeader=function(n,e){this.v.append(n,e)},B.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},B.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty($r.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var dh=X.JSON.parse;function $e(n){tt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Di,this.L=this.M=!1}ue($e,tt);var Di="",Gn=/^https?$/i,fh=["POST","PUT"];function ic(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,sc(n),Ao(n)}function sc(n){n.F||(n.F=!0,ut(n,"complete"),ut(n,"error"))}function oc(n){if(n.h&&typeof yn<"u"&&(!n.C[1]||4!=Et(n)||2!=n.da()))if(n.v&&4==Et(n))bt(n.La,0,n);else if(ut(n,"readystatechange"),4==Et(n)){n.h=!1;try{const u=n.da();e:switch(u){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===u){var i=String(n.I).match(ki)[1]||null;!i&&X.self&&X.self.location&&(i=X.self.location.protocol.slice(0,-1)),r=!Gn.test(i?i.toLowerCase():"")}t=r}if(t)ut(n,"complete"),ut(n,"success");else{n.m=6;try{var s=2<Et(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",sc(n)}}finally{Ao(n)}}}function Ao(n,e){if(n.g){ac(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ut(n,"ready");try{t.onreadystatechange=r}catch{}}}function ac(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(X.clearTimeout(n.A),n.A=null)}function Et(n){return n.g?n.g.readyState:0}function uc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Di:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Pi(n){let e="";return Pr(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function cc(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Pi(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Se(n,e,t))}function Kr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Cn(n){this.Ga=0,this.j=[],this.l=new En,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Kr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Kr("baseRetryDelayMs",5e3,n),this.hb=Kr("retryDelaySeedMs",1e4,n),this.eb=Kr("forwardChannelMaxRetries",2,n),this.xa=Kr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Ue(n&&n.concurrentRequestLimit),this.Ja=new Ri,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function fr(n){if(Da(n),3==n.H){var e=n.W++,t=Mt(n.I);if(Se(t,"SID",n.K),Se(t,"RID",e),Se(t,"TYPE","terminate"),kn(n,t),(e=new L(n,n.l,e)).L=2,e.v=Io(Mt(t)),t=!1,X.navigator&&X.navigator.sendBeacon)try{t=X.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&X.Image&&((new Image).src=e.v,t=!0),t||(e.g=Co(e.l,null),e.g.ha(e.v)),e.G=Date.now(),mo(e)}Pa(n)}function zn(n){n.g&&(Oi(n),n.g.cancel(),n.g=null)}function Da(n){zn(n),n.u&&(X.clearTimeout(n.u),n.u=null),ks(n),n.i.cancel(),n.m&&("number"==typeof n.m&&X.clearTimeout(n.m),n.m=null)}function xs(n){if(!Ju(n.i)&&!n.m){n.m=!0;var e=n.Na;wn||wi(),De||(wn(),De=!0),Ze.add(e,n),n.C=0}}function hc(n,e){var t;t=e?e.m:n.W++;const r=Mt(n.I);Se(r,"SID",n.K),Se(r,"RID",t),Se(r,"AID",n.V),kn(n,r),n.o&&n.s&&cc(r,n.o,n.s),t=new L(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=dc(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Eo(n.i,t),le(t,r,e)}function kn(n,e){n.na&&Pr(n.na,function(t,r){Se(e,r,t)}),n.h&&xa({},function(t,r){Se(e,r,t)})}function dc(n,e,t){t=Math.min(n.j.length,t);var r=n.h?ne(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=i[0].g,u.push("ofs="+s)):s=0:u.push("ofs="+s);let l=!0;for(let d=0;d<t;d++){let p=i[d].g;const m=i[d].map;if(p-=s,0>p)s=Math.max(0,i[d].g-100),l=!1;else try{nc(m,u,"req"+p+"_")}catch{r&&r(m)}}if(l){r=u.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Cs(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;wn||wi(),De||(wn(),De=!0),Ze.add(e,n),n.A=0}}function xo(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=Si(ne(n.Ma,n),bs(n,n.A)),n.A++,0))}function Oi(n){null!=n.B&&(X.clearTimeout(n.B),n.B=null)}function Ht(n){n.g=new L(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Mt(n.wa);Se(e,"RID","rpc"),Se(e,"SID",n.K),Se(e,"AID",n.V),Se(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Se(e,"TO",n.qa),Se(e,"TYPE","xmlhttp"),kn(n,e),n.o&&n.s&&cc(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=Io(Mt(e)),t.s=null,t.S=!0,ft(t,n)}function ks(n){null!=n.v&&(X.clearTimeout(n.v),n.v=null)}function fc(n,e){var t=null;if(n.g==e){ks(n),Oi(n),n.g=null;var r=2}else{if(!wo(n.i,e))return;t=e.F,tc(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;ut(r=Wt(),new Sa(r,t)),xs(n)}else Cs(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function lc(n,e){return!(ec(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=Si(ne(n.Na,n,e),bs(n,n.C)),n.C++,0)))}(n,e)||2==r&&xo(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:pr(n,5);break;case 4:pr(n,10);break;case 3:pr(n,6);break;default:pr(n,2)}}function bs(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function pr(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=ne(n.pb,n);t||(t=new hr("//www.google.com/images/cleardot.gif"),X.location&&"http"==X.location.protocol||vo(t,"https"),Io(t)),function rc(n,e){const t=new En;if(X.Image){const r=new Image;r.onload=pe(To,t,r,"TestLoadImage: loaded",!0,e),r.onerror=pe(To,t,r,"TestLoadImage: error",!1,e),r.onabort=pe(To,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=pe(To,t,r,"TestLoadImage: timeout",!1,e),X.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else dt(2);n.H=0,n.h&&n.h.za(e),Pa(n),Da(n)}function Pa(n){if(n.H=0,n.ma=[],n.h){const e=Na(n.i);(0!=e.length||0!=n.j.length)&&(Ln(n.ma,e),Ln(n.ma,n.j),n.i.i.length=0,Me(n.j),n.j.length=0),n.h.ya()}}function pc(n,e,t){var r=t instanceof hr?Mt(t):new hr(t);if(""!=r.g)e&&(r.g=e+"."+r.g),_o(r,r.m);else{var i=X.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new hr(null);r&&vo(s,r),e&&(s.g=e),i&&_o(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&Se(r,t,e),Se(r,"VER",n.ra),kn(n,r),r}function Co(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new $e(t&&n.Ha&&!n.va?new zr({ob:!0}):n.va)).Oa(n.J),e}function Ns(){}function Rs(){if(wt&&!(10<=Number(Dr)))throw Error("Environmental error: no available transport.")}function Ft(n,e){tt.call(this),this.g=new Cn(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!an(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!an(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Wr(this)}function Ds(n){T.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Oa(){w.call(this),this.status=1}function Wr(n){this.g=n}function hn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Zr(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],u=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;u=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(u<<7&4294967295|u>>>25))+((u=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|u>>>20))+((u=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|u>>>15))+((u=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|u>>>10))+((u=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|u>>>25))+((u=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|u>>>20))+((u=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|u>>>15))+((u=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|u>>>10))+((u=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|u>>>25))+((u=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|u>>>20))+((u=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|u>>>15))+((u=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|u>>>10))+((u=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|u>>>25))+((u=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|u>>>20))+((u=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|u>>>15))+((u=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|u>>>10))+((u=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|u>>>27))+((u=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|u>>>23))+((u=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|u>>>18))+((u=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|u>>>12))+((u=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|u>>>27))+((u=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|u>>>23))+((u=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|u>>>18))+((u=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|u>>>12))+((u=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|u>>>27))+((u=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|u>>>23))+((u=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|u>>>18))+((u=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|u>>>12))+((u=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|u>>>27))+((u=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|u>>>23))+((u=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|u>>>18))+((u=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|u>>>12))+((u=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|u>>>28))+((u=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|u>>>21))+((u=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|u>>>16))+((u=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|u>>>9))+((u=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|u>>>28))+((u=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|u>>>21))+((u=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|u>>>16))+((u=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|u>>>9))+((u=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|u>>>28))+((u=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|u>>>21))+((u=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|u>>>16))+((u=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|u>>>9))+((u=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|u>>>28))+((u=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|u>>>21))+((u=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|u>>>16))+((u=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|u>>>9))+((u=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|u>>>26))+((u=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|u>>>22))+((u=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|u>>>17))+((u=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|u>>>11))+((u=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|u>>>26))+((u=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|u>>>22))+((u=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|u>>>17))+((u=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|u>>>11))+((u=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|u>>>26))+((u=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|u>>>22))+((u=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|u>>>17))+((u=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|u>>>11))+((s=(e=t+((u=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|u>>>26))+((u=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|u>>>22))^((i=s+((u=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|u>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(u<<21&4294967295|u>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function ye(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(B=$e.prototype).Oa=function(n){this.M=n},B.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():C.g(),this.C=function Ts(n){return n.h||(n.h=n.i())}(this.u?this.u:C),this.g.onreadystatechange=ne(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void ic(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=X.FormData&&n instanceof X.FormData,!(0<=ot(fh,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,u]of t)this.g.setRequestHeader(s,u);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ac(this),0<this.B&&((this.L=function xn(n){return wt&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ne(this.ua,this)):this.A=bt(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){ic(this,s)}},B.ua=function(){typeof yn<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ut(this,"timeout"),this.abort(8))},B.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ut(this,"complete"),ut(this,"abort"),Ao(this))},B.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ao(this,!0)),$e.$.N.call(this)},B.La=function(){this.s||(this.G||this.v||this.l?oc(this):this.kb())},B.kb=function(){oc(this)},B.isActive=function(){return!!this.g},B.da=function(){try{return 2<Et(this)?this.g.status:-1}catch{return-1}},B.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},B.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),dh(e)}},B.Ia=function(){return this.m},B.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(B=Cn.prototype).ra=8,B.H=1,B.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new L(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Fn(s),Or(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=dc(this,i,e),Se(t=Mt(this.I),"RID",n),Se(t,"CVER",22),this.F&&Se(t,"X-HTTP-Session-Id",this.F),kn(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Pi(s)))+"&"+e:this.o&&cc(t,this.o,s)),Eo(this.i,i),this.bb&&Se(t,"TYPE","init"),this.P?(Se(t,"$req",e),Se(t,"SID","null"),i.aa=!0,le(i,t,null)):le(i,t,e),this.H=2}}else 3==this.H&&(n?hc(this,n):0==this.j.length||Ju(this.i)||hc(this))},B.Ma=function(){if(this.u=null,Ht(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Si(ne(this.jb,this),n)}},B.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,dt(10),zn(this),Ht(this))},B.ib=function(){null!=this.v&&(this.v=null,zn(this),xo(this),dt(19))},B.pb=function(n){n?(this.l.info("Successfully pinged google.com"),dt(2)):(this.l.info("Failed to ping google.com"),dt(1))},B.isActive=function(){return!!this.h&&this.h.isActive(this)},(B=Ns.prototype).Ba=function(){},B.Aa=function(){},B.za=function(){},B.ya=function(){},B.isActive=function(){return!0},B.Va=function(){},Rs.prototype.g=function(n,e){return new Ft(n,e)},ue(Ft,tt),Ft.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;dt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=pc(n,null,n.Y),xs(n)},Ft.prototype.close=function(){fr(this.g)},Ft.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=vs(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&xs(e)},Ft.prototype.N=function(){this.g.h=null,delete this.j,fr(this.g),delete this.g,Ft.$.N.call(this)},ue(Ds,T),ue(Oa,w),ue(Wr,Ns),Wr.prototype.Ba=function(){ut(this.g,"a")},Wr.prototype.Aa=function(n){ut(this.g,new Ds(n))},Wr.prototype.za=function(n){ut(this.g,new Oa)},Wr.prototype.ya=function(){ut(this.g,"b")},ue(hn,function gh(){this.blockSize=-1}),hn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},hn.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)Zr(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Zr(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Zr(this,r),i=0;break}}this.h=i,this.i+=e},hn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var La={};function gr(n){return-128<=n&&128>n?function _n(n,e){var t=La;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new ye([0|e],0>e?-1:0)}):new ye([0|n],0>n?-1:0)}function bn(n){if(isNaN(n)||!isFinite(n))return Hr;if(0>n)return pt(bn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Ma;return new ye(e,0)}var Ma=4294967296,Hr=gr(0),Fa=gr(1),mc=gr(16777216);function $n(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function tn(n){return-1==n.h}function pt(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new ye(t,~n.h).add(Fa)}function ko(n,e){return n.add(pt(e))}function bo(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ps(n,e){this.g=n,this.h=e}function No(n,e){if($n(e))throw Error("division by zero");if($n(n))return new Ps(Hr,Hr);if(tn(n))return e=No(pt(n),e),new Ps(pt(e.g),pt(e.h));if(tn(e))return e=No(n,pt(e)),new Ps(pt(e.g),e.h);if(30<n.g.length){if(tn(n)||tn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Fa,r=e;0>=r.X(n);)t=yc(t),r=yc(r);var i=Li(t,1),s=Li(r,1);for(r=Li(r,2),t=Li(t,2);!$n(r);){var u=s.add(r);0>=u.X(n)&&(i=i.add(t),s=u),r=Li(r,1),t=Li(t,1)}return e=ko(n,i.R(e)),new Ps(i,e)}for(i=Hr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),u=(s=bn(t)).R(e);tn(u)||0<u.X(n);)u=(s=bn(t-=r)).R(e);$n(s)&&(s=Fa),i=i.add(s),n=ko(n,u)}return new Ps(i,n)}function yc(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new ye(t,n.h)}function Li(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new ye(i,n.h)}(B=ye.prototype).ea=function(){if(tn(this))return-pt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Ma+r)*e,e*=Ma}return n},B.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if($n(this))return"0";if(tn(this))return"-"+pt(this).toString(n);for(var e=bn(Math.pow(n,6)),t=this,r="";;){var i=No(t,e).g,s=((0<(t=ko(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if($n(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},B.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},B.X=function(n){return tn(n=ko(this,n))?-1:$n(n)?0:1},B.abs=function(){return tn(this)?pt(this):this},B.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),u=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=u>>>16,t[i]=(u&=65535)<<16|(s&=65535)}return new ye(t,-2147483648&t[t.length-1]?-1:0)},B.R=function(n){if($n(this)||$n(n))return Hr;if(tn(this))return tn(n)?pt(this).R(pt(n)):pt(pt(this).R(n));if(tn(n))return pt(this.R(pt(n)));if(0>this.X(mc)&&0>n.X(mc))return bn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,u=65535&this.D(r),l=n.D(i)>>>16,d=65535&n.D(i);t[2*r+2*i]+=u*d,bo(t,2*r+2*i),t[2*r+2*i+1]+=s*d,bo(t,2*r+2*i+1),t[2*r+2*i+1]+=u*l,bo(t,2*r+2*i+1),t[2*r+2*i+2]+=s*l,bo(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new ye(t,0)},B.gb=function(n){return No(this,n).h},B.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new ye(t,this.h&n.h)},B.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new ye(t,this.h|n.h)},B.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new ye(t,this.h^n.h)},Rs.prototype.createWebChannel=Rs.prototype.g,Ft.prototype.send=Ft.prototype.u,Ft.prototype.open=Ft.prototype.m,Ft.prototype.close=Ft.prototype.close,Tn.NO_ERROR=0,Tn.TIMEOUT=8,Tn.HTTP_ERROR=6,zu.COMPLETE="complete",Ai.EventType=xi,xi.OPEN="a",xi.CLOSE="b",xi.ERROR="c",xi.MESSAGE="d",tt.prototype.listen=tt.prototype.O,$e.prototype.listenOnce=$e.prototype.P,$e.prototype.getLastError=$e.prototype.Sa,$e.prototype.getLastErrorCode=$e.prototype.Ia,$e.prototype.getStatus=$e.prototype.da,$e.prototype.getResponseJson=$e.prototype.Wa,$e.prototype.getResponseText=$e.prototype.ja,$e.prototype.send=$e.prototype.ha,$e.prototype.setWithCredentials=$e.prototype.Oa,hn.prototype.digest=hn.prototype.l,hn.prototype.reset=hn.prototype.reset,hn.prototype.update=hn.prototype.j,ye.prototype.add=ye.prototype.add,ye.prototype.multiply=ye.prototype.R,ye.prototype.modulo=ye.prototype.gb,ye.prototype.compare=ye.prototype.X,ye.prototype.toNumber=ye.prototype.ea,ye.prototype.toString=ye.prototype.toString,ye.prototype.getBits=ye.prototype.D,ye.fromNumber=bn,ye.fromString=function gc(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return pt(gc(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=bn(Math.pow(e,8)),r=Hr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),u=parseInt(n.substring(i,i+s),e);8>s?(s=bn(Math.pow(e,s)),r=r.R(s).add(bn(u))):r=(r=r.R(t)).add(bn(u))}return r};var Ic,wh,Eh,wc,Ec,Sh,Ah,xh,Ch,mr,Do,Tc,Sc,Ac,kh,xc,Cc,Po,Oo,kc,Os,Va,bc,Nc,Rc,bh,Ls,Nh,jn,Dc,Pc,Fi,Oc,He,Lc,Lo,Mc,Fc,Uc,Ba,Vc,Ms,qa,mh=ht.createWebChannelTransport=function(){return new Rs},yh=ht.getStatEventTarget=function(){return Wt()},Ua=ht.ErrorCode=Tn,vc=ht.EventType=zu,vh=ht.Event=ve,Qr=ht.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},_c=ht.FetchXmlHttpFactory=zr,Ro=ht.WebChannel=Ai,_h=ht.XhrIo=$e,Ih=ht.Md5=hn,Mi=ht.Integer=ye;const Ui="@firebase/firestore";class Qe{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qe.UNAUTHENTICATED=new Qe(null),Qe.GOOGLE_CREDENTIALS=new Qe("google-credentials-uid"),Qe.FIRST_PARTY=new Qe("first-party-uid"),Qe.MOCK_USER=new Qe("mock-user");let Vi="9.23.0";const Nn=new Ot.Yd("@firebase/firestore");function Mo(){return Nn.logLevel}function M(n,...e){if(Nn.logLevel<=Ot.in.DEBUG){const t=e.map(Bc);Nn.debug(`Firestore (${Vi}): ${n}`,...t)}}function Ye(n,...e){if(Nn.logLevel<=Ot.in.ERROR){const t=e.map(Bc);Nn.error(`Firestore (${Vi}): ${n}`,...t)}}function nn(n,...e){if(Nn.logLevel<=Ot.in.WARN){const t=e.map(Bc);Nn.warn(`Firestore (${Vi}): ${n}`,...t)}}function Bc(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function j(n="Unexpected state"){const e=`FIRESTORE (${Vi}) INTERNAL ASSERTION FAILED: `+n;throw Ye(e),new Error(e)}function H(n,e){n||j()}function z(n,e){return n}const k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class P extends fe.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class je{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class qc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ph{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Qe.UNAUTHENTICATED))}shutdown(){}}class Oh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ga{constructor(e){this.t=e,this.currentUser=Qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=p=>this.i!==i?(i=this.i,t(p)):Promise.resolve();let u=new je;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new je,e.enqueueRetryable(()=>s(this.currentUser))};const l=()=>{const p=u;e.enqueueRetryable((0,N.Z)(function*(){yield p.promise,yield s(r.currentUser)}))},d=p=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.auth.addAuthTokenListener(this.o),l()};this.t.onInit(p=>d(p)),setTimeout(()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?d(p):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new je)}},0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(H("string"==typeof r.accessToken),new qc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return H(null===e||"string"==typeof e),new Qe(e)}}class Lh{constructor(e,t,r){this.h=e,this.l=t,this.m=r,this.type="FirstParty",this.user=Qe.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Mh{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Lh(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Qe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Gc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Fh{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const r=s=>{null!=s.error&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.T;return this.T=s.token,M("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.I.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.I.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(H("string"==typeof t.token),this.T=t.token,new Gc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function zc(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class $c{static A(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=zc(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function ee(n,e){return n<e?-1:n>e?1:0}function Bi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Fo(n){return n+"\0"}class Oe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new P(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new P(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new P(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new P(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Oe.fromMillis(Date.now())}static fromDate(e){return Oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Oe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Y{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Y(e)}static min(){return new Y(new Oe(0,0))}static max(){return new Y(new Oe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Fs{constructor(e,t,r){void 0===t?t=0:t>e.length&&j(),void 0===r?r=e.length-t:r>e.length-t&&j(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Fs.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Fs?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),u=t.get(i);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class oe extends Fs{construct(e,t,r){return new oe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new P(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new oe(t)}static emptyPath(){return new oe([])}}const Uh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ae extends Fs{construct(e,t,r){return new Ae(e,t,r)}static isValidIdentifier(e){return Uh.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ae.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Ae(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new P(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;i<e.length;){const l=e[i];if("\\"===l){if(i+1===e.length)throw new P(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new P(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===l?(u=!u,i++):"."!==l||u?(r+=l,i++):(s(),i++)}if(s(),u)throw new P(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ae(t)}static emptyPath(){return new Ae([])}}class V{constructor(e){this.path=e}static fromPath(e){return new V(oe.fromString(e))}static fromName(e){return new V(oe.fromString(e).popFirst(5))}static empty(){return new V(oe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===oe.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new V(new oe(e.slice()))}}class qi{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function za(n){return n.fields.find(e=>2===e.kind)}function Yr(n){return n.fields.filter(e=>2!==e.kind)}qi.UNKNOWN_ID=-1;class Us{constructor(e,t){this.fieldPath=e,this.kind=t}}class Vs{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Vs(0,Nt.min())}}function jc(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Y.fromTimestamp(1e9===r?new Oe(t+1,0):new Oe(t,r));return new Nt(i,V.empty(),e)}function Kc(n){return new Nt(n.readTime,n.key,-1)}class Nt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Nt(Y.min(),V.empty(),-1)}static max(){return new Nt(Y.max(),V.empty(),-1)}}function $a(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=V.comparator(n.documentKey,e.documentKey),0!==t?t:ee(n.largestBatchId,e.largestBatchId))}const Gi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Wc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function yr(n){return(Ic=Ic||(0,N.Z)(function*(e){if(e.code!==k.FAILED_PRECONDITION||e.message!==Gi)throw e;M("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class x{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new x((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof x?t:x.resolve(t)}catch(t){return x.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):x.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):x.reject(t)}static resolve(e){return new x((t,r)=>{t(e)})}static reject(e){return new x((t,r)=>{r(e)})}static waitFor(e){return new x((t,r)=>{let i=0,s=0,u=!1;e.forEach(l=>{++i,l.next(()=>{++s,u&&s===i&&t()},d=>r(d))}),u=!0,s===i&&t()})}static or(e){let t=x.resolve(!1);for(const r of e)t=t.next(i=>i?x.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new x((r,i)=>{const s=e.length,u=new Array(s);let l=0;for(let d=0;d<s;d++){const p=d;t(e[p]).next(m=>{u[p]=m,++l,l===s&&r(u)},m=>i(m))}})}static doWhile(e,t){return new x((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Uo{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new je,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new zi(e,t.error)):this.v.resolve()},this.transaction.onerror=r=>{const i=ja(r.target.error);this.v.reject(new zi(e,i))}}static open(e,t,r,i){try{return new Uo(t,e.transaction(i,r))}catch(s){throw new zi(t,s)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(M("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new qh(t)}}class Qt{constructor(e,t,r){this.name=e,this.version=t,this.V=r,12.2===Qt.S((0,fe.z$)())&&Ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M("SimpleDb","Removing database:",e),Xr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,fe.hl)())return!1;if(Qt.C())return!0;const e=(0,fe.z$)(),t=Qt.S(e),r=0<t&&t<10,i=Qt.N(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static N(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}$(e){var t=this;return(0,N.Z)(function*(){return t.db||(M("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{r(u.target.result)},s.onblocked=()=>{i(new zi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const l=u.target.error;i("VersionError"===l.name?new P(k.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===l.name?new P(k.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+l):new zi(e,l))},s.onupgradeneeded=u=>{M("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.V.O(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{M("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.F&&(t.db.onversionchange=r=>t.F(r)),t.db})()}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,N.Z)(function*(){const u="readonly"===t;let l=0;for(;;){++l;try{s.db=yield s.$(e);const d=Uo.open(s.db,e,u?"readonly":"readwrite",r),p=i(d).next(m=>(d.P(),m)).catch(m=>(d.abort(m),x.reject(m))).toPromise();return p.catch(()=>{}),yield d.R,p}catch(d){const p=d,m="FirebaseError"!==p.name&&l<3;if(M("SimpleDb","Transaction failed with error:",p.message,"Retrying:",m),s.close(),!m)return Promise.reject(p)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Zc{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return Xr(this.L.delete())}}class zi extends P{constructor(e,t){super(k.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function vr(n){return"IndexedDbTransactionError"===n.name}class qh{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(M("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(M("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Xr(r)}add(e){return M("SimpleDb","ADD",this.store.name,e,e),Xr(this.store.add(e))}get(e){return Xr(this.store.get(e)).next(t=>(void 0===t&&(t=null),M("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return M("SimpleDb","DELETE",this.store.name,e),Xr(this.store.delete(e))}count(){return M("SimpleDb","COUNT",this.store.name),Xr(this.store.count())}j(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.W(i,(u,l)=>{s.push(l)}).next(()=>s)}{const i=this.store.getAll(r.range);return new x((s,u)=>{i.onerror=l=>{u(l.target.error)},i.onsuccess=l=>{s(l.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new x((i,s)=>{r.onerror=u=>{s(u.target.error)},r.onsuccess=u=>{i(u.target.result)}})}J(e,t){M("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const i=this.cursor(r);return this.W(i,(s,u,l)=>l.delete())}X(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Z(e){const t=this.cursor({});return new x((r,i)=>{t.onerror=s=>{const u=ja(s.target.error);i(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(l=>{l?u.continue():r()}):r()}})}W(e,t){const r=[];return new x((i,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const l=u.target.result;if(!l)return void i();const d=new Zc(l),p=t(l.primaryKey,l.value,d);if(p instanceof x){const m=p.catch(v=>(d.done(),x.reject(v)));r.push(m)}d.isDone?i():null===d.K?l.continue():l.continue(d.K)}}).next(()=>x.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Xr(n){return new x((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=ja(r.target.error);t(i)}})}let Hc=!1;function ja(n){const e=Qt.S((0,fe.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new P("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Hc||(Hc=!0,setTimeout(()=>{throw r},0)),r}}return n}class Gh{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){var t=this;M("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,N.Z)(function*(){t.task=null;try{M("IndexBackiller",`Documents written: ${yield t.tt.nt()}`)}catch(r){vr(r)?M("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield yr(r)}yield t.et(6e4)}))}}class zh{constructor(e,t){this.localStore=e,this.persistence=t}nt(e=50){var t=this;return(0,N.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.st(r,e))})()}st(e,t){const r=new Set;let i=t,s=!0;return x.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!r.has(u))return M("IndexBackiller",`Processing collection: ${u}`),this.it(e,u,i).next(l=>{i-=l,r.add(u)});s=!1})).next(()=>t-i)}it(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.rt(i,s)).next(l=>(M("IndexBackiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>u.size)}))}rt(e,t){let r=e;return t.changes.forEach((i,s)=>{const u=Kc(s);$a(u,r)>0&&(r=u)}),new Nt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Tt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ot(i),this.ut=i=>r.writeSequenceNumber(i))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}return n.ct=-1,n})();function $i(n){return null==n}function Bs(n){return 0===n&&1/n==-1/0}function Ka(n){return"number"==typeof n&&Number.isInteger(n)&&!Bs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function gt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Yc(e)),e=Qc(n.get(t),e);return Yc(e)}function Qc(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Yc(n){return n+"\x01\x01"}function dn(n){const e=n.length;if(H(e>=2),2===e)return H("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),oe.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&j(),n.charAt(u+1)){case"\x01":const l=n.substring(s,u);let d;0===i.length?d=l:(i+=l,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,u),i+="\0";break;case"\x11":i+=n.substring(s,u+1);break;default:j()}s=u+2}return new oe(r)}const Xc=["userId","batchId"];function Vo(n,e){return[n,gt(e)]}function Jc(n,e,t){return[n,gt(e),t]}const $h={},jh=["prefixPath","collectionGroup","readTime","documentId"],el=["prefixPath","collectionGroup","documentId"],Kh=["collectionGroup","readTime","prefixPath","documentId"],Bo=["canonicalId","targetId"],Wh=["targetId","path"],Zh=["path","targetId"],Hh=["collectionId","parent"],Qh=["indexId","uid"],Yh=["uid","sequenceNumber"],Xh=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Jh=["indexId","uid","orderedDocumentKey"],ed=["userId","collectionPath","documentId"],td=["userId","collectionPath","largestBatchId"],nd=["userId","collectionGroup","largestBatchId"],tl=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],rd=[...tl,"documentOverlays"],nl=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Wa=nl,id=[...Wa,"indexConfiguration","indexState","indexEntries"];class Za extends Wc{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function ct(n,e){const t=z(n);return Qt.M(t.ht,e)}function rl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _r(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qo(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class xe{constructor(e,t){this.comparator=e,this.root=t||mt.EMPTY}insert(e,t){return new xe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mt.BLACK,null,null))}remove(e){return new xe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ji(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ji(this.root,e,this.comparator,!1)}getReverseIterator(){return new ji(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ji(this.root,e,this.comparator,!0)}}class ji{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class mt{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??mt.RED,this.left=i??mt.EMPTY,this.right=s??mt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new mt(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return mt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return mt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,mt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,mt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();const e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}}mt.EMPTY=null,mt.RED=!0,mt.BLACK=!1,mt.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(n,e,t,r,i){return this}insert(n,e,t){return new mt(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ce{constructor(e){this.comparator=e,this.data=new xe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new il(this.data.getIterator())}getIteratorFrom(e){return new il(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ce)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ce(this.comparator);return t.data=e,t}}class il{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ir(n){return n.hasNext()?n.getNext():void 0}class Ut{constructor(e){this.fields=e,e.sort(Ae.comparator)}static empty(){return new Ut([])}unionWith(e){let t=new Ce(Ae.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ut(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Bi(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class sd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Xe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new sd("Invalid base64 string: "+i):i}}(e);return new Xe(t)}static fromUint8Array(e){const t=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new Xe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xe.EMPTY_BYTE_STRING=new Xe("");const Go=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kn(n){if(H(!!n),"string"==typeof n){let e=0;const t=Go.exec(n);if(H(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ve(n.seconds),nanos:Ve(n.nanos)}}function Ve(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Wn(n){return"string"==typeof n?Xe.fromBase64String(n):Xe.fromUint8Array(n)}function zo(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function $o(n){const e=n.mapValue.fields.__previous_value__;return zo(e)?$o(e):e}function qs(n){const e=Kn(n.mapValue.fields.__local_write_time__.timestampValue);return new Oe(e.seconds,e.nanos)}class od{constructor(e,t,r,i,s,u,l,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=p}}class Zn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Zn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Zn&&e.projectId===this.projectId&&e.database===this.database}}const wr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Qa={nullValue:"NULL_VALUE"};function Hn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?zo(n)?4:al(n)?9007199254740991:10:j()}function fn(n,e){if(n===e)return!0;const t=Hn(n);if(t!==Hn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return qs(n).isEqual(qs(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=Kn(r.timestampValue),u=Kn(i.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,Wn(n.bytesValue).isEqual(Wn(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return Ve(r.geoPointValue.latitude)===Ve(i.geoPointValue.latitude)&&Ve(r.geoPointValue.longitude)===Ve(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Ve(r.integerValue)===Ve(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=Ve(r.doubleValue),u=Ve(i.doubleValue);return s===u?Bs(s)===Bs(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return Bi(n.arrayValue.values||[],e.arrayValue.values||[],fn);case 10:return function(r,i){const s=r.mapValue.fields||{},u=i.mapValue.fields||{};if(rl(s)!==rl(u))return!1;for(const l in s)if(s.hasOwnProperty(l)&&(void 0===u[l]||!fn(s[l],u[l])))return!1;return!0}(n,e);default:return j()}var i}function Ki(n,e){return void 0!==(n.values||[]).find(t=>fn(t,e))}function Qn(n,e){if(n===e)return 0;const t=Hn(n),r=Hn(e);if(t!==r)return ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(n.booleanValue,e.booleanValue);case 2:return function(i,s){const u=Ve(i.integerValue||i.doubleValue),l=Ve(s.integerValue||s.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(n,e);case 3:return Ya(n.timestampValue,e.timestampValue);case 4:return Ya(qs(n),qs(e));case 5:return ee(n.stringValue,e.stringValue);case 6:return function(i,s){const u=Wn(i),l=Wn(s);return u.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,s){const u=i.split("/"),l=s.split("/");for(let d=0;d<u.length&&d<l.length;d++){const p=ee(u[d],l[d]);if(0!==p)return p}return ee(u.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,s){const u=ee(Ve(i.latitude),Ve(s.latitude));return 0!==u?u:ee(Ve(i.longitude),Ve(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,s){const u=i.values||[],l=s.values||[];for(let d=0;d<u.length&&d<l.length;++d){const p=Qn(u[d],l[d]);if(p)return p}return ee(u.length,l.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===wr.mapValue&&s===wr.mapValue)return 0;if(i===wr.mapValue)return 1;if(s===wr.mapValue)return-1;const u=i.fields||{},l=Object.keys(u),d=s.fields||{},p=Object.keys(d);l.sort(),p.sort();for(let m=0;m<l.length&&m<p.length;++m){const v=ee(l[m],p[m]);if(0!==v)return v;const E=Qn(u[l[m]],d[p[m]]);if(0!==E)return E}return ee(l.length,p.length)}(n.mapValue,e.mapValue);default:throw j()}}function Ya(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return ee(n,e);const t=Kn(n),r=Kn(e),i=ee(t.seconds,r.seconds);return 0!==i?i:ee(t.nanos,r.nanos)}function rn(n){return Xa(n)}function Xa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=Kn(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Wn(n.bytesValue).toBase64():"referenceValue"in n?V.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",s=!0;for(const u of r.values||[])s?s=!1:i+=",",i+=Xa(u);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",u=!0;for(const l of i)u?u=!1:s+=",",s+=`${l}:${Xa(r.fields[l])}`;return s+"}"}(n.mapValue):j();var e}function Jr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ja(n){return!!n&&"integerValue"in n}function Gs(n){return!!n&&"arrayValue"in n}function sl(n){return!!n&&"nullValue"in n}function ol(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ko(n){return!!n&&"mapValue"in n}function zs(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return _r(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=zs(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=zs(n.arrayValue.values[t]);return e}return Object.assign({},n)}function al(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function ad(n){return"nullValue"in n?Qa:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Jr(Zn.empty(),V.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:j()}function ud(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Jr(Zn.empty(),V.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?wr:j()}function eu(n,e){const t=Qn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ul(n,e){const t=Qn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class yt{constructor(e){this.value=e}static empty(){return new yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ko(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zs(t)}setAll(e){let t=Ae.emptyPath(),r={},i=[];e.forEach((u,l)=>{if(!t.isImmediateParentOf(l)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=l.popLast()}u?r[l.lastSegment()]=zs(u):i.push(l.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Ko(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return fn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ko(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){_r(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new yt(zs(this.value))}}function Wo(n){const e=[];return _r(n.fields,(t,r)=>{const i=new Ae([t]);if(Ko(r)){const s=Wo(r.mapValue).fields;if(0===s.length)e.push(i);else for(const u of s)e.push(i.child(u))}else e.push(i)}),new Ut(e)}class Ee{constructor(e,t,r,i,s,u,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=u,this.documentState=l}static newInvalidDocument(e){return new Ee(e,0,Y.min(),Y.min(),Y.min(),yt.empty(),0)}static newFoundDocument(e,t,r,i){return new Ee(e,1,t,Y.min(),r,i,0)}static newNoDocument(e,t){return new Ee(e,2,t,Y.min(),Y.min(),yt.empty(),0)}static newUnknownDocument(e,t){return new Ee(e,3,t,Y.min(),Y.min(),yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Y.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Y.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ee&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ee(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Er{constructor(e,t){this.position=e,this.inclusive=t}}function cl(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],u=n.position[i];if(r=s.field.isKeyField()?V.comparator(V.fromName(u.referenceValue),t.key):Qn(u,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function $s(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!fn(n.position[t],e.position[t]))return!1;return!0}class Wi{constructor(e,t="asc"){this.field=e,this.dir=t}}function cd(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ll{}class ae extends ll{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new pl(e,t,r):"array-contains"===t?new dd(e,r):"in"===t?new nu(e,r):"not-in"===t?new ru(e,r):"array-contains-any"===t?new iu(e,r):new ae(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new ld(e,r):new hd(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Qn(t,this.value)):null!==t&&Hn(this.value)===Hn(t)&&this.matchesComparison(Qn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class _e extends ll{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new _e(e,t)}matches(e){return ei(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(t=>t.isInequality());return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function ei(n){return"and"===n.op}function Zo(n){return"or"===n.op}function Ho(n){return hl(n)&&ei(n)}function hl(n){for(const e of n.filters)if(e instanceof _e)return!1;return!0}function tu(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+rn(n.value);if(Ho(n))return n.filters.map(e=>tu(e)).join(",");{const e=n.filters.map(t=>tu(t)).join(",");return`${n.op}(${e})`}}function dl(n,e){return n instanceof ae?(t=n,(r=e)instanceof ae&&t.op===r.op&&t.field.isEqual(r.field)&&fn(t.value,r.value)):n instanceof _e?function(t,r){return r instanceof _e&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((i,s,u)=>i&&dl(s,r.filters[u]),!0)}(n,e):void j();var t,r}function Zi(n,e){const t=n.filters.concat(e);return _e.create(t,n.op)}function fl(n){return n instanceof ae?`${(e=n).field.canonicalString()} ${e.op} ${rn(e.value)}`:n instanceof _e?function(e){return e.op.toString()+" {"+e.getFilters().map(fl).join(" ,")+"}"}(n):"Filter";var e}class pl extends ae{constructor(e,t,r){super(e,t,r),this.key=V.fromName(r.referenceValue)}matches(e){const t=V.comparator(e.key,this.key);return this.matchesComparison(t)}}class ld extends ae{constructor(e,t){super(e,"in",t),this.keys=gl(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class hd extends ae{constructor(e,t){super(e,"not-in",t),this.keys=gl(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function gl(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>V.fromName(r.referenceValue))}class dd extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Gs(t)&&Ki(t.arrayValue,this.value)}}class nu extends ae{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ki(this.value.arrayValue,t)}}class ru extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ki(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ki(this.value.arrayValue,t)}}class iu extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Gs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ki(this.value.arrayValue,r))}}class ml{constructor(e,t=null,r=[],i=[],s=null,u=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=u,this.endAt=l,this.dt=null}}function su(n,e=null,t=[],r=[],i=null,s=null,u=null){return new ml(n,e,t,r,i,s,u)}function ti(n){const e=z(n);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>tu(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),$i(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>rn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>rn(r)).join(",")),e.dt=t}return e.dt}function vt(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!cd(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!dl(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$s(n.startAt,e.startAt)&&$s(n.endAt,e.endAt)}function Tr(n){return V.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function js(n,e){return n.filters.filter(t=>t instanceof ae&&t.field.isEqual(e))}function yl(n,e,t){let r=Qa,i=!0;for(const s of js(n,e)){let u=Qa,l=!0;switch(s.op){case"<":case"<=":u=ad(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,l=!1;break;case"!=":case"not-in":u=Qa}eu({value:r,inclusive:i},{value:u,inclusive:l})<0&&(r=u,i=l)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];eu({value:r,inclusive:i},{value:u,inclusive:t.inclusive})<0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}function Qo(n,e,t){let r=wr,i=!0;for(const s of js(n,e)){let u=wr,l=!0;switch(s.op){case">=":case">":u=ud(s.value),l=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,l=!1;break;case"!=":case"not-in":u=wr}ul({value:r,inclusive:i},{value:u,inclusive:l})>0&&(r=u,i=l)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];ul({value:r,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}class Yn{constructor(e,t=null,r=[],i=[],s=null,u="F",l=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=u,this.startAt=l,this.endAt=d,this.wt=null,this._t=null}}function ou(n,e,t,r,i,s,u,l){return new Yn(n,e,t,r,i,s,u,l)}function Hi(n){return new Yn(n)}function Xn(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Yo(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Xo(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function au(n){return null!==n.collectionGroup}function ni(n){const e=z(n);if(null===e.wt){e.wt=[];const t=Xo(e),r=Yo(e);if(null!==t&&null===r)t.isKeyField()||e.wt.push(new Wi(t)),e.wt.push(new Wi(Ae.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.wt.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Wi(Ae.keyField(),s))}}}return e.wt}function St(n){const e=z(n);if(!e._t)if("F"===e.limitType)e._t=su(e.path,e.collectionGroup,ni(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of ni(e))t.push(new Wi(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new Er(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Er(e.startAt.position,e.startAt.inclusive):null;e._t=su(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e._t}function At(n,e){e.getFirstInequalityField(),Xo(n);const t=n.filters.concat([e]);return new Yn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Qi(n,e,t){return new Yn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ks(n,e){return vt(St(n),St(e))&&n.limitType===e.limitType}function Rn(n){return`${ti(St(n))}|lt:${n.limitType}`}function ri(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>fl(r)).join(", ")}]`),$i(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(i=r).field.canonicalString()} (${i.dir})`;var i}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>rn(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>rn(r)).join(",")),`Target(${t})`}(St(n))}; limitType=${n.limitType})`}function Yi(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):V.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of ni(t))if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,s,u){const l=cl(i,s,u);return i.inclusive?l<=0:l<0}(t.startAt,ni(t),r)||t.endAt&&!function(i,s,u){const l=cl(i,s,u);return i.inclusive?l>=0:l>0}(t.endAt,ni(t),r)));var t,r}function uu(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function vl(n){return(e,t)=>{let r=!1;for(const i of ni(n)){const s=cu(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function cu(n,e,t){const r=n.field.isKeyField()?V.comparator(e.key,t.key):function(i,s,u){const l=s.data.field(i),d=u.data.field(i);return null!==l&&null!==d?Qn(l,d):j()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return j()}}class Jn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){_r(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return qo(this.inner)}size(){return this.innerSize}}const fd=new xe(V.comparator);function Vt(){return fd}const _l=new xe(V.comparator);function h(...n){let e=_l;for(const t of n)e=e.insert(t.key,t);return e}function o(n){let e=_l;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function a(){return f()}function c(){return f()}function f(){return new Jn(n=>n.toString(),(n,e)=>n.isEqual(e))}const g=new xe(V.comparator),y=new Ce(V.comparator);function _(...n){let e=y;for(const t of n)e=e.add(t);return e}const A=new Ce(ee);function b(){return A}function K(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bs(e)?"-0":e}}function G(n){return{integerValue:""+n}}function Z(n,e){return Ka(e)?G(e):K(n,e)}class re{constructor(){this._=void 0}}function ke(n,e,t){return n instanceof pn?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&zo(i)&&(i=$o(i)),i&&(s.fields.__previous_value__=i),{mapValue:s}}(t,e):n instanceof Sr?Jo(n,e):n instanceof Ar?lu(n,e):function(r,i){const s=Rt(r,i),u=hu(s)+hu(r.gt);return Ja(s)&&Ja(r.gt)?G(u):K(r.serializer,u)}(n,e)}function xt(n,e,t){return n instanceof Sr?Jo(n,e):n instanceof Ar?lu(n,e):t}function Rt(n,e){return n instanceof xr?Ja(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class pn extends re{}class Sr extends re{constructor(e){super(),this.elements=e}}function Jo(n,e){const t=Il(e);for(const r of n.elements)t.some(i=>fn(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ar extends re{constructor(e){super(),this.elements=e}}function lu(n,e){let t=Il(e);for(const r of n.elements)t=t.filter(i=>!fn(i,r));return{arrayValue:{values:t}}}class xr extends re{constructor(e,t){super(),this.serializer=e,this.gt=t}}function hu(n){return Ve(n.integerValue||n.doubleValue)}function Il(n){return Gs(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class ii{constructor(e,t){this.field=e,this.transform=t}}class lm{constructor(e,t){this.version=e,this.transformResults=t}}class Ke{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ke}static exists(e){return new Ke(void 0,e)}static updateTime(e){return new Ke(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function wl(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class El{}function Nf(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new ta(n.key,Ke.none()):new ea(n.key,n.data,Ke.none());{const t=n.data,r=yt.empty();let i=new Ce(Ae.comparator);for(let s of e.fields)if(!i.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?r.delete(s):r.set(s,u),i=i.add(s)}return new si(n.key,r,new Ut(i.toArray()),Ke.none())}}function hm(n,e,t){n instanceof ea?function(r,i,s){const u=r.value.clone(),l=Pf(r.fieldTransforms,i,s.transformResults);u.setAll(l),i.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof si?function(r,i,s){if(!wl(r.precondition,i))return void i.convertToUnknownDocument(s.version);const u=Pf(r.fieldTransforms,i,s.transformResults),l=i.data;l.setAll(Df(r)),l.setAll(u),i.convertToFoundDocument(s.version,l).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function du(n,e,t,r){return n instanceof ea?function(i,s,u,l){if(!wl(i.precondition,s))return u;const d=i.value.clone(),p=Of(i.fieldTransforms,l,s);return d.setAll(p),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof si?function(i,s,u,l){if(!wl(i.precondition,s))return u;const d=Of(i.fieldTransforms,l,s),p=s.data;return p.setAll(Df(i)),p.setAll(d),s.convertToFoundDocument(s.version,p).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(n,e,t,r):(u=t,wl(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function dm(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Rt(r.transform,i||null);null!=s&&(null===t&&(t=yt.empty()),t.set(r.field,s))}return t||null}function Rf(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Bi(t,r,(i,s)=>function pd(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof Sr&&r instanceof Sr||t instanceof Ar&&r instanceof Ar?Bi(t.elements,r.elements,fn):t instanceof xr&&r instanceof xr?fn(t.gt,r.gt):t instanceof pn&&r instanceof pn);var t,r}(i,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class ea extends El{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class si extends El{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Df(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Pf(n,e,t){const r=new Map;H(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],u=s.transform,l=e.data.field(s.field);r.set(s.field,xt(u,l,t[i]))}return r}function Of(n,e,t){const r=new Map;for(const i of n){const s=i.transform,u=t.data.field(i.field);r.set(i.field,ke(s,u,e))}return r}class ta extends El{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class gd extends El{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class md{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&hm(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=du(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=du(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=c();return this.mutations.forEach(i=>{const s=e.get(i.key),u=s.overlayedDocument;let l=this.applyToLocalView(u,s.mutatedFields);l=t.has(i.key)?null:l;const d=Nf(u,l);null!==d&&r.set(i.key,d),u.isValidDocument()||u.convertToNoDocument(Y.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_())}isEqual(e){return this.batchId===e.batchId&&Bi(this.mutations,e.mutations,(t,r)=>Rf(t,r))&&Bi(this.baseMutations,e.baseMutations,(t,r)=>Rf(t,r))}}class yd{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){H(e.mutations.length===r.length);let i=g;const s=e.mutations;for(let u=0;u<s.length;u++)i=i.insert(s[u].key,r[u].version);return new yd(e,t,r,i)}}class vd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class pm{constructor(e,t){this.count=e,this.unchangedNames=t}}var lt,ge;function Lf(n){switch(n){default:return j();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0}}function Mf(n){if(void 0===n)return Ye("GRPC error has no .code"),k.UNKNOWN;switch(n){case lt.OK:return k.OK;case lt.CANCELLED:return k.CANCELLED;case lt.UNKNOWN:return k.UNKNOWN;case lt.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case lt.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case lt.INTERNAL:return k.INTERNAL;case lt.UNAVAILABLE:return k.UNAVAILABLE;case lt.UNAUTHENTICATED:return k.UNAUTHENTICATED;case lt.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case lt.NOT_FOUND:return k.NOT_FOUND;case lt.ALREADY_EXISTS:return k.ALREADY_EXISTS;case lt.PERMISSION_DENIED:return k.PERMISSION_DENIED;case lt.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case lt.ABORTED:return k.ABORTED;case lt.OUT_OF_RANGE:return k.OUT_OF_RANGE;case lt.UNIMPLEMENTED:return k.UNIMPLEMENTED;case lt.DATA_LOSS:return k.DATA_LOSS;default:return j()}}(ge=lt||(lt={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";class _d{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Tl}static getOrCreateInstance(){return null===Tl&&(Tl=new _d),Tl}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let Tl=null;function Ff(){return new TextEncoder}const gm=new Mi([4294967295,4294967295],0);function Uf(n){const e=Ff().encode(n),t=new Ih;return t.update(e),new Uint8Array(t.digest())}function Vf(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Mi([t,r],0),new Mi([i,s],0)]}class Id{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new fu(`Invalid padding: ${t}`);if(r<0)throw new fu(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new fu(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new fu(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Mi.fromNumber(this.It)}Et(e,t,r){let i=e.add(t.multiply(Mi.fromNumber(r)));return 1===i.compare(gm)&&(i=new Mi([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=Uf(e),[r,i]=Vf(t);for(let s=0;s<this.hashCount;s++){const u=this.Et(r,i,s);if(!this.At(u))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),u=new Id(s,i,t);return r.forEach(l=>u.insert(l)),u}insert(e){if(0===this.It)return;const t=Uf(e),[r,i]=Vf(t);for(let s=0;s<this.hashCount;s++){const u=this.Et(r,i,s);this.Rt(u)}}Rt(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class fu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class pu{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,gu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new pu(Y.min(),i,new xe(ee),Vt(),_())}}class gu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new gu(r,t,_(),_(),_())}}class Sl{constructor(e,t,r,i){this.Pt=e,this.removedTargetIds=t,this.key=r,this.bt=i}}class Bf{constructor(e,t){this.targetId=e,this.Vt=t}}class qf{constructor(e,t,r=Xe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Gf{constructor(){this.St=0,this.Dt=$f(),this.Ct=Xe.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=_(),t=_(),r=_();return this.Dt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:j()}}),new gu(this.Ct,this.xt,e,t,r)}Ft(){this.Nt=!1,this.Dt=$f()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class mm{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Vt(),this.zt=zf(),this.Wt=new xe(ee)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{const r=this.Zt(t);switch(e.state){case 0:this.te(t)&&r.$t(e.resumeToken);break;case 1:r.Ut(),r.kt||r.Ft(),r.$t(e.resumeToken);break;case 2:r.Ut(),r.kt||this.removeTarget(t);break;case 3:this.te(t)&&(r.Kt(),r.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),r.$t(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((r,i)=>{this.te(i)&&t(i)})}ne(e){var t;const r=e.targetId,i=e.Vt.count,s=this.se(r);if(s){const u=s.target;if(Tr(u))if(0===i){const l=new V(u.path);this.Yt(r,l,Ee.newNoDocument(l,Y.min()))}else H(1===i);else{const l=this.ie(r);if(l!==i){const d=this.re(e,l);0!==d&&(this.ee(r),this.Wt=this.Wt.insert(r,2===d?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=_d.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(p,m,v){var E,S,D,U,q,te;const ie={localCacheCount:m,existenceFilterCount:v.count},Q=v.unchangedNames;return Q&&(ie.bloomFilter={applied:0===p,hashCount:null!==(E=Q?.hashCount)&&void 0!==E?E:0,bitmapLength:null!==(U=null===(D=null===(S=Q?.bits)||void 0===S?void 0:S.bitmap)||void 0===D?void 0:D.length)&&void 0!==U?U:0,padding:null!==(te=null===(q=Q?.bits)||void 0===q?void 0:q.padding)&&void 0!==te?te:0}),ie}(d,l,e.Vt))}}}}re(e,t){const{unchangedNames:r,count:i}=e.Vt;if(!r||!r.bits)return 1;const{bits:{bitmap:s="",padding:u=0},hashCount:l=0}=r;let d,p;try{d=Wn(s).toUint8Array()}catch(m){if(m instanceof sd)return nn("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw m}try{p=new Id(d,u,l)}catch(m){return nn(m instanceof fu?"BloomFilter error: ":"Applying bloom filter failed: ",m),1}return 0===p.It?1:i!==t-this.oe(e.targetId,p)?2:0}oe(e,t){const r=this.Gt.getRemoteKeysForTarget(e);let i=0;return r.forEach(s=>{const u=this.Gt.ue(),l=`projects/${u.projectId}/databases/${u.database}/documents/${s.path.canonicalString()}`;t.vt(l)||(this.Yt(e,s,null),i++)}),i}ce(e){const t=new Map;this.Qt.forEach((s,u)=>{const l=this.se(u);if(l){if(s.current&&Tr(l.target)){const d=new V(l.target.path);null!==this.jt.get(d)||this.ae(u,d)||this.Yt(u,d,Ee.newNoDocument(d,e))}s.Mt&&(t.set(u,s.Ot()),s.Ft())}});let r=_();this.zt.forEach((s,u)=>{let l=!0;u.forEachWhile(d=>{const p=this.se(d);return!p||"TargetPurposeLimboResolution"===p.purpose||(l=!1,!1)}),l&&(r=r.add(s))}),this.jt.forEach((s,u)=>u.setReadTime(e));const i=new pu(e,t,this.Wt,this.jt,r);return this.jt=Vt(),this.zt=zf(),this.Wt=new xe(ee),i}Jt(e,t){if(!this.te(e))return;const r=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,r),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,r){if(!this.te(e))return;const i=this.Zt(e);this.ae(e,t)?i.Bt(t,1):i.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),r&&(this.jt=this.jt.insert(t,r))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new Gf,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Ce(ee),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||M("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new Gf),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function zf(){return new xe(V.comparator)}function $f(){return new xe(V.comparator)}const ym={asc:"ASCENDING",desc:"DESCENDING"},vm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_m={and:"AND",or:"OR"};class Im{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function wd(n,e){return n.useProto3Json||$i(e)?e:{value:e}}function na(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jf(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function wm(n,e){return na(n,e.toTimestamp())}function nt(n){return H(!!n),Y.fromTimestamp(function(e){const t=Kn(e);return new Oe(t.seconds,t.nanos)}(n))}function Ed(n,e){return(t=n,new oe(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Kf(n){const e=oe.fromString(n);return H(tp(e)),e}function mu(n,e){return Ed(n.databaseId,e.path)}function Cr(n,e){const t=Kf(e);if(t.get(1)!==n.databaseId.projectId)throw new P(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new P(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new V(Zf(t))}function Td(n,e){return Ed(n.databaseId,e)}function Wf(n){const e=Kf(n);return 4===e.length?oe.emptyPath():Zf(e)}function yu(n){return new oe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Zf(n){return H(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Hf(n,e,t){return{name:mu(n,e),fields:t.value.mapValue.fields}}function Qf(n,e,t){const r=Cr(n,e.name),i=nt(e.updateTime),s=e.createTime?nt(e.createTime):Y.min(),u=new yt({mapValue:{fields:e.fields}}),l=Ee.newFoundDocument(r,i,s,u);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function vu(n,e){let t;if(e instanceof ea)t={update:Hf(n,e.key,e.value)};else if(e instanceof ta)t={delete:mu(n,e.key)};else if(e instanceof si)t={update:Hf(n,e.key,e.data),updateMask:bm(e.fieldMask)};else{if(!(e instanceof gd))return j();t={verify:mu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const u=s.transform;if(u instanceof pn)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Sr)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ar)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof xr)return{fieldPath:s.field.canonicalString(),increment:u.gt};throw j()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:wm(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:j()),t;var i}function Sd(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?Ke.updateTime(nt(i.updateTime)):void 0!==i.exists?Ke.exists(i.exists):Ke.none():Ke.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,u){let l=null;"setToServerValue"in u?(H("REQUEST_TIME"===u.setToServerValue),l=new pn):"appendMissingElements"in u?l=new Sr(u.appendMissingElements.values||[]):"removeAllFromArray"in u?l=new Ar(u.removeAllFromArray.values||[]):"increment"in u?l=new xr(s,u.increment):j();const d=Ae.fromServerFormat(u.fieldPath);return new ii(d,l)}(n,i)):[];var i;if(e.update){const i=Cr(n,e.update.name),s=new yt({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new Ut((e.updateMask.fieldPaths||[]).map(p=>Ae.fromServerFormat(p)));return new si(i,s,u,t,r)}return new ea(i,s,t,r)}if(e.delete){const i=Cr(n,e.delete);return new ta(i,t)}if(e.verify){const i=Cr(n,e.verify);return new gd(i,t)}return j()}function Yf(n,e){return{documents:[Td(n,e.path)]}}function Ad(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Td(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Td(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0!==d.length)return ep(_e.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(d){if(0!==d.length)return d.map(p=>{return{field:Xi((m=p).field),direction:xm(m.dir)};var m})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=wd(n,e.limit);var l,d;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(l=e.startAt).inclusive,values:l.position}),e.endAt&&(t.structuredQuery.endAt={before:!(d=e.endAt).inclusive,values:d.position}),t}function Xf(n){let e=Wf(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){H(1===r);const m=t.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let s=[];t.where&&(s=function(m){const v=Jf(m);return v instanceof _e&&Ho(v)?v.getFilters():[v]}(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(m=>{return new Wi(ra((v=m).field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction));var v}));let l=null;t.limit&&(l=function(m){let v;return v="object"==typeof m?m.value:m,$i(v)?null:v}(t.limit));let d=null;var m;t.startAt&&(d=new Er((m=t.startAt).values||[],!!m.before));let p=null;return t.endAt&&(p=function(m){return new Er(m.values||[],!m.before)}(t.endAt)),ou(e,i,u,s,l,"F",d,p)}function Jf(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ra(e.unaryFilter.field);return ae.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=ra(e.unaryFilter.field);return ae.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ra(e.unaryFilter.field);return ae.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ra(e.unaryFilter.field);return ae.create(s,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(n):void 0!==n.fieldFilter?ae.create(ra((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return _e.create(e.compositeFilter.filters.map(t=>Jf(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return j()}}(e.compositeFilter.op))}(n):j();var e}function xm(n){return ym[n]}function Cm(n){return vm[n]}function km(n){return _m[n]}function Xi(n){return{fieldPath:n.canonicalString()}}function ra(n){return Ae.fromServerFormat(n.fieldPath)}function ep(n){return n instanceof ae?function(e){if("=="===e.op){if(ol(e.value))return{unaryFilter:{field:Xi(e.field),op:"IS_NAN"}};if(sl(e.value))return{unaryFilter:{field:Xi(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ol(e.value))return{unaryFilter:{field:Xi(e.field),op:"IS_NOT_NAN"}};if(sl(e.value))return{unaryFilter:{field:Xi(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xi(e.field),op:Cm(e.op),value:e.value}}}(n):n instanceof _e?function(e){const t=e.getFilters().map(r=>ep(r));return 1===t.length?t[0]:{compositeFilter:{op:km(e.op),filters:t}}}(n):j()}function bm(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function tp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class oi{constructor(e,t,r,i,s=Y.min(),u=Y.min(),l=Xe.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(e){return new oi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new oi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new oi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new oi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class np{constructor(e){this.fe=e}}function rp(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Al(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:mu(i=n.fe,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:na(i,s.version.toTimestamp()),createTime:na(i,s.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ws(e.version)};else{if(!e.isUnknownDocument())return j();r.unknownDocument={path:t.path.toArray(),version:Ws(e.version)}}var i,s;return r}function Al(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ws(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Zs(n){const e=new Oe(n.seconds,n.nanoseconds);return Y.fromTimestamp(e)}function Hs(n,e){const t=(e.baseMutations||[]).map(s=>Sd(n.fe,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Sd(n.fe,s)),i=Oe.fromMillis(e.localWriteTimeMs);return new md(e.batchId,i,t,r)}function _u(n){const e=Zs(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Zs(n.lastLimboFreeSnapshotVersion):Y.min();let r;var i;return void 0!==n.query.documents?(H(1===(i=n.query).documents.length),r=St(Hi(Wf(i.documents[0])))):r=St(Xf(n.query)),new oi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Xe.fromBase64String(n.resumeToken))}function ip(n,e){const t=Ws(e.snapshotVersion),r=Ws(e.lastLimboFreeSnapshotVersion);let i;i=Tr(e.target)?Yf(n.fe,e.target):Ad(n.fe,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ti(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function xd(n){const e=Xf({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Qi(e,e.limit,"L"):e}function Cd(n,e){return new vd(e.largestBatchId,Sd(n.fe,e.overlayMutation))}function sp(n,e){const t=e.path.lastSegment();return[n,gt(e.path.popLast()),t]}function op(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Ws(r.readTime),documentKey:gt(r.documentKey.path),largestBatchId:r.largestBatchId}}class Rm{getBundleMetadata(e,t){return ap(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:Zs(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return ap(e).put({bundleId:(r=t).id,createTime:Ws(nt(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return up(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:xd(i.bundledQuery),readTime:Zs(i.readTime)};var i})}saveNamedQuery(e,t){return up(e).put({name:(r=t).name,readTime:Ws(nt(r.readTime)),bundledQuery:r.bundledQuery});var r}}function ap(n){return ct(n,"bundles")}function up(n){return ct(n,"namedQueries")}class xl{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){return new xl(e,t.uid||"")}getOverlay(e,t){return Iu(e).get(sp(this.userId,t)).next(r=>r?Cd(this.serializer,r):null)}getOverlays(e,t){const r=a();return x.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,u)=>{const l=new vd(t,u);i.push(this.we(e,l))}),x.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(u=>i.add(gt(u.getCollectionPath())));const s=[];return i.forEach(u=>{const l=IDBKeyRange.bound([this.userId,u,r],[this.userId,u,r+1],!1,!0);s.push(Iu(e).J("collectionPathOverlayIndex",l))}),x.waitFor(s)}getOverlaysForCollection(e,t,r){const i=a(),s=gt(t),u=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Iu(e).j("collectionPathOverlayIndex",u).next(l=>{for(const d of l){const p=Cd(this.serializer,d);i.set(p.getKey(),p)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=a();let u;const l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Iu(e).X({index:"collectionGroupOverlayIndex",range:l},(d,p,m)=>{const v=Cd(this.serializer,p);s.size()<i||v.largestBatchId===u?(s.set(v.getKey(),v),u=v.largestBatchId):m.done()}).next(()=>s)}we(e,t){return Iu(e).put(function(r,i,s){const[u,l,d]=sp(i,s.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:vu(r.fe,s.mutation)}}(this.serializer,this.userId,t))}}function Iu(n){return ct(n,"documentOverlays")}class Qs{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(Ve(e.integerValue));else if("doubleValue"in e){const r=Ve(e.doubleValue);isNaN(r)?this.ye(t,13):(this.ye(t,15),Bs(r)?t.pe(0):t.pe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ye(t,20),"string"==typeof r?t.Ie(r):(t.Ie(`${r.seconds||""}`),t.pe(r.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(Wn(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ye(t,45),t.pe(r.latitude||0),t.pe(r.longitude||0)}else"mapValue"in e?al(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):j()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const r=e.fields||{};this.ye(t,55);for(const i of Object.keys(r))this.Te(i,t),this.me(r[i],t)}Pe(e,t){const r=e.values||[];this.ye(t,50);for(const i of r)this.me(i,t)}ve(e,t){this.ye(t,37),V.fromName(e).path.forEach(r=>{this.ye(t,60),this.be(r,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function Dm(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function cp(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const s=Dm(255&t[i]);if(r+=s,8!==s)break}return r}(n);return Math.ceil(e/8)}Qs.Ve=new Qs;class Pm{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.De(r.value),r=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ne(r.value),r=t.next();this.ke()}Me(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.De(r);else if(r<2048)this.De(960|r>>>6),this.De(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.De(480|r>>>12),this.De(128|63&r>>>6),this.De(128|63&r);else{const i=t.codePointAt(0);this.De(240|i>>>18),this.De(128|63&i>>>12),this.De(128|63&i>>>6),this.De(128|63&i)}}this.Ce()}$e(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ne(r);else if(r<2048)this.Ne(960|r>>>6),this.Ne(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|r>>>12),this.Ne(128|63&r>>>6),this.Ne(128|63&r);else{const i=t.codePointAt(0);this.Ne(240|i>>>18),this.Ne(128|63&i>>>12),this.Ne(128|63&i>>>6),this.Ne(128|63&i)}}this.ke()}Oe(e){const t=this.Fe(e),r=cp(t);this.Be(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Le(e){const t=this.Fe(e),r=cp(t);this.Be(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Om{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class Lm{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class wu{constructor(){this.je=new Pm,this.ze=new Om(this.je),this.We=new Lm(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Ys{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ys(this.indexId,this.documentKey,this.arrayValue,r)}}function Ji(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=lp(n.arrayValue,e.arrayValue),0!==t?t:(t=lp(n.directionalValue,e.directionalValue),0!==t?t:V.comparator(n.documentKey,e.documentKey)))}function lp(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Mm{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const r=t;r.isInequality()?this.Ze=r:this.Xe.push(r)}}tn(e){H(e.collectionGroup===this.collectionId);const t=za(e);if(void 0!==t&&!this.en(t))return!1;const r=Yr(e);let i=new Set,s=0,u=0;for(;s<r.length&&this.en(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(void 0!==this.Ze){if(!i.has(this.Ze.field.canonicalString())){const l=r[s];if(!this.nn(this.Ze,l)||!this.sn(this.Ye[u++],l))return!1}++s}for(;s<r.length;++s)if(u>=this.Ye.length||!this.sn(this.Ye[u++],r[s]))return!1;return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function hp(n){var e,t;if(H(n instanceof ae||n instanceof _e),n instanceof ae){if(n instanceof nu){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>ae.create(n.field,"==",s)))||[];return _e.create(i,"or")}return n}const r=n.filters.map(i=>hp(i));return _e.create(r,n.op)}function Fm(n){if(0===n.getFilters().length)return[];const e=Nd(hp(n));return H(dp(e)),kd(e)||bd(e)?[e]:e.getFilters()}function kd(n){return n instanceof ae}function bd(n){return n instanceof _e&&Ho(n)}function dp(n){return kd(n)||bd(n)||function(e){if(e instanceof _e&&Zo(e)){for(const t of e.getFilters())if(!kd(t)&&!bd(t))return!1;return!0}return!1}(n)}function Nd(n){if(H(n instanceof ae||n instanceof _e),n instanceof ae)return n;if(1===n.filters.length)return Nd(n.filters[0]);const e=n.filters.map(r=>Nd(r));let t=_e.create(e,n.op);return t=Cl(t),dp(t)?t:(H(t instanceof _e),H(ei(t)),H(t.filters.length>1),t.filters.reduce((r,i)=>Rd(r,i)))}function Rd(n,e){let t;return H(n instanceof ae||n instanceof _e),H(e instanceof ae||e instanceof _e),t=n instanceof ae?e instanceof ae?_e.create([n,e],"and"):fp(n,e):e instanceof ae?fp(e,n):function(r,i){if(H(r.filters.length>0&&i.filters.length>0),ei(r)&&ei(i))return Zi(r,i.getFilters());const s=Zo(r)?r:i,u=Zo(r)?i:r,l=s.filters.map(d=>Rd(d,u));return _e.create(l,"or")}(n,e),Cl(t)}function fp(n,e){if(ei(e))return Zi(e,n.getFilters());{const t=e.filters.map(r=>Rd(n,r));return _e.create(t,"or")}}function Cl(n){if(H(n instanceof ae||n instanceof _e),n instanceof ae)return n;const e=n.getFilters();if(1===e.length)return Cl(e[0]);if(hl(n))return n;const t=e.map(i=>Cl(i)),r=[];return t.forEach(i=>{i instanceof ae?r.push(i):i instanceof _e&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:_e.create(r,n.op)}class Um{constructor(){this.rn=new Dd}addToCollectionParentIndex(e,t){return this.rn.add(t),x.resolve()}getCollectionParents(e,t){return x.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return x.resolve()}deleteFieldIndex(e,t){return x.resolve()}getDocumentsMatchingTarget(e,t){return x.resolve(null)}getIndexType(e,t){return x.resolve(0)}getFieldIndexes(e,t){return x.resolve([])}getNextCollectionGroupToUpdate(e){return x.resolve(null)}getMinOffset(e,t){return x.resolve(Nt.min())}getMinOffsetFromCollectionGroup(e,t){return x.resolve(Nt.min())}updateCollectionGroup(e,t,r){return x.resolve()}updateIndexEntries(e,t){return x.resolve()}}class Dd{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ce(oe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ce(oe.comparator)).toArray()}}const kl=new Uint8Array(0);class Vm{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Dd,this.un=new Jn(r=>ti(r),(r,i)=>vt(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});const s={collectionId:r,parent:gt(i)};return pp(e).put(s)}return x.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Fo(t),""],!1,!0);return pp(e).j(i).next(s=>{for(const u of s){if(u.collectionId!==t)break;r.push(dn(u.parent))}return r})}addFieldIndex(e,t){const r=bl(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])};var u;delete i.indexId;const s=r.add(i);if(t.indexState){const u=Tu(e);return s.next(l=>{u.put(op(l,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=bl(e),i=Tu(e),s=Eu(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=Eu(e);let i=!0;const s=new Map;return x.forEach(this.cn(t),u=>this.an(e,u).next(l=>{i&&(i=!!l),s.set(u,l)})).next(()=>{if(i){let u=_();const l=[];return x.forEach(s,(d,p)=>{var m;M("IndexedDbIndexManager",`Using index ${m=d,`id=${m.indexId}|cg=${m.collectionGroup}|f=${m.fields.map(Q=>`${Q.fieldPath}:${Q.kind}`).join(",")}`} to execute ${ti(t)}`);const v=function(Q,se){const de=za(se);if(void 0===de)return null;for(const Le of js(Q,de.fieldPath))switch(Le.op){case"array-contains-any":return Le.value.arrayValue.values||[];case"array-contains":return[Le.value]}return null}(p,d),E=function(Q,se){const de=new Map;for(const Le of Yr(se))for(const Pt of js(Q,Le.fieldPath))switch(Pt.op){case"==":case"in":de.set(Le.fieldPath.canonicalString(),Pt.value);break;case"not-in":case"!=":return de.set(Le.fieldPath.canonicalString(),Pt.value),Array.from(de.values())}return null}(p,d),S=function(Q,se){const de=[];let Le=!0;for(const Pt of Yr(se)){const er=0===Pt.kind?yl(Q,Pt.fieldPath,Q.startAt):Qo(Q,Pt.fieldPath,Q.startAt);de.push(er.value),Le&&(Le=er.inclusive)}return new Er(de,Le)}(p,d),D=function(Q,se){const de=[];let Le=!0;for(const Pt of Yr(se)){const er=0===Pt.kind?Qo(Q,Pt.fieldPath,Q.endAt):yl(Q,Pt.fieldPath,Q.endAt);de.push(er.value),Le&&(Le=er.inclusive)}return new Er(de,Le)}(p,d),U=this.hn(d,p,S),q=this.hn(d,p,D),te=this.ln(d,p,E),ie=this.fn(d.indexId,v,U,S.inclusive,q,D.inclusive,te);return x.forEach(ie,Q=>r.H(Q,t.limit).next(se=>{se.forEach(de=>{const Le=V.fromSegments(de.documentKey);u.has(Le)||(u=u.add(Le),l.push(Le))})}))}).next(()=>l)}return x.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Fm(_e.create(e.filters,"and")).map(r=>su(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}fn(e,t,r,i,s,u,l){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),p=d/(null!=t?t.length:1),m=[];for(let v=0;v<d;++v){const E=t?this.dn(t[v/p]):kl,S=this.wn(e,E,r[v%p],i),D=this._n(e,E,s[v%p],u),U=l.map(q=>this.wn(e,E,q,!0));m.push(...this.createRange(S,D,U))}return m}wn(e,t,r,i){const s=new Ys(e,V.empty(),t,r);return i?s:s.Je()}_n(e,t,r,i){const s=new Ys(e,V.empty(),t,r);return i?s.Je():s}an(e,t){const r=new Mm(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let u=null;for(const l of s)r.tn(l)&&(!u||l.fields.length>u.fields.length)&&(u=l);return u})}getIndexType(e,t){let r=2;const i=this.cn(t);return x.forEach(i,s=>this.an(e,s).next(u=>{u?0!==r&&u.fields.length<function(l){let d=new Ce(Ae.comparator),p=!1;for(const m of l.filters)for(const v of m.getFlattenedFilters())v.field.isKeyField()||("array-contains"===v.op||"array-contains-any"===v.op?p=!0:d=d.add(v.field));for(const m of l.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(p?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}mn(e,t){const r=new wu;for(const i of Yr(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const u=r.He(i.kind);Qs.Ve._e(s,u)}return r.Qe()}dn(e){const t=new wu;return Qs.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const r=new wu;return Qs.Ve._e(Jr(this.databaseId,t),r.He(function(i){const s=Yr(i);return 0===s.length?0:s[s.length-1].kind}(e))),r.Qe()}ln(e,t,r){if(null===r)return[];let i=[];i.push(new wu);let s=0;for(const u of Yr(e)){const l=r[s++];for(const d of i)if(this.yn(t,u.fieldPath)&&Gs(l))i=this.pn(i,u,l);else{const p=d.He(u.kind);Qs.Ve._e(l,p)}}return this.In(i)}hn(e,t,r){return this.ln(e,t,r.position)}In(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Qe();return t}pn(e,t,r){const i=[...e],s=[];for(const u of r.arrayValue.values||[])for(const l of i){const d=new wu;d.seed(l.Qe()),Qs.Ve._e(u,d.He(t.kind)),s.push(d)}return s}yn(e,t){return!!e.filters.find(r=>r instanceof ae&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=bl(e),i=Tu(e);return(t?r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.j()).next(s=>{const u=[];return x.forEach(s,l=>i.get([l.indexId,this.uid]).next(d=>{u.push(function(p,m){const v=m?new Vs(m.sequenceNumber,new Nt(Zs(m.readTime),new V(dn(m.documentKey)),m.largestBatchId)):Vs.empty(),E=p.fields.map(([S,D])=>new Us(Ae.fromServerFormat(S),D));return new qi(p.indexId,p.collectionGroup,E,v)}(l,d))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:ee(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=bl(e),s=Tu(e);return this.Tn(e).next(u=>i.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>x.forEach(l,d=>s.put(op(d.indexId,this.user,u,r)))))}updateIndexEntries(e,t){const r=new Map;return x.forEach(t,(i,s)=>{const u=r.get(i.collectionGroup);return(u?x.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),x.forEach(l,d=>this.En(e,i,d).next(p=>{const m=this.An(s,d);return p.isEqual(m)?x.resolve():this.vn(e,s,d,p,m)}))))})}Rn(e,t,r,i){return Eu(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.gn(r,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,r,i){return Eu(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.gn(r,t.key),t.key.path.toArray()])}En(e,t,r){const i=Eu(e);let s=new Ce(Ji);return i.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.gn(r,t)])},(u,l)=>{s=s.add(new Ys(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>s)}An(e,t){let r=new Ce(Ji);const i=this.mn(t,e);if(null==i)return r;const s=za(t);if(null!=s){const u=e.data.field(s.fieldPath);if(Gs(u))for(const l of u.arrayValue.values||[])r=r.add(new Ys(t.indexId,e.key,this.dn(l),i))}else r=r.add(new Ys(t.indexId,e.key,kl,i));return r}vn(e,t,r,i,s){M("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(l,d,p,m,v){const E=l.getIterator(),S=d.getIterator();let D=Ir(E),U=Ir(S);for(;D||U;){let q=!1,te=!1;if(D&&U){const ie=p(D,U);ie<0?te=!0:ie>0&&(q=!0)}else null!=D?te=!0:q=!0;q?(m(U),U=Ir(S)):te?(v(D),D=Ir(E)):(D=Ir(E),U=Ir(S))}}(i,s,Ji,l=>{u.push(this.Rn(e,t,r,l))},l=>{u.push(this.Pn(e,t,r,l))}),x.waitFor(u)}Tn(e){let t=1;return Tu(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((u,l)=>Ji(u,l)).filter((u,l,d)=>!l||0!==Ji(u,d[l-1]));const i=[];i.push(e);for(const u of r){const l=Ji(u,e),d=Ji(u,t);if(0===l)i[0]=e.Je();else if(l>0&&d<0)i.push(u),i.push(u.Je());else if(d>0)break}i.push(t);const s=[];for(let u=0;u<i.length;u+=2){if(this.bn(i[u],i[u+1]))return[];s.push(IDBKeyRange.bound([i[u].indexId,this.uid,i[u].arrayValue,i[u].directionalValue,kl,[]],[i[u+1].indexId,this.uid,i[u+1].arrayValue,i[u+1].directionalValue,kl,[]]))}return s}bn(e,t){return Ji(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(gp)}getMinOffset(e,t){return x.mapArray(this.cn(t),r=>this.an(e,r).next(i=>i||j())).next(gp)}}function pp(n){return ct(n,"collectionParents")}function Eu(n){return ct(n,"indexEntries")}function bl(n){return ct(n,"indexConfiguration")}function Tu(n){return ct(n,"indexState")}function gp(n){H(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;$a(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Nt(e.readTime,e.documentKey,t)}const mp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Bt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Bt(e,Bt.DEFAULT_COLLECTION_PERCENTILE,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function yp(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let l=0;const d=r.X({range:u},(m,v,E)=>(l++,E.delete()));s.push(d.next(()=>{H(1===l)}));const p=[];for(const m of t.mutations){const v=Jc(e,m.key.path,t.batchId);s.push(i.delete(v)),p.push(m.key)}return x.waitFor(s).next(()=>p)}function Nl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw j();e=n.noDocument}return JSON.stringify(e).length}Bt.DEFAULT_COLLECTION_PERCENTILE=10,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bt.DEFAULT=new Bt(41943040,Bt.DEFAULT_COLLECTION_PERCENTILE,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bt.DISABLED=new Bt(-1,0,0);class Rl{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Vn={}}static de(e,t,r,i){H(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Rl(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return es(e).X({index:"userMutationsIndex",range:r},(i,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=ia(e),u=es(e);return u.add({}).next(l=>{H("number"==typeof l);const d=new md(l,t,r,i),p=function(E,S,D){const U=D.baseMutations.map(te=>vu(E.fe,te)),q=D.mutations.map(te=>vu(E.fe,te));return{userId:S,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:U,mutations:q}}(this.serializer,this.userId,d),m=[];let v=new Ce((E,S)=>ee(E.canonicalString(),S.canonicalString()));for(const E of i){const S=Jc(this.userId,E.key.path,l);v=v.add(E.key.path.popLast()),m.push(u.put(p)),m.push(s.put(S,$h))}return v.forEach(E=>{m.push(this.indexManager.addToCollectionParentIndex(e,E))}),e.addOnCommittedListener(()=>{this.Vn[l]=d.keys()}),x.waitFor(m).next(()=>d)})}lookupMutationBatch(e,t){return es(e).get(t).next(r=>r?(H(r.userId===this.userId),Hs(this.serializer,r)):null)}Sn(e,t){return this.Vn[t]?x.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Vn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return es(e).X({index:"userMutationsIndex",range:i},(u,l,d)=>{l.userId===this.userId&&(H(l.batchId>=r),s=Hs(this.serializer,l)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return es(e).X({index:"userMutationsIndex",range:t,reverse:!0},(i,s,u)=>{r=s.batchId,u.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return es(e).j("userMutationsIndex",t).next(r=>r.map(i=>Hs(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Vo(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ia(e).X({range:i},(u,l,d)=>{const[p,m,v]=u,E=dn(m);if(p===this.userId&&t.path.isEqual(E))return es(e).get(v).next(S=>{if(!S)throw j();H(S.userId===this.userId),s.push(Hs(this.serializer,S))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(ee);const i=[];return t.forEach(s=>{const u=Vo(this.userId,s.path),l=IDBKeyRange.lowerBound(u),d=ia(e).X({range:l},(p,m,v)=>{const[E,S,D]=p,U=dn(S);E===this.userId&&s.path.isEqual(U)?r=r.add(D):v.done()});i.push(d)}),x.waitFor(i).next(()=>this.Dn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Vo(this.userId,r),u=IDBKeyRange.lowerBound(s);let l=new Ce(ee);return ia(e).X({range:u},(d,p,m)=>{const[v,E,S]=d,D=dn(E);v===this.userId&&r.isPrefixOf(D)?D.length===i&&(l=l.add(S)):m.done()}).next(()=>this.Dn(e,l))}Dn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(es(e).get(s).next(u=>{if(null===u)throw j();H(u.userId===this.userId),r.push(Hs(this.serializer,u))}))}),x.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return yp(e.ht,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),x.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return x.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return ia(e).X({range:r},(s,u,l)=>{if(s[0]===this.userId){const d=dn(s[1]);i.push(d)}else l.done()}).next(()=>{H(0===i.length)})})}containsKey(e,t){return vp(e,this.userId,t)}xn(e){return _p(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function vp(n,e,t){const r=Vo(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let u=!1;return ia(n).X({range:s,Y:!0},(l,d,p)=>{const[m,v,E]=l;m===e&&v===i&&(u=!0),p.done()}).next(()=>u)}function es(n){return ct(n,"mutations")}function ia(n){return ct(n,"documentMutations")}function _p(n){return ct(n,"mutationQueues")}class Xs{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Xs(0)}static Mn(){return new Xs(-1)}}class Bm{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next(t=>{const r=new Xs(t.highestTargetId);return t.highestTargetId=r.next(),this.On(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.$n(e).next(t=>Y.fromTimestamp(new Oe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.$n(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.$n(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.On(e,i)))}addTargetData(e,t){return this.Fn(e,t).next(()=>this.$n(e).next(r=>(r.targetCount+=1,this.Bn(t,r),this.On(e,r))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>sa(e).delete(t.targetId)).next(()=>this.$n(e)).next(r=>(H(r.targetCount>0),r.targetCount-=1,this.On(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return sa(e).X((u,l)=>{const d=_u(l);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>x.waitFor(s)).next(()=>i)}forEachTarget(e,t){return sa(e).X((r,i)=>{const s=_u(i);t(s)})}$n(e){return Ip(e).get("targetGlobalKey").next(t=>(H(null!==t),t))}On(e,t){return Ip(e).put("targetGlobalKey",t)}Fn(e,t){return sa(e).put(ip(this.serializer,t))}Bn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.$n(e).next(t=>t.targetCount)}getTargetData(e,t){const r=ti(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return sa(e).X({range:i,index:"queryTargetsIndex"},(u,l,d)=>{const p=_u(l);vt(t,p.target)&&(s=p,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=ts(e);return t.forEach(u=>{const l=gt(u.path);i.push(s.put({targetId:r,path:l})),i.push(this.referenceDelegate.addReference(e,r,u))}),x.waitFor(i)}removeMatchingKeys(e,t,r){const i=ts(e);return x.forEach(t,s=>{const u=gt(s.path);return x.waitFor([i.delete([r,u]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=ts(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ts(e);let s=_();return i.X({range:r,Y:!0},(u,l,d)=>{const p=dn(u[1]),m=new V(p);s=s.add(m)}).next(()=>s)}containsKey(e,t){const r=gt(t.path),i=IDBKeyRange.bound([r],[Fo(r)],!1,!0);let s=0;return ts(e).X({index:"documentTargetsIndex",Y:!0,range:i},([u,l],d,p)=>{0!==u&&(s++,p.done())}).next(()=>s>0)}le(e,t){return sa(e).get(t).next(r=>r?_u(r):null)}}function sa(n){return ct(n,"targets")}function Ip(n){return ct(n,"targetGlobal")}function ts(n){return ct(n,"targetDocuments")}function wp([n,e],[t,r]){const i=ee(n,t);return 0===i?ee(e,r):i}class qm{constructor(e){this.Ln=e,this.buffer=new Ce(wp),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();wp(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ep{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){var t=this;M("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,N.Z)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){vr(r)?M("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield yr(r)}yield t.Qn(3e5)}))}}class Gm{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return x.resolve(Tt.ct);const r=new qm(t);return this.jn.forEachTarget(e,i=>r.Kn(i.sequenceNumber)).next(()=>this.jn.Wn(e,i=>r.Kn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector","Garbage collection skipped; disabled"),x.resolve(mp)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),mp):this.Hn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let r,i,s,u,l,d,p;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(v=>(v>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),i=this.params.maximumSequenceNumbersToCollect):i=v,u=Date.now(),this.nthSequenceNumber(e,i))).next(v=>(r=v,l=Date.now(),this.removeTargets(e,r,t))).next(v=>(s=v,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(v=>(p=Date.now(),Mo()<=Ot.in.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-m}ms\n\tDetermined least recently used ${i} in `+(l-u)+`ms\n\tRemoved ${s} targets in `+(d-l)+`ms\n\tRemoved ${v} documents in `+(p-d)+`ms\nTotal Duration: ${p-m}ms`),x.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:v})))}}class zm{constructor(e,t){this.db=e,this.garbageCollector=function Tp(n,e){return new Gm(n,e)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Jn(e){let t=0;return this.Wn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,(r,i)=>t(i))}addReference(e,t,r){return Dl(e,r)}removeReference(e,t,r){return Dl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Dl(e,t)}Xn(e,t){return function(r,i){let s=!1;return _p(r).Z(u=>vp(r,u,i).next(l=>(l&&(s=!0),x.resolve(!l)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Yn(e,(u,l)=>{if(l<=t){const d=this.Xn(e,u).next(p=>{if(!p)return s++,r.getEntry(e,u).next(()=>(r.removeEntry(u,Y.min()),ts(e).delete([0,gt(u.path)])))});i.push(d)}}).next(()=>x.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Dl(e,t)}Yn(e,t){const r=ts(e);let i,s=Tt.ct;return r.X({index:"documentTargetsIndex"},([u,l],{path:d,sequenceNumber:p})=>{0===u?(s!==Tt.ct&&t(new V(dn(i)),s),s=p,i=d):s=Tt.ct}).next(()=>{s!==Tt.ct&&t(new V(dn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Dl(n,e){return ts(n).put((r=n.currentSequenceNumber,{targetId:0,path:gt(e.path),sequenceNumber:r}));var r}class Sp{constructor(){this.changes=new Jn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ee.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?x.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class $m{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Js(e).put(r)}removeEntry(e,t,r){return Js(e).delete(function(i,s){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Al(s),u[u.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Zn(e,r)))}getEntry(e,t){let r=Ee.newInvalidDocument(t);return Js(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Su(t))},(i,s)=>{r=this.ts(t,s)}).next(()=>r)}es(e,t){let r={size:0,document:Ee.newInvalidDocument(t)};return Js(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Su(t))},(i,s)=>{r={document:this.ts(t,s),size:Nl(s)}}).next(()=>r)}getEntries(e,t){let r=Vt();return this.ns(e,t,(i,s)=>{const u=this.ts(i,s);r=r.insert(i,u)}).next(()=>r)}ss(e,t){let r=Vt(),i=new xe(V.comparator);return this.ns(e,t,(s,u)=>{const l=this.ts(s,u);r=r.insert(s,l),i=i.insert(s,Nl(u))}).next(()=>({documents:r,rs:i}))}ns(e,t,r){if(t.isEmpty())return x.resolve();let i=new Ce(kp);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(Su(i.first()),Su(i.last())),u=i.getIterator();let l=u.getNext();return Js(e).X({index:"documentKeyIndex",range:s},(d,p,m)=>{const v=V.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;l&&kp(l,v)<0;)r(l,null),l=u.getNext();l&&l.isEqual(v)&&(r(l,p),l=u.hasNext()?u.getNext():null),l?m.G(Su(l)):m.done()}).next(()=>{for(;l;)r(l,null),l=u.hasNext()?u.getNext():null})}getDocumentsMatchingQuery(e,t,r,i){const s=t.path,u=[s.popLast().toArray(),s.lastSegment(),Al(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Js(e).j(IDBKeyRange.bound(u,l,!0)).next(d=>{let p=Vt();for(const m of d){const v=this.ts(V.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);v.isFoundDocument()&&(Yi(t,v)||i.has(v.key))&&(p=p.insert(v.key,v))}return p})}getAllFromCollectionGroup(e,t,r,i){let s=Vt();const u=Cp(t,r),l=Cp(t,Nt.max());return Js(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,l,!0)},(d,p,m)=>{const v=this.ts(V.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);s=s.insert(v.key,v),s.size===i&&m.done()}).next(()=>s)}newChangeBuffer(e){return new jm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return xp(e).get("remoteDocumentGlobalKey").next(t=>(H(!!t),t))}Zn(e,t){return xp(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const r=function Nm(n,e){let t;if(e.document)t=Qf(n.fe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=V.fromSegments(e.noDocument.path),i=Zs(e.noDocument.readTime);t=Ee.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return j();{const r=V.fromSegments(e.unknownDocument.path),i=Zs(e.unknownDocument.version);t=Ee.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new Oe(r[0],r[1]);return Y.fromTimestamp(i)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(Y.min()))return r}return Ee.newInvalidDocument(e)}}function Ap(n){return new $m(n)}class jm extends Sp{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new Jn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Ce((s,u)=>ee(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const l=this.us.get(s);if(t.push(this.os.removeEntry(e,s,l.readTime)),u.isValidDocument()){const d=rp(this.os.serializer,u);i=i.add(s.path.popLast());const p=Nl(d);r+=p-l.size,t.push(this.os.addEntry(e,s,d))}else if(r-=l.size,this.trackRemovals){const d=rp(this.os.serializer,u.convertToNoDocument(Y.min()));t.push(this.os.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.os.updateMetadata(e,r)),x.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next(r=>(this.us.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.os.ss(e,t).next(({documents:r,rs:i})=>(i.forEach((s,u)=>{this.us.set(s,{size:u,readTime:r.get(s).readTime})}),r))}}function xp(n){return ct(n,"remoteDocumentGlobal")}function Js(n){return ct(n,"remoteDocumentsV14")}function Su(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Cp(n,e){const t=e.documentKey.path.toArray();return[n,Al(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function kp(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ee(t[s],r[s]),i)return i;return i=ee(t.length,r.length),i||(i=ee(t[t.length-2],r[r.length-2]),i||ee(t[t.length-1],r[r.length-1]))}class Km{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class bp{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&du(r.mutation,i,Ut.empty(),Oe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,_()).next(()=>r))}getLocalViewOfDocuments(e,t,r=_()){const i=a();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let u=h();return s.forEach((l,d)=>{u=u.insert(l,d.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const r=a();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,_()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((u,l)=>{t.set(u,l)})})}computeViews(e,t,r,i){let s=Vt();const u=f(),l=f();return t.forEach((d,p)=>{const m=r.get(p.key);i.has(p.key)&&(void 0===m||m.mutation instanceof si)?s=s.insert(p.key,p):void 0!==m?(u.set(p.key,m.mutation.getFieldMask()),du(m.mutation,p,m.mutation.getFieldMask(),Oe.now())):u.set(p.key,Ut.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((p,m)=>u.set(p,m)),t.forEach((p,m)=>{var v;return l.set(p,new Km(m,null!==(v=u.get(p))&&void 0!==v?v:null))}),l))}recalculateAndSaveOverlays(e,t){const r=f();let i=new xe((u,l)=>u-l),s=_();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const l of u)l.keys().forEach(d=>{const p=t.get(d);if(null===p)return;let m=r.get(d)||Ut.empty();m=l.applyToLocalView(p,m),r.set(d,m);const v=(i.get(l.batchId)||_()).add(d);i=i.insert(l.batchId,v)})}).next(()=>{const u=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),p=d.key,m=d.value,v=c();m.forEach(E=>{if(!s.has(E)){const S=Nf(t.get(E),r.get(E));null!==S&&v.set(E,S),s=s.add(E)}}),u.push(this.documentOverlayCache.saveOverlays(e,p,v))}return x.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return V.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):au(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var i}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const u=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):x.resolve(a());let l=-1,d=s;return u.next(p=>x.forEach(p,(m,v)=>(l<v.largestBatchId&&(l=v.largestBatchId),s.get(m)?x.resolve():this.remoteDocumentCache.getEntry(e,m).next(E=>{d=d.insert(m,E)}))).next(()=>this.populateOverlays(e,p,s)).next(()=>this.computeViews(e,d,p,_())).next(m=>({batchId:l,changes:o(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new V(t)).next(r=>{let i=h();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=h();return this.indexManager.getCollectionParents(e,i).next(u=>x.forEach(u,l=>{const d=(p=t,m=l.child(i),new Yn(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));var p,m;return this.getDocumentsMatchingCollectionQuery(e,d,r).next(p=>{p.forEach((m,v)=>{s=s.insert(m,v)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i))).next(s=>{i.forEach((l,d)=>{const p=d.getKey();null===s.get(p)&&(s=s.insert(p,Ee.newInvalidDocument(p)))});let u=h();return s.forEach((l,d)=>{const p=i.get(l);void 0!==p&&du(p.mutation,d,Ut.empty(),Oe.now()),Yi(t,d)&&(u=u.insert(l,d))}),u})}}class Wm{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return x.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var r;return this.cs.set(t.id,{id:(r=t).id,version:r.version,createTime:nt(r.createTime)}),x.resolve()}getNamedQuery(e,t){return x.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,{name:(r=t).name,query:xd(r.bundledQuery),readTime:nt(r.readTime)}),x.resolve();var r}}class Zm{constructor(){this.overlays=new xe(V.comparator),this.ls=new Map}getOverlay(e,t){return x.resolve(this.overlays.get(t))}getOverlays(e,t){const r=a();return x.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.we(e,t,s)}),x.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.ls.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.ls.delete(r)),x.resolve()}getOverlaysForCollection(e,t,r){const i=a(),s=t.length+1,u=new V(t.child("")),l=this.overlays.getIteratorFrom(u);for(;l.hasNext();){const d=l.getNext().value,p=d.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return x.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new xe((p,m)=>p-m);const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>r){let m=s.get(p.largestBatchId);null===m&&(m=a(),s=s.insert(p.largestBatchId,m)),m.set(p.getKey(),p)}}const l=a(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((p,m)=>l.set(p,m)),!(l.size()>=i)););return x.resolve(l)}we(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const u=this.ls.get(i.largestBatchId).delete(r.key);this.ls.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new vd(t,r));let s=this.ls.get(t);void 0===s&&(s=_(),this.ls.set(t,s)),this.ls.set(t,s.add(r.key))}}class Pd{constructor(){this.fs=new Ce(Ct.ds),this.ws=new Ce(Ct._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const r=new Ct(e,t);this.fs=this.fs.add(r),this.ws=this.ws.add(r)}gs(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.ys(new Ct(e,t))}ps(e,t){e.forEach(r=>this.removeReference(r,t))}Is(e){const t=new V(new oe([])),r=new Ct(t,e),i=new Ct(t,e+1),s=[];return this.ws.forEachInRange([r,i],u=>{this.ys(u),s.push(u.key)}),s}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new V(new oe([])),r=new Ct(t,e),i=new Ct(t,e+1);let s=_();return this.ws.forEachInRange([r,i],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new Ct(e,0),r=this.fs.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Ct{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return V.comparator(e.key,t.key)||ee(e.As,t.As)}static _s(e,t){return ee(e.As,t.As)||V.comparator(e.key,t.key)}}class Hm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Ce(Ct.ds)}checkEmpty(e){return x.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.vs;this.vs++;const u=new md(s,t,r,i);this.mutationQueue.push(u);for(const l of i)this.Rs=this.Rs.add(new Ct(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return x.resolve(u)}lookupMutationBatch(e,t){return x.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.bs(t+1),s=i<0?0:i;return x.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return x.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return x.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ct(t,0),i=new Ct(t,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([r,i],u=>{const l=this.Ps(u.As);s.push(l)}),x.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(ee);return t.forEach(i=>{const s=new Ct(i,0),u=new Ct(i,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([s,u],l=>{r=r.add(l.As)})}),x.resolve(this.Vs(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;V.isDocumentKey(s)||(s=s.child(""));const u=new Ct(new V(s),0);let l=new Ce(ee);return this.Rs.forEachWhile(d=>{const p=d.key.path;return!!r.isPrefixOf(p)&&(p.length===i&&(l=l.add(d.As)),!0)},u),x.resolve(this.Vs(l))}Vs(e){const t=[];return e.forEach(r=>{const i=this.Ps(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){H(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let r=this.Rs;return x.forEach(t.mutations,i=>{const s=new Ct(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Rs=r})}Cn(e){}containsKey(e,t){const r=new Ct(t,0),i=this.Rs.firstAfterOrEqual(r);return x.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return x.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Qm{constructor(e){this.Ds=e,this.docs=new xe(V.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,u=this.Ds(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return x.resolve(r?r.document.mutableCopy():Ee.newInvalidDocument(t))}getEntries(e,t){let r=Vt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ee.newInvalidDocument(i))}),x.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Vt();const u=t.path,l=new V(u.child("")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){const{key:p,value:{document:m}}=d.getNext();if(!u.isPrefixOf(p.path))break;p.path.length>u.length+1||$a(Kc(m),r)<=0||(i.has(m.key)||Yi(t,m))&&(s=s.insert(m.key,m.mutableCopy()))}return x.resolve(s)}getAllFromCollectionGroup(e,t,r,i){j()}Cs(e,t){return x.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ym(this)}getSize(e){return x.resolve(this.size)}}class Ym extends Sp{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.os.addEntry(e,i)):this.os.removeEntry(r)}),x.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class Xm{constructor(e){this.persistence=e,this.xs=new Jn(t=>ti(t),vt),this.lastRemoteSnapshotVersion=Y.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Pd,this.targetCount=0,this.Ms=Xs.kn()}forEachTarget(e,t){return this.xs.forEach((r,i)=>t(i)),x.resolve()}getLastRemoteSnapshotVersion(e){return x.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return x.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),x.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Ns&&(this.Ns=t),x.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Xs(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,x.resolve()}updateTargetData(e,t){return this.Fn(t),x.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,x.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.xs.forEach((u,l)=>{l.sequenceNumber<=t&&null===r.get(l.targetId)&&(this.xs.delete(u),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),x.waitFor(s).next(()=>i)}getTargetCount(e){return x.resolve(this.targetCount)}getTargetData(e,t){const r=this.xs.get(t)||null;return x.resolve(r)}addMatchingKeys(e,t,r){return this.ks.gs(t,r),x.resolve()}removeMatchingKeys(e,t,r){this.ks.ps(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(u=>{s.push(i.markPotentiallyOrphaned(e,u))}),x.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),x.resolve()}getMatchingKeysForTargetId(e,t){const r=this.ks.Es(t);return x.resolve(r)}containsKey(e,t){return x.resolve(this.ks.containsKey(t))}}class Od{constructor(e,t){this.$s={},this.overlays={},this.Os=new Tt(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new Xm(this),this.indexManager=new Um,this.remoteDocumentCache=new Qm(r=>this.referenceDelegate.Ls(r)),this.serializer=new np(t),this.qs=new Wm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Zm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.$s[e.toKey()];return r||(r=new Hm(t,this.referenceDelegate),this.$s[e.toKey()]=r),r}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);const i=new Jm(this.Os.next());return this.referenceDelegate.Us(),r(i).next(s=>this.referenceDelegate.Ks(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gs(e,t){return x.or(Object.values(this.$s).map(r=>()=>r.containsKey(e,t)))}}class Jm extends Wc{constructor(e){super(),this.currentSequenceNumber=e}}class Pl{constructor(e){this.persistence=e,this.Qs=new Pd,this.js=null}static zs(e){return new Pl(e)}get Ws(){if(this.js)return this.js;throw j()}addReference(e,t,r){return this.Qs.addReference(r,t),this.Ws.delete(r.toString()),x.resolve()}removeReference(e,t,r){return this.Qs.removeReference(r,t),this.Ws.add(r.toString()),x.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),x.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(i=>this.Ws.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Ws.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return x.forEach(this.Ws,r=>{const i=V.fromPath(r);return this.Hs(e,i).next(s=>{s||t.removeEntry(i,Y.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(r=>{r?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return x.or([()=>x.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class ey{constructor(e){this.serializer=e}O(e,t,r,i){const s=new Uo("createOrUpgrade",t);var l;r<1&&i>=1&&(e.createObjectStore("owner"),(l=e).createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Xc,{unique:!0}),l.createObjectStore("documentMutations"),Np(e),function(l){l.createObjectStore("remoteDocuments")}(e));let u=x.resolve();return r<3&&i>=3&&(0!==r&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),Np(e)),u=u.next(()=>function(l){const d=l.store("targetGlobal"),p={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Y.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",p)}(s))),r<4&&i>=4&&(0!==r&&(u=u.next(()=>function(l,d){return d.store("mutations").j().next(p=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Xc,{unique:!0});const m=d.store("mutations"),v=p.map(E=>m.put(E));return x.waitFor(v)})}(e,s))),u=u.next(()=>{!function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(u=u.next(()=>this.Ys(s))),r<6&&i>=6&&(u=u.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(s)))),r<7&&i>=7&&(u=u.next(()=>this.Zs(s))),r<8&&i>=8&&(u=u.next(()=>this.ti(e,s))),r<9&&i>=9&&(u=u.next(()=>{!function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(u=u.next(()=>this.ei(s))),r<11&&i>=11&&(u=u.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(u=u.next(()=>{!function(l){const d=l.createObjectStore("documentOverlays",{keyPath:ed});d.createIndex("collectionPathOverlayIndex",td,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",nd,{unique:!1})}(e)})),r<13&&i>=13&&(u=u.next(()=>function(l){const d=l.createObjectStore("remoteDocumentsV14",{keyPath:jh});d.createIndex("documentKeyIndex",el),d.createIndex("collectionGroupIndex",Kh)}(e)).next(()=>this.ni(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(u=u.next(()=>this.si(e,s))),r<15&&i>=15&&(u=u.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:Qh}).createIndex("sequenceNumberIndex",Yh,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:Xh}).createIndex("documentKeyIndex",Jh,{unique:!1})}(e))),u}Xs(e){let t=0;return e.store("remoteDocuments").X((r,i)=>{t+=Nl(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Ys(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.j().next(i=>x.forEach(i,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.j("userMutationsIndex",u).next(l=>x.forEach(l,d=>{H(d.userId===s.userId);const p=Hs(this.serializer,d);return yp(e,s.userId,p).next(()=>{})}))}))}Zs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.X((u,l)=>{const d=new oe(u),p=[0,gt(d)];s.push(t.get(p).next(m=>m?x.resolve():t.put({targetId:0,path:gt(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>x.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Hh});const r=t.store("collectionParents"),i=new Dd,s=u=>{if(i.add(u)){const l=u.lastSegment(),d=u.popLast();return r.put({collectionId:l,parent:gt(d)})}};return t.store("remoteDocuments").X({Y:!0},(u,l)=>{const d=new oe(u);return s(d.popLast())}).next(()=>t.store("documentMutations").X({Y:!0},([u,l,d],p)=>{const m=dn(l);return s(m.popLast())}))}ei(e){const t=e.store("targets");return t.X((r,i)=>{const s=_u(i),u=ip(this.serializer,s);return t.put(u)})}ni(e,t){const r=t.store("remoteDocuments"),i=[];return r.X((s,u)=>{const l=t.store("remoteDocumentsV14"),d=(p=u,p.document?new V(oe.fromString(p.document.name).popFirst(5)):p.noDocument?V.fromSegments(p.noDocument.path):p.unknownDocument?V.fromSegments(p.unknownDocument.path):j()).path.toArray();var p;const m={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(l.put(m))}).next(()=>x.waitFor(i))}si(e,t){const r=t.store("mutations"),i=Ap(this.serializer),s=new Od(Pl.zs,this.serializer.fe);return r.j().next(u=>{const l=new Map;return u.forEach(d=>{var p;let m=null!==(p=l.get(d.userId))&&void 0!==p?p:_();Hs(this.serializer,d).keys().forEach(v=>m=m.add(v)),l.set(d.userId,m)}),x.forEach(l,(d,p)=>{const m=new Qe(p),v=xl.de(this.serializer,m),E=s.getIndexManager(m),S=Rl.de(m,this.serializer,E,s.referenceDelegate);return new bp(i,S,v,E).recalculateAndSaveOverlaysForDocumentKeys(new Za(t,Tt.ct),d).next()})})}}function Np(n){n.createObjectStore("targetDocuments",{keyPath:Wh}).createIndex("documentTargetsIndex",Zh,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Bo,{unique:!0}),n.createObjectStore("targetGlobal")}const Ld="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Md{constructor(e,t,r,i,s,u,l,d,p,m,v=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ii=s,this.window=u,this.document=l,this.ri=p,this.oi=m,this.ui=v,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=E=>Promise.resolve(),!Md.D())throw new P(k.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new zm(this,i),this.di=t+"main",this.serializer=new np(d),this.wi=new Qt(this.di,this.ui,new ey(this.serializer)),this.Bs=new Bm(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ap(this.serializer),this.qs=new Rm,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===m&&Ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new P(k.FAILED_PRECONDITION,Ld);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Bs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new Tt(e,this.ri)}).then(()=>{this.Fs=!0}).catch(e=>(this.wi&&this.wi.close(),Promise.reject(e)))}Ii(e){var r,t=this;return this.fi=function(i){return(r=r||(0,N.Z)(function*(s){if(t.started)return e(s)})).apply(this,arguments)},e(this.isPrimary)}setDatabaseDeletedListener(e){var t;this.wi.B(function(r){return(t=t||(0,N.Z)(function*(i){null===i.newVersion&&(yield e())})).apply(this,arguments)})}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((0,N.Z)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ll(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ti(e).next(t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Ei(e)).next(t=>this.isPrimary&&!t?this.Ai(e).next(()=>!1):!!t&&this.vi(e).next(()=>!0))).catch(e=>{if(vr(e))return M("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Ti(e){return Au(e).get("owner").next(t=>x.resolve(this.Ri(t)))}Pi(e){return Ll(e).delete(this.clientId)}bi(){var e=this;return(0,N.Z)(function*(){if(e.isPrimary&&!e.Vi(e.li,18e5)){e.li=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=ct(r,"clientMetadata");return i.j().next(s=>{const u=e.Si(s,18e5),l=s.filter(d=>-1===u.indexOf(d));return x.forEach(l,d=>i.delete(d.clientId)).next(()=>l)})}).catch(()=>[]);if(e._i)for(const r of t)e._i.removeItem(e.Di(r.clientId))}})()}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.bi()).then(()=>this.pi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?x.resolve(!0):Au(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new P(k.FAILED_PRECONDITION,Ld);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ll(e).j().next(r=>void 0===this.Si(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&M("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,N.Z)(function*(){e.Fs=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Ni(),e.ki(),yield e.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Za(t,Tt.ct);return e.Ai(r).next(()=>e.Pi(r))}),e.wi.close(),e.Mi()})()}Si(e,t){return e.filter(r=>this.Vi(r.updateTimeMs,t)&&!this.Ci(r.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>Ll(e).j().next(t=>this.Si(t,18e5).map(r=>r.clientId)))}get started(){return this.Fs}getMutationQueue(e,t){return Rl.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Vm(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return xl.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,r){M("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.ui)?id:14===u?Wa:13===u?nl:12===u?rd:11===u?tl:void j();var u;let l;return this.wi.runTransaction(e,i,s,d=>(l=new Za(d,this.Os?this.Os.next():Tt.ct),"readwrite-primary"===t?this.Ti(l).next(p=>!!p||this.Ei(l)).next(p=>{if(!p)throw Ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)),new P(k.FAILED_PRECONDITION,Gi);return r(l)}).next(p=>this.vi(l).next(()=>p)):this.Oi(l).next(()=>r(l)))).then(d=>(l.raiseOnCommittedEvent(),d))}Oi(e){return Au(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.Ri(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new P(k.FAILED_PRECONDITION,Ld)})}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Au(e).put("owner",t)}static D(){return Qt.D()}Ai(e){const t=Au(e);return t.get("owner").next(r=>this.Ri(r)?(M("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):x.resolve())}Vi(e,t){const r=Date.now();return!(e<r-t||e>r&&(Ye(`Detected an update time that is in the future: ${e} > ${r}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,fe.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const r=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return M("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ye("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){Ye("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch{}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Au(n){return ct(n,"owner")}function Ll(n){return ct(n,"clientMetadata")}function Fd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Ud{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Fi=r,this.Bi=i}static Li(e,t){let r=_(),i=_();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ud(e,t.fromCache,r,i)}}class Rp{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.Ki(e,t).next(s=>s||this.Gi(e,t,i,r)).next(s=>s||this.Qi(e,t))}Ki(e,t){if(Xn(t))return x.resolve(null);let r=St(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Qi(t,null,"F"),r=St(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const u=_(...s);return this.Ui.getDocuments(e,u).next(l=>this.indexManager.getMinOffset(e,r).next(d=>{const p=this.ji(t,l);return this.zi(t,p,u,d.readTime)?this.Ki(e,Qi(t,null,"F")):this.Wi(e,p,t,d)}))})))}Gi(e,t,r,i){return Xn(t)||i.isEqual(Y.min())?this.Qi(e,t):this.Ui.getDocuments(e,r).next(s=>{const u=this.ji(t,s);return this.zi(t,u,r,i)?this.Qi(e,t):(Mo()<=Ot.in.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ri(t)),this.Wi(e,u,t,jc(i,-1)))})}ji(e,t){let r=new Ce(vl(e));return t.forEach((i,s)=>{Yi(e,s)&&(r=r.add(s))}),r}zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Qi(e,t){return Mo()<=Ot.in.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",ri(t)),this.Ui.getDocumentsMatchingQuery(e,t,Nt.min())}Wi(e,t,r,i){return this.Ui.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class ty{constructor(e,t,r,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new xe(ee),this.Yi=new Jn(s=>ti(s),vt),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(r)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new bp(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function Dp(n,e,t,r){return new ty(n,e,t,r)}function Pp(n,e){return(wh=wh||(0,N.Z)(function*(t,r){const i=z(t);return yield i.persistence.runTransaction("Handle user change","readonly",s=>{let u;return i.mutationQueue.getAllMutationBatches(s).next(l=>(u=l,i.tr(r),i.mutationQueue.getAllMutationBatches(s))).next(l=>{const d=[],p=[];let m=_();for(const v of u){d.push(v.batchId);for(const E of v.mutations)m=m.add(E.key)}for(const v of l){p.push(v.batchId);for(const E of v.mutations)m=m.add(E.key)}return i.localDocuments.getDocuments(s,m).next(v=>({er:v,removedBatchIds:d,addedBatchIds:p}))})})})).apply(this,arguments)}function Op(n){const e=z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}function Lp(n,e,t){let r=_(),i=_();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let u=Vt();return t.forEach((l,d)=>{const p=s.get(l);d.isFoundDocument()!==p.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(Y.min())?(e.removeEntry(l,d.readTime),u=u.insert(l,d)):!p.isValidDocument()||d.version.compareTo(p.version)>0||0===d.version.compareTo(p.version)&&p.hasPendingWrites?(e.addEntry(d),u=u.insert(l,d)):M("LocalStore","Ignoring outdated watch update for ",l,". Current version:",p.version," Watch version:",d.version)}),{nr:u,sr:i}})}function iy(n,e){const t=z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function oa(n,e){const t=z(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Bs.getTargetData(r,e).next(s=>s?(i=s,x.resolve(i)):t.Bs.allocateTargetId(r).next(u=>(i=new oi(e,u,"TargetPurposeListen",r.currentSequenceNumber),t.Bs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ji.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(r.targetId,r),t.Yi.set(e,r.targetId)),r})}function aa(n,e,t){return(Eh=Eh||(0,N.Z)(function*(r,i,s){const u=z(r),l=u.Ji.get(i),d=s?"readwrite":"readwrite-primary";try{s||(yield u.persistence.runTransaction("Release target",d,p=>u.persistence.referenceDelegate.removeTarget(p,l)))}catch(p){if(!vr(p))throw p;M("LocalStore",`Failed to update sequence numbers for target ${i}: ${p}`)}u.Ji=u.Ji.remove(i),u.Yi.delete(l.target)})).apply(this,arguments)}function Ml(n,e,t){const r=z(n);let i=Y.min(),s=_();return r.persistence.runTransaction("Execute query","readonly",u=>function(l,d,p){const m=z(l),v=m.Yi.get(p);return void 0!==v?x.resolve(m.Ji.get(v)):m.Bs.getTargetData(d,p)}(r,u,St(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(u,l.targetId).next(d=>{s=d})}).next(()=>r.Hi.getDocumentsMatchingQuery(u,e,t?i:Y.min(),t?s:_())).next(l=>(Up(r,uu(e),l),{documents:l,ir:s})))}function Mp(n,e){const t=z(n),r=z(t.Bs),i=t.Ji.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.le(s,e).next(u=>u?u.target:null))}function Fp(n,e){const t=z(n),r=t.Xi.get(e)||Y.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Zi.getAllFromCollectionGroup(i,e,jc(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Up(t,e,i),i))}function Up(n,e,t){let r=n.Xi.get(e)||Y.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Xi.set(e,r)}function oy(n,e){return(Ec=Ec||(0,N.Z)(function*(t,r,i=_()){const s=yield oa(t,St(xd(r.bundledQuery))),u=z(t);return u.persistence.runTransaction("Save named query","readwrite",l=>{const d=nt(r.readTime);if(s.snapshotVersion.compareTo(d)>=0)return u.qs.saveNamedQuery(l,r);const p=s.withResumeToken(Xe.EMPTY_BYTE_STRING,d);return u.Ji=u.Ji.insert(p.targetId,p),u.Bs.updateTargetData(l,p).next(()=>u.Bs.removeMatchingKeysForTargetId(l,s.targetId)).next(()=>u.Bs.addMatchingKeys(l,i,s.targetId)).next(()=>u.qs.saveNamedQuery(l,r))})})).apply(this,arguments)}function Vp(n,e){return`firestore_clients_${n}_${e}`}function Bp(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Vd(n,e){return`firestore_targets_${n}_${e}`}class Fl{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static ar(e,t,r){const i=JSON.parse(r);let s,u="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return u&&i.error&&(u="string"==typeof i.error.message&&"string"==typeof i.error.code,u&&(s=new P(i.error.code,i.error.message))),u?new Fl(e,t,i.state,s):(Ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class xu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static ar(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new P(r.error.code,r.error.message))),s?new xu(e,r.state,i):(Ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ul{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=b();for(let u=0;i&&u<r.activeTargetIds.length;++u)i=Ka(r.activeTargetIds[u]),s=s.add(r.activeTargetIds[u]);return i?new Ul(e,s):(Ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Bd{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Bd(t.clientId,t.onlineState):(Ye("SharedClientState",`Failed to parse online state: ${e}`),null)}}class qd{constructor(){this.activeTargetIds=b()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Gd{constructor(e,t,r,i,s){this.window=e,this.ii=t,this.persistenceKey=r,this.wr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new xe(ee),this.started=!1,this.yr=[];const u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.pr=Vp(this.persistenceKey,this.wr),this.Ir=`firestore_sequence_number_${this.persistenceKey}`,this.gr=this.gr.insert(this.wr,new qd),this.Tr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.vr=`firestore_online_state_${this.persistenceKey}`,this.Rr=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,N.Z)(function*(){const t=yield e.syncEngine.$i();for(const i of t){if(i===e.wr)continue;const s=e.getItem(Vp(e.persistenceKey,i));if(s){const u=Ul.ar(i,s);u&&(e.gr=e.gr.insert(u.clientId,u))}}e.Pr();const r=e.storage.getItem(e.vr);if(r){const i=e.br(r);i&&e.Vr(i)}for(const i of e.yr)e.mr(i);e.yr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,r){this.Dr(e,t,r),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Vd(this.persistenceKey,e));if(r){const i=xu.ar(e,r);i&&(t=i.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Vd(this.persistenceKey,e))}updateQueryState(e,t,r){this.kr(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Cr(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return M("SharedClientState","READ",e,t),t}setItem(e,t){M("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){M("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(M("SharedClientState","EVENT",r.key,r.newValue),r.key===this.pr)return void Ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((0,N.Z)(function*(){if(t.started){if(null!==r.key)if(t.Tr.test(r.key)){if(null==r.newValue){const i=t.Or(r.key);return t.Fr(i,null)}{const i=t.Br(r.key,r.newValue);if(i)return t.Fr(i.clientId,i)}}else if(t.Er.test(r.key)){if(null!==r.newValue){const i=t.Lr(r.key,r.newValue);if(i)return t.qr(i)}}else if(t.Ar.test(r.key)){if(null!==r.newValue){const i=t.Ur(r.key,r.newValue);if(i)return t.Kr(i)}}else if(r.key===t.vr){if(null!==r.newValue){const i=t.br(r.newValue);if(i)return t.Vr(i)}}else if(r.key===t.Ir){const i=function(s){let u=Tt.ct;if(null!=s)try{const l=JSON.parse(s);H("number"==typeof l),u=l}catch(l){Ye("SharedClientState","Failed to read sequence number from WebStorage",l)}return u}(r.newValue);i!==Tt.ct&&t.sequenceNumberHandler(i)}else if(r.key===t.Rr){const i=t.Gr(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Qr(s)))}}else t.yr.push(r)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,r){const i=new Fl(this.currentUser,e,t,r),s=Bp(this.persistenceKey,this.currentUser,e);this.setItem(s,i.hr())}Cr(e){const t=Bp(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){this.storage.setItem(this.vr,JSON.stringify({clientId:this.wr,onlineState:e}))}kr(e,t,r){const i=Vd(this.persistenceKey,e),s=new xu(e,t,r);this.setItem(i,s.hr())}$r(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){const t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){const r=this.Or(e);return Ul.ar(r,t)}Lr(e,t){const r=this.Er.exec(e),i=Number(r[1]);return Fl.ar(new Qe(void 0!==r[2]?r[2]:null),i,t)}Ur(e,t){const r=this.Ar.exec(e),i=Number(r[1]);return xu.ar(i,t)}br(e){return Bd.ar(e)}Gr(e){return JSON.parse(e)}qr(e){var t=this;return(0,N.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.jr(e.batchId,e.state,e.error);M("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){const r=t?this.gr.insert(e,t):this.gr.remove(e),i=this.Sr(this.gr),s=this.Sr(r),u=[],l=[];return s.forEach(d=>{i.has(d)||u.push(d)}),i.forEach(d=>{s.has(d)||l.push(d)}),this.syncEngine.Wr(u,l).then(()=>{this.gr=r})}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=b();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class qp{constructor(){this.Hr=new qd,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,r){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new qd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ay{Yr(e){}shutdown(){}}class Gp{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Vl=null;function zd(){return null===Vl?Vl=268435456+Math.round(2147483648*Math.random()):Vl++,"0x"+Vl.toString(16)}const uy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class cy{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const qt="WebChannelConnection";class ly extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.mo=(e.ssl?"https":"http")+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,r,i,s){const u=zd(),l=this.To(e,t);M("RestConnection",`Sending RPC '${e}' ${u}:`,l,r);const d={};return this.Eo(d,i,s),this.Ao(e,l,d,r).then(p=>(M("RestConnection",`Received RPC '${e}' ${u}: `,p),p),p=>{throw nn("RestConnection",`RPC '${e}' ${u} failed with error: `,p,"url: ",l,"request:",r),p})}vo(e,t,r,i,s,u){return this.Io(e,t,r,i,s)}Eo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Vi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}To(e,t){return`${this.mo}/v1/${t}:${uy[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,r,i){const s=zd();return new Promise((u,l)=>{const d=new _h;d.setWithCredentials(!0),d.listenOnce(vc.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Ua.NO_ERROR:const m=d.getResponseJson();M(qt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(m)),u(m);break;case Ua.TIMEOUT:M(qt,`RPC '${e}' ${s} timed out`),l(new P(k.DEADLINE_EXCEEDED,"Request time out"));break;case Ua.HTTP_ERROR:const v=d.getStatus();if(M(qt,`RPC '${e}' ${s} failed with status:`,v,"response text:",d.getResponseText()),v>0){let E=d.getResponseJson();Array.isArray(E)&&(E=E[0]);const S=E?.error;if(S&&S.status&&S.message){const D=function(U){const q=U.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(q)>=0?q:k.UNKNOWN}(S.status);l(new P(D,S.message))}else l(new P(k.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new P(k.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{M(qt,`RPC '${e}' ${s} completed.`)}});const p=JSON.stringify(i);M(qt,`RPC '${e}' ${s} sending request:`,i),d.send(t,"POST",p,r,15)})}Ro(e,t,r){const i=zd(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=mh(),l=yh(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;void 0!==p&&(d.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(d.xmlHttpFactory=new _c({})),this.Eo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const m=s.join("");M(qt,`Creating RPC '${e}' stream ${i}: ${m}`,d);const v=u.createWebChannel(m,d);let E=!1,S=!1;const D=new cy({ro:q=>{S?M(qt,`Not sending because RPC '${e}' stream ${i} is closed:`,q):(E||(M(qt,`Opening RPC '${e}' stream ${i} transport.`),v.open(),E=!0),M(qt,`RPC '${e}' stream ${i} sending:`,q),v.send(q))},oo:()=>v.close()}),U=(q,te,ie)=>{q.listen(te,Q=>{try{ie(Q)}catch(se){setTimeout(()=>{throw se},0)}})};return U(v,Ro.EventType.OPEN,()=>{S||M(qt,`RPC '${e}' stream ${i} transport opened.`)}),U(v,Ro.EventType.CLOSE,()=>{S||(S=!0,M(qt,`RPC '${e}' stream ${i} transport closed`),D.wo())}),U(v,Ro.EventType.ERROR,q=>{S||(S=!0,nn(qt,`RPC '${e}' stream ${i} transport errored:`,q),D.wo(new P(k.UNAVAILABLE,"The operation could not be completed")))}),U(v,Ro.EventType.MESSAGE,q=>{var te;if(!S){const ie=q.data[0];H(!!ie);const se=ie.error||(null===(te=ie[0])||void 0===te?void 0:te.error);if(se){M(qt,`RPC '${e}' stream ${i} received error:`,se);const de=se.status;let Le=function(er){const li=lt[er];if(void 0!==li)return Mf(li)}(de),Pt=se.message;void 0===Le&&(Le=k.INTERNAL,Pt="Unknown error status: "+de+" with message "+se.message),S=!0,D.wo(new P(Le,Pt)),v.close()}else M(qt,`RPC '${e}' stream ${i} received:`,ie),D._o(ie)}}),U(l,vh.STAT_EVENT,q=>{q.stat===Qr.PROXY?M(qt,`RPC '${e}' stream ${i} detected buffering proxy`):q.stat===Qr.NOPROXY&&M(qt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.fo()},0),D}}function zp(){return typeof window<"u"?window:null}function Bl(){return typeof document<"u"?document:null}function Cu(n){return new Im(n,!0)}class $d{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ii=e,this.timerId=t,this.Po=r,this.bo=i,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),r=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-r);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class $p{constructor(e,t,r,i,s,u,l,d){this.ii=e,this.$o=r,this.Oo=i,this.connection=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new $d(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}stop(){var e=this;return(0,N.Z)(function*(){e.Uo()&&(yield e.close(0))})()}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}zo(){var e=this;return(0,N.Z)(function*(){if(e.Ko())return e.close(0)})()}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}close(e,t){var r=this;return(0,N.Z)(function*(){r.Ho(),r.Jo(),r.qo.cancel(),r.Fo++,4!==e?r.qo.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(Ye(t.toString()),Ye("Using maximum backoff delay to prevent overloading the backend."),r.qo.xo()):t&&t.code===k.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Yo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.ao(t)})()}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Fo===t&&this.Zo(r,i)},r=>{e(()=>{const i=new P(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.tu(i)})})}Zo(e,t){const r=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{r(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(i=>{r(()=>this.tu(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Go(){var e=this;this.state=5,this.qo.No((0,N.Z)(function*(){e.state=0,e.start()}))}tu(e){return M("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hy extends $p{constructor(e,t,r,i,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,u),this.serializer=s}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function Tm(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(d=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===d?1:"REMOVE"===d?2:"CURRENT"===d?3:"RESET"===d?4:j(),i=e.targetChange.targetIds||[],s=function(d,p){return d.useProto3Json?(H(void 0===p||"string"==typeof p),Xe.fromBase64String(p||"")):(H(void 0===p||p instanceof Uint8Array),Xe.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,l=u&&function(d){const p=void 0===d.code?k.UNKNOWN:Mf(d.code);return new P(p,d.message||"")}(u);t=new qf(r,i,s,l||null)}else if("documentChange"in e){const r=e.documentChange,i=Cr(n,r.document.name),s=nt(r.document.updateTime),u=r.document.createTime?nt(r.document.createTime):Y.min(),l=new yt({mapValue:{fields:r.document.fields}}),d=Ee.newFoundDocument(i,s,u,l);t=new Sl(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=Cr(n,r.document),s=r.readTime?nt(r.readTime):Y.min(),u=Ee.newNoDocument(i,s);t=new Sl([],r.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const r=e.documentRemove,i=Cr(n,r.document);t=new Sl([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return j();{const r=e.filter,{count:i=0,unchangedNames:s}=r,u=new pm(i,s);t=new Bf(r.targetId,u)}}var d;return t}(this.serializer,e),r=function(i){if(!("targetChange"in i))return Y.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?Y.min():s.readTime?nt(s.readTime):Y.min()}(e);return this.listener.nu(t,r)}su(e){const t={};t.database=yu(this.serializer),t.addTarget=function(i,s){let u;const l=s.target;if(u=Tr(l)?{documents:Yf(i,l)}:{query:Ad(i,l)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){u.resumeToken=jf(i,s.resumeToken);const d=wd(i,s.expectedCount);null!==d&&(u.expectedCount=d)}else if(s.snapshotVersion.compareTo(Y.min())>0){u.readTime=na(i,s.snapshotVersion.toTimestamp());const d=wd(i,s.expectedCount);null!==d&&(u.expectedCount=d)}return u}(this.serializer,e);const r=function Am(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Wo(t)}iu(e){const t={};t.database=yu(this.serializer),t.removeTarget=e,this.Wo(t)}}class dy extends $p{constructor(e,t,r,i,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,u),this.serializer=s,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(H(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function Sm(n,e){return n&&n.length>0?(H(void 0!==e),n.map(t=>function(r,i){let s=nt(r.updateTime?r.updateTime:i);return s.isEqual(Y.min())&&(s=nt(i)),new lm(s,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=nt(e.commitTime);return this.listener.cu(r,t)}return H(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=yu(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>vu(this.serializer,r))};this.Wo(t)}}class fy extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new P(k.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Io(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new P(k.UNKNOWN,i.toString())})}vo(e,t,r,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection.vo(e,t,r,s,u,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new P(k.UNKNOWN,s.toString())})}terminate(){this.lu=!0}}class gy{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Ye(t),this.mu=!1):M("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class my{constructor(e,t,r,i,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr(l=>{r.enqueueAndForget((0,N.Z)(function*(){var d;ns(u)&&(M("RemoteStore","Restarting streams for network reachability change."),yield function(p){return(d=d||(0,N.Z)(function*(m){const v=z(m);v.vu.add(4),yield ua(v),v.bu.set("Unknown"),v.vu.delete(4),yield ku(v)})).apply(this,arguments)}(u))}))}),this.bu=new gy(r,i)}}function ku(n){return(Sh=Sh||(0,N.Z)(function*(e){if(ns(e))for(const t of e.Ru)yield t(!0)})).apply(this,arguments)}function ua(n){return(Ah=Ah||(0,N.Z)(function*(e){for(const t of e.Ru)yield t(!1)})).apply(this,arguments)}function ql(n,e){const t=z(n);t.Au.has(e.targetId)||(t.Au.set(e.targetId,e),Wd(t)?Kd(t):la(t).Ko()&&jd(t,e))}function bu(n,e){const t=z(n),r=la(t);t.Au.delete(e),r.Ko()&&jp(t,e),0===t.Au.size&&(r.Ko()?r.jo():ns(t)&&t.bu.set("Unknown"))}function jd(n,e){if(n.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Y.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}la(n).su(e)}function jp(n,e){n.Vu.qt(e),la(n).iu(e)}function Kd(n){n.Vu=new mm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),le:e=>n.Au.get(e)||null,ue:()=>n.datastore.serializer.databaseId}),la(n).start(),n.bu.gu()}function Wd(n){return ns(n)&&!la(n).Uo()&&n.Au.size>0}function ns(n){return 0===z(n).vu.size}function Kp(n){n.Vu=void 0}function yy(n){return(xh=xh||(0,N.Z)(function*(e){e.Au.forEach((t,r)=>{jd(e,t)})})).apply(this,arguments)}function vy(n,e){return(Ch=Ch||(0,N.Z)(function*(t,r){Kp(t),Wd(t)?(t.bu.Iu(r),Kd(t)):t.bu.set("Unknown")})).apply(this,arguments)}function _y(n,e,t){return(mr=mr||(0,N.Z)(function*(r,i,s){if(r.bu.set("Online"),i instanceof qf&&2===i.state&&i.cause)try{var u;yield function(l,d){return(u=u||(0,N.Z)(function*(p,m){const v=m.cause;for(const E of m.targetIds)p.Au.has(E)&&(yield p.remoteSyncer.rejectListen(E,v),p.Au.delete(E),p.Vu.removeTarget(E))})).apply(this,arguments)}(r,i)}catch(l){M("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),l),yield Gl(r,l)}else if(i instanceof Sl?r.Vu.Ht(i):i instanceof Bf?r.Vu.ne(i):r.Vu.Xt(i),!s.isEqual(Y.min()))try{const l=yield Op(r.localStore);s.compareTo(l)>=0&&(yield function(d,p){const m=d.Vu.ce(p);return m.targetChanges.forEach((v,E)=>{if(v.resumeToken.approximateByteSize()>0){const S=d.Au.get(E);S&&d.Au.set(E,S.withResumeToken(v.resumeToken,p))}}),m.targetMismatches.forEach((v,E)=>{const S=d.Au.get(v);if(!S)return;d.Au.set(v,S.withResumeToken(Xe.EMPTY_BYTE_STRING,S.snapshotVersion)),jp(d,v);const D=new oi(S.target,v,E,S.sequenceNumber);jd(d,D)}),d.remoteSyncer.applyRemoteEvent(m)}(r,s))}catch(l){M("RemoteStore","Failed to raise snapshot:",l),yield Gl(r,l)}})).apply(this,arguments)}function Gl(n,e,t){return(Do=Do||(0,N.Z)(function*(r,i,s){if(!vr(i))throw i;r.vu.add(1),yield ua(r),r.bu.set("Offline"),s||(s=()=>Op(r.localStore)),r.asyncQueue.enqueueRetryable((0,N.Z)(function*(){M("RemoteStore","Retrying IndexedDB access"),yield s(),r.vu.delete(1),yield ku(r)}))})).apply(this,arguments)}function Wp(n,e){return e().catch(t=>Gl(n,t,e))}function ca(n){return(Tc=Tc||(0,N.Z)(function*(e){const t=z(e),r=rs(t);let i=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;Iy(t);)try{const s=yield iy(t.localStore,i);if(null===s){0===t.Eu.length&&r.jo();break}i=s.batchId,wy(t,s)}catch(s){yield Gl(t,s)}Zp(t)&&Hp(t)})).apply(this,arguments)}function Iy(n){return ns(n)&&n.Eu.length<10}function wy(n,e){n.Eu.push(e);const t=rs(n);t.Ko()&&t.ou&&t.uu(e.mutations)}function Zp(n){return ns(n)&&!rs(n).Uo()&&n.Eu.length>0}function Hp(n){rs(n).start()}function Ey(n){return(Sc=Sc||(0,N.Z)(function*(e){rs(e).hu()})).apply(this,arguments)}function Ty(n){return(Ac=Ac||(0,N.Z)(function*(e){const t=rs(e);for(const r of e.Eu)t.uu(r.mutations)})).apply(this,arguments)}function Sy(n,e,t){return(kh=kh||(0,N.Z)(function*(r,i,s){const u=r.Eu.shift(),l=yd.from(u,i,s);yield Wp(r,()=>r.remoteSyncer.applySuccessfulWrite(l)),yield ca(r)})).apply(this,arguments)}function Ay(n,e){return(xc=xc||(0,N.Z)(function*(t,r){var i;r&&rs(t).ou&&(yield function(s,u){return(i=i||(0,N.Z)(function*(l,d){if(Lf(p=d.code)&&p!==k.ABORTED){const m=l.Eu.shift();rs(l).Qo(),yield Wp(l,()=>l.remoteSyncer.rejectFailedWrite(m.batchId,d)),yield ca(l)}var p})).apply(this,arguments)}(t,r)),Zp(t)&&Hp(t)})).apply(this,arguments)}function Qp(n,e){return(Cc=Cc||(0,N.Z)(function*(t,r){const i=z(t);i.asyncQueue.verifyOperationInProgress(),M("RemoteStore","RemoteStore received new credentials");const s=ns(i);i.vu.add(3),yield ua(i),s&&i.bu.set("Unknown"),yield i.remoteSyncer.handleCredentialChange(r),i.vu.delete(3),yield ku(i)})).apply(this,arguments)}function Zd(n,e){return(Po=Po||(0,N.Z)(function*(t,r){const i=z(t);r?(i.vu.delete(2),yield ku(i)):r||(i.vu.add(2),yield ua(i),i.bu.set("Unknown"))})).apply(this,arguments)}function la(n){var e;return n.Su||(n.Su=function(t,r,i){const s=z(t);return s.fu(),new hy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{uo:yy.bind(null,n),ao:vy.bind(null,n),nu:_y.bind(null,n)}),n.Ru.push(function(t){return(e=e||(0,N.Z)(function*(r){r?(n.Su.Qo(),Wd(n)?Kd(n):n.bu.set("Unknown")):(yield n.Su.stop(),Kp(n))})).apply(this,arguments)})),n.Su}function rs(n){var e;return n.Du||(n.Du=function(t,r,i){const s=z(t);return s.fu(),new dy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{uo:Ey.bind(null,n),ao:Ay.bind(null,n),au:Ty.bind(null,n),cu:Sy.bind(null,n)}),n.Ru.push(function(t){return(e=e||(0,N.Z)(function*(r){r?(n.Du.Qo(),yield ca(n)):(yield n.Du.stop(),n.Eu.length>0&&(M("RemoteStore",`Stopping write stream with ${n.Eu.length} pending writes`),n.Eu=[]))})).apply(this,arguments)})),n.Du}class Hd{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,r,i,s){const u=Date.now()+r,l=new Hd(e,t,u,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ha(n,e){if(Ye("AsyncQueue",`${e}: ${n}`),vr(n))return new P(k.UNAVAILABLE,`${e}: ${n}`);throw n}class da{constructor(e){this.comparator=e?(t,r)=>e(t,r)||V.comparator(t.key,r.key):(t,r)=>V.comparator(t.key,r.key),this.keyedMap=h(),this.sortedSet=new xe(this.comparator)}static emptySet(e){return new da(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof da)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new da;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Yp{constructor(){this.Cu=new xe(V.comparator)}track(e){const t=e.doc.key,r=this.Cu.get(t);r?0!==e.type&&3===r.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==r.type?this.Cu=this.Cu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Cu=this.Cu.remove(t):1===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):j():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal((t,r)=>{e.push(r)}),e}}class fa{constructor(e,t,r,i,s,u,l,d,p){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=p}static fromInitialDocuments(e,t,r,i,s){const u=[];return t.forEach(l=>{u.push({type:0,doc:l})}),new fa(e,t,da.emptySet(t),u,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ks(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class xy{constructor(){this.Nu=void 0,this.listeners=[]}}class Cy{constructor(){this.queries=new Jn(e=>Rn(e),Ks),this.onlineState="Unknown",this.ku=new Set}}function Qd(n,e){return(Oo=Oo||(0,N.Z)(function*(t,r){const i=z(t),s=r.query;let u=!1,l=i.queries.get(s);if(l||(u=!0,l=new xy),u)try{l.Nu=yield i.onListen(s)}catch(d){const p=ha(d,`Initialization of query '${ri(r.query)}' failed`);return void r.onError(p)}i.queries.set(s,l),l.listeners.push(r),r.Mu(i.onlineState),l.Nu&&r.$u(l.Nu)&&Xd(i)})).apply(this,arguments)}function Yd(n,e){return(kc=kc||(0,N.Z)(function*(t,r){const i=z(t),s=r.query;let u=!1;const l=i.queries.get(s);if(l){const d=l.listeners.indexOf(r);d>=0&&(l.listeners.splice(d,1),u=0===l.listeners.length)}if(u)return i.queries.delete(s),i.onUnlisten(s)})).apply(this,arguments)}function ky(n,e){const t=z(n);let r=!1;for(const i of e){const u=t.queries.get(i.query);if(u){for(const l of u.listeners)l.$u(i)&&(r=!0);u.Nu=i}}r&&Xd(t)}function by(n,e,t){const r=z(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function Xd(n){n.ku.forEach(e=>{e.next()})}class Jd{constructor(e,t,r){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=r||{}}$u(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new fa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Uu(e){e=fa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class Ny{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class Xp{constructor(e){this.serializer=e}rr(e){return Cr(this.serializer,e)}ur(e){return e.metadata.exists?Qf(this.serializer,e.document,!1):Ee.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return nt(e)}}class Ry{constructor(e,t,r){this.ju=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Jp(e)}zu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;const r=oe.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Wu(e){const t=new Map,r=new Xp(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.rr(i.metadata.name);for(const u of i.metadata.queries){const l=(t.get(u)||_()).add(s);t.set(u,l)}}return t}complete(){var e=this;return(0,N.Z)(function*(){const t=yield function sy(n,e,t,r){return(wc=wc||(0,N.Z)(function*(i,s,u,l){const d=z(i);let p=_(),m=Vt();for(const S of u){const D=s.rr(S.metadata.name);S.document&&(p=p.add(D));const U=s.ur(S);U.setReadTime(s.cr(S.metadata.readTime)),m=m.insert(D,U)}const v=d.Zi.newChangeBuffer({trackRemovals:!0}),E=yield oa(d,(S=l,St(Hi(oe.fromString(`__bundle__/docs/${S}`)))));var S;return d.persistence.runTransaction("Apply bundle documents","readwrite",S=>Lp(S,v,m).next(D=>(v.apply(S),D)).next(D=>d.Bs.removeMatchingKeysForTargetId(S,E.targetId).next(()=>d.Bs.addMatchingKeys(S,p,E.targetId)).next(()=>d.localDocuments.getLocalViewOfDocuments(S,D.nr,D.sr)).next(()=>D.nr)))})).apply(this,arguments)}(e.localStore,new Xp(e.serializer),e.documents,e.ju.id),r=e.Wu(e.documents);for(const i of e.queries)yield oy(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Hu:e.collectionGroups,Ju:t}})()}}function Jp(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class eg{constructor(e){this.key=e}}class tg{constructor(e){this.key=e}}class ng{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=_(),this.mutatedKeys=_(),this.tc=vl(e),this.ec=new da(this.tc)}get nc(){return this.Yu}sc(e,t){const r=t?t.ic:new Yp,i=t?t.ec:this.ec;let s=t?t.mutatedKeys:this.mutatedKeys,u=i,l=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,p="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((m,v)=>{const E=i.get(m),S=Yi(this.query,v)?v:null,D=!!E&&this.mutatedKeys.has(E.key),U=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let q=!1;E&&S?E.data.isEqual(S.data)?D!==U&&(r.track({type:3,doc:S}),q=!0):this.rc(E,S)||(r.track({type:2,doc:S}),q=!0,(d&&this.tc(S,d)>0||p&&this.tc(S,p)<0)&&(l=!0)):!E&&S?(r.track({type:0,doc:S}),q=!0):E&&!S&&(r.track({type:1,doc:E}),q=!0,(d||p)&&(l=!0)),q&&(S?(u=u.add(S),s=U?s.add(m):s.delete(m)):(u=u.delete(m),s=s.delete(m)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const m="F"===this.query.limitType?u.last():u.first();u=u.delete(m.key),s=s.delete(m.key),r.track({type:1,doc:m})}return{ec:u,ic:r,zi:l,mutatedKeys:s}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const s=e.ic.xu();s.sort((p,m)=>function(v,E){const S=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return S(v)-S(E)}(p.type,m.type)||this.tc(p.doc,m.doc)),this.oc(r);const u=t?this.uc():[],l=0===this.Zu.size&&this.current?1:0,d=l!==this.Xu;return this.Xu=l,0!==s.length||d?{snapshot:new fa(this.query,e.ec,i,s,e.mutatedKeys,0===l,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),cc:u}:{cc:u}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Yp,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(t=>this.Yu=this.Yu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Yu=this.Yu.delete(t)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=_(),this.ec.forEach(r=>{this.ac(r.key)&&(this.Zu=this.Zu.add(r.key))});const t=[];return e.forEach(r=>{this.Zu.has(r)||t.push(new tg(r))}),this.Zu.forEach(r=>{e.has(r)||t.push(new eg(r))}),t}hc(e){this.Yu=e.ir,this.Zu=_();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return fa.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Dy{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Py{constructor(e){this.key=e,this.fc=!1}}class Oy{constructor(e,t,r,i,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.dc={},this.wc=new Jn(l=>Rn(l),Ks),this._c=new Map,this.mc=new Set,this.gc=new xe(V.comparator),this.yc=new Map,this.Ic=new Pd,this.Tc={},this.Ec=new Map,this.Ac=Xs.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}function Ly(n,e){return(Os=Os||(0,N.Z)(function*(t,r){const i=of(t);let s,u;const l=i.wc.get(r);if(l)s=l.targetId,i.sharedClientState.addLocalQueryTarget(s),u=l.view.lc();else{const d=yield oa(i.localStore,St(r)),p=i.sharedClientState.addLocalQueryTarget(d.targetId);s=d.targetId,u=yield ef(i,r,s,"current"===p,d.resumeToken),i.isPrimaryClient&&ql(i.remoteStore,d)}return u})).apply(this,arguments)}function ef(n,e,t,r,i){return(Va=Va||(0,N.Z)(function*(s,u,l,d,p){s.Rc=(q,te,ie)=>{var Q;return function(se,de,Le,Pt){return(Q=Q||(0,N.Z)(function*(er,li,L_,um){let ah=li.view.sc(L_);ah.zi&&(ah=yield Ml(er.localStore,li.query,!1).then(({documents:F_})=>li.view.sc(F_,ah)));const M_=um&&um.targetChanges.get(li.targetId),cm=li.view.applyChanges(ah,er.isPrimaryClient,M_);return rf(er,li.targetId,cm.cc),cm.snapshot})).apply(this,arguments)}(s,q,te,ie)};const m=yield Ml(s.localStore,u,!0),v=new ng(u,m.ir),E=v.sc(m.documents),S=gu.createSynthesizedTargetChangeForCurrentChange(l,d&&"Offline"!==s.onlineState,p),D=v.applyChanges(E,s.isPrimaryClient,S);rf(s,l,D.cc);const U=new Dy(u,l,v);return s.wc.set(u,U),s._c.has(l)?s._c.get(l).push(u):s._c.set(l,[u]),D.snapshot})).apply(this,arguments)}function My(n,e){return(bc=bc||(0,N.Z)(function*(t,r){const i=z(t),s=i.wc.get(r),u=i._c.get(s.targetId);if(u.length>1)return i._c.set(s.targetId,u.filter(l=>!Ks(l,r))),void i.wc.delete(r);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||(yield aa(i.localStore,s.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(s.targetId),bu(i.remoteStore,s.targetId),pa(i,s.targetId)}).catch(yr))):(pa(i,s.targetId),yield aa(i.localStore,s.targetId,!0))})).apply(this,arguments)}function rg(n,e){return(Rc=Rc||(0,N.Z)(function*(t,r){const i=z(t);try{const s=yield function ry(n,e){const t=z(n),r=e.snapshotVersion;let i=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Zi.newChangeBuffer({trackRemovals:!0});i=t.Ji;const l=[];e.targetChanges.forEach((m,v)=>{const E=i.get(v);if(!E)return;l.push(t.Bs.removeMatchingKeys(s,m.removedDocuments,v).next(()=>t.Bs.addMatchingKeys(s,m.addedDocuments,v)));let S=E.withSequenceNumber(s.currentSequenceNumber);var D,U,q;null!==e.targetMismatches.get(v)?S=S.withResumeToken(Xe.EMPTY_BYTE_STRING,Y.min()).withLastLimboFreeSnapshotVersion(Y.min()):m.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(m.resumeToken,r)),i=i.insert(v,S),U=S,q=m,(0===(D=E).resumeToken.approximateByteSize()||U.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=3e8||q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0)&&l.push(t.Bs.updateTargetData(s,S))});let d=Vt(),p=_();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,m))}),l.push(Lp(s,u,e.documentUpdates).next(m=>{d=m.nr,p=m.sr})),!r.isEqual(Y.min())){const m=t.Bs.getLastRemoteSnapshotVersion(s).next(v=>t.Bs.setTargetsMetadata(s,s.currentSequenceNumber,r));l.push(m)}return x.waitFor(l).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,p)).next(()=>d)}).then(s=>(t.Ji=i,s))}(i.localStore,r);r.targetChanges.forEach((u,l)=>{const d=i.yc.get(l);d&&(H(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?d.fc=!0:u.modifiedDocuments.size>0?H(d.fc):u.removedDocuments.size>0&&(H(d.fc),d.fc=!1))}),yield ai(i,s,r)}catch(s){yield yr(s)}})).apply(this,arguments)}function ig(n,e,t){const r=z(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.wc.forEach((s,u)=>{const l=u.view.Mu(e);l.snapshot&&i.push(l.snapshot)}),function(s,u){const l=z(s);l.onlineState=u;let d=!1;l.queries.forEach((p,m)=>{for(const v of m.listeners)v.Mu(u)&&(d=!0)}),d&&Xd(l)}(r.eventManager,e),i.length&&r.dc.nu(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Uy(n,e,t){return(bh=bh||(0,N.Z)(function*(r,i,s){const u=z(r);u.sharedClientState.updateQueryState(i,"rejected",s);const l=u.yc.get(i),d=l&&l.key;if(d){let p=new xe(V.comparator);p=p.insert(d,Ee.newNoDocument(d,Y.min()));const m=_().add(d),v=new pu(Y.min(),new Map,new xe(ee),p,m);yield rg(u,v),u.gc=u.gc.remove(d),u.yc.delete(i),sf(u)}else yield aa(u.localStore,i,!1).then(()=>pa(u,i,s)).catch(yr)})).apply(this,arguments)}function Vy(n,e){return(Ls=Ls||(0,N.Z)(function*(t,r){const i=z(t),s=r.batch.batchId;try{const u=yield function ny(n,e){const t=z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Zi.newChangeBuffer({trackRemovals:!0});return function(u,l,d,p){const m=d.batch,v=m.keys();let E=x.resolve();return v.forEach(S=>{E=E.next(()=>p.getEntry(l,S)).next(D=>{const U=d.docVersions.get(S);H(null!==U),D.version.compareTo(U)<0&&(m.applyToRemoteDocument(D,d),D.isValidDocument()&&(D.setReadTime(d.commitVersion),p.addEntry(D)))})}),E.next(()=>u.mutationQueue.removeMutationBatch(l,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let l=_();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(i.localStore,r);nf(i,s,null),tf(i,s),i.sharedClientState.updateMutationState(s,"acknowledged"),yield ai(i,u)}catch(u){yield yr(u)}})).apply(this,arguments)}function By(n,e,t){return(Nh=Nh||(0,N.Z)(function*(r,i,s){const u=z(r);try{const l=yield function(d,p){const m=z(d);return m.persistence.runTransaction("Reject batch","readwrite-primary",v=>{let E;return m.mutationQueue.lookupMutationBatch(v,p).next(S=>(H(null!==S),E=S.keys(),m.mutationQueue.removeMutationBatch(v,S))).next(()=>m.mutationQueue.performConsistencyCheck(v)).next(()=>m.documentOverlayCache.removeOverlaysForBatchId(v,E,p)).next(()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(v,E)).next(()=>m.localDocuments.getDocuments(v,E))})}(u.localStore,i);nf(u,i,s),tf(u,i),u.sharedClientState.updateMutationState(i,"rejected",s),yield ai(u,l)}catch(l){yield yr(l)}})).apply(this,arguments)}function tf(n,e){(n.Ec.get(e)||[]).forEach(t=>{t.resolve()}),n.Ec.delete(e)}function nf(n,e,t){const r=z(n);let i=r.Tc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Tc[r.currentUser.toKey()]=i}}function pa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n._c.get(e))n.wc.delete(r),t&&n.dc.Pc(r,t);n._c.delete(e),n.isPrimaryClient&&n.Ic.Is(e).forEach(r=>{n.Ic.containsKey(r)||sg(n,r)})}function sg(n,e){n.mc.delete(e.path.canonicalString());const t=n.gc.get(e);null!==t&&(bu(n.remoteStore,t),n.gc=n.gc.remove(e),n.yc.delete(t),sf(n))}function rf(n,e,t){for(const r of t)r instanceof eg?(n.Ic.addReference(r.key,e),Gy(n,r)):r instanceof tg?(M("SyncEngine","Document no longer in limbo: "+r.key),n.Ic.removeReference(r.key,e),n.Ic.containsKey(r.key)||sg(n,r.key)):j()}function Gy(n,e){const t=e.key,r=t.path.canonicalString();n.gc.get(t)||n.mc.has(r)||(M("SyncEngine","New document in limbo: "+t),n.mc.add(r),sf(n))}function sf(n){for(;n.mc.size>0&&n.gc.size<n.maxConcurrentLimboResolutions;){const e=n.mc.values().next().value;n.mc.delete(e);const t=new V(oe.fromString(e)),r=n.Ac.next();n.yc.set(r,new Py(t)),n.gc=n.gc.insert(t,r),ql(n.remoteStore,new oi(St(Hi(t.path)),r,"TargetPurposeLimboResolution",Tt.ct))}}function ai(n,e,t){return(Dc=Dc||(0,N.Z)(function*(r,i,s){var u;const l=z(r),d=[],p=[],m=[];l.wc.isEmpty()||(l.wc.forEach((v,E)=>{m.push(l.Rc(E,i,s).then(S=>{if((S||s)&&l.isPrimaryClient&&l.sharedClientState.updateQueryState(E.targetId,S?.fromCache?"not-current":"current"),S){d.push(S);const D=Ud.Li(E.targetId,S);p.push(D)}}))}),yield Promise.all(m),l.dc.nu(d),yield function(v,E){return(u=u||(0,N.Z)(function*(S,D){const U=z(S);try{yield U.persistence.runTransaction("notifyLocalViewChanges","readwrite",q=>x.forEach(D,te=>x.forEach(te.Fi,ie=>U.persistence.referenceDelegate.addReference(q,te.targetId,ie)).next(()=>x.forEach(te.Bi,ie=>U.persistence.referenceDelegate.removeReference(q,te.targetId,ie)))))}catch(q){if(!vr(q))throw q;M("LocalStore","Failed to update sequence numbers: "+q)}for(const q of D){const te=q.targetId;if(!q.fromCache){const ie=U.Ji.get(te),se=ie.withLastLimboFreeSnapshotVersion(ie.snapshotVersion);U.Ji=U.Ji.insert(te,se)}}})).apply(this,arguments)}(l.localStore,p))})).apply(this,arguments)}function zy(n,e){return(Pc=Pc||(0,N.Z)(function*(t,r){const i=z(t);if(!i.currentUser.isEqual(r)){M("SyncEngine","User change. New user:",r.toKey());const s=yield Pp(i.localStore,r);i.currentUser=r,(u=i).Ec.forEach(d=>{d.forEach(p=>{p.reject(new P(k.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),u.Ec.clear(),i.sharedClientState.handleUserChange(r,s.removedBatchIds,s.addedBatchIds),yield ai(i,s.er)}var u})).apply(this,arguments)}function $y(n,e){const t=z(n),r=t.yc.get(e);if(r&&r.fc)return _().add(r.key);{let i=_();const s=t._c.get(e);if(!s)return i;for(const u of s){const l=t.wc.get(u);i=i.unionWith(l.view.nc)}return i}}function jy(n,e){return(Fi=Fi||(0,N.Z)(function*(t,r){const i=z(t),s=yield Ml(i.localStore,r.query,!0),u=r.view.hc(s);return i.isPrimaryClient&&rf(i,r.targetId,u.cc),u})).apply(this,arguments)}function Ky(n,e){return(Oc=Oc||(0,N.Z)(function*(t,r){const i=z(t);return Fp(i.localStore,r).then(s=>ai(i,s))})).apply(this,arguments)}function Wy(n,e,t,r){return(He=He||(0,N.Z)(function*(i,s,u,l){const d=z(i),p=yield function(m,v){const E=z(m),S=z(E.mutationQueue);return E.persistence.runTransaction("Lookup mutation documents","readonly",D=>S.Sn(D,v).next(U=>U?E.localDocuments.getDocuments(D,U):x.resolve(null)))}(d.localStore,s);var v;null!==p?("pending"===u?yield ca(d.remoteStore):"acknowledged"===u||"rejected"===u?(nf(d,s,l||null),tf(d,s),v=s,z(z(d.localStore).mutationQueue).Cn(v)):j(),yield ai(d,p)):M("SyncEngine","Cannot apply mutation batch with id: "+s)})).apply(this,arguments)}function og(n,e,t){return(Lo=Lo||(0,N.Z)(function*(r,i,s){const u=z(r),l=[],d=[];for(const p of i){let m;const v=u._c.get(p);if(v&&0!==v.length){m=yield oa(u.localStore,St(v[0]));for(const E of v){const S=u.wc.get(E),D=yield jy(u,S);D.snapshot&&d.push(D.snapshot)}}else{const E=yield Mp(u.localStore,p);m=yield oa(u.localStore,E),yield ef(u,ag(E),p,!1,m.resumeToken)}l.push(m)}return u.dc.nu(d),l})).apply(this,arguments)}function ag(n){return ou(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Hy(n){const e=z(n);return z(z(e.localStore).persistence).$i()}function Qy(n,e,t,r){return(Mc=Mc||(0,N.Z)(function*(i,s,u,l){const d=z(i);if(d.vc)return void M("SyncEngine","Ignoring unexpected query state notification.");const p=d._c.get(s);if(p&&p.length>0)switch(u){case"current":case"not-current":{const m=yield Fp(d.localStore,uu(p[0])),v=pu.createSynthesizedRemoteEventForCurrentChange(s,"current"===u,Xe.EMPTY_BYTE_STRING);yield ai(d,m,v);break}case"rejected":yield aa(d.localStore,s,!0),pa(d,s,l);break;default:j()}})).apply(this,arguments)}function Yy(n,e,t){return(Fc=Fc||(0,N.Z)(function*(r,i,s){const u=of(r);if(u.vc){for(const l of i){if(u._c.has(l)){M("SyncEngine","Adding an already active target "+l);continue}const d=yield Mp(u.localStore,l),p=yield oa(u.localStore,d);yield ef(u,ag(d),p.targetId,!1,p.resumeToken),ql(u.remoteStore,p)}for(const l of s)u._c.has(l)&&(yield aa(u.localStore,l,!1).then(()=>{bu(u.remoteStore,l),pa(u,l)}).catch(yr))}})).apply(this,arguments)}function of(n){const e=z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=rg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=$y.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Uy.bind(null,e),e.dc.nu=ky.bind(null,e.eventManager),e.dc.Pc=by.bind(null,e.eventManager),e}function af(n){const e=z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vy.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=By.bind(null,e),e}class Nu{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,N.Z)(function*(){t.serializer=Cu(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Dp(this.persistence,new Rp,e.initialUser,this.serializer)}createPersistence(e){return new Od(Pl.zs,this.serializer)}createSharedClientState(e){return new qp}terminate(){var e=this;return(0,N.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class uf extends Nu{constructor(e,t,r){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,N.Z)(function*(){yield t().call(r,e),yield r.Vc.initialize(r,e),yield af(r.Vc.syncEngine),yield ca(r.Vc.remoteStore),yield r.persistence.Ii(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Dp(this.persistence,new Rp,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Ep(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new zh(t,this.persistence);return new Gh(e.asyncQueue,r)}createPersistence(e){const t=Fd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Bt.withCacheSize(this.cacheSizeBytes):Bt.DEFAULT;return new Md(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,zp(),Bl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new qp}}class ug extends uf{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,N.Z)(function*(){var i;yield t().call(r,e);const s=r.Vc.syncEngine;r.sharedClientState instanceof Gd&&(r.sharedClientState.syncEngine={jr:Wy.bind(null,s),zr:Qy.bind(null,s),Wr:Yy.bind(null,s),$i:Hy.bind(null,s),Qr:Ky.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.Ii(function(u){return(i=i||(0,N.Z)(function*(l){yield function Zy(n,e){return(Lc=Lc||(0,N.Z)(function*(t,r){const i=z(t);if(of(i),af(i),!0===r&&!0!==i.vc){const s=i.sharedClientState.getAllActiveQueryTargets(),u=yield og(i,s.toArray());i.vc=!0,yield Zd(i.remoteStore,!0);for(const l of u)ql(i.remoteStore,l)}else if(!1===r&&!1!==i.vc){const s=[];let u=Promise.resolve();i._c.forEach((l,d)=>{i.sharedClientState.isLocalQueryTarget(d)?s.push(d):u=u.then(()=>(pa(i,d),aa(i.localStore,d,!0))),bu(i.remoteStore,d)}),yield u,yield og(i,s),function(l){const d=z(l);d.yc.forEach((p,m)=>{bu(d.remoteStore,m)}),d.Ic.Ts(),d.yc=new Map,d.gc=new xe(V.comparator)}(i),i.vc=!1,yield Zd(i.remoteStore,!1)}})).apply(this,arguments)}(r.Vc.syncEngine,l),r.gcScheduler&&(l&&!r.gcScheduler.started?r.gcScheduler.start():l||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(l&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():l||r.indexBackfillerScheduler.stop())})).apply(this,arguments)})})()}createSharedClientState(e){const t=zp();if(!Gd.D(t))throw new P(k.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Fd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Gd(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ga{initialize(e,t){var r=this;return(0,N.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>ig(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=zy.bind(null,r.syncEngine),yield Zd(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Cy}createDatastore(e){const t=Cu(e.databaseInfo.databaseId),r=new ly(e.databaseInfo);return new fy(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,s=l=>ig(this.syncEngine,l,0),u=Gp.D()?new Gp:new ay,new my(t,r,i,s,u);var t,r,i,s,u}createSyncEngine(e,t){return function(r,i,s,u,l,d,p){const m=new Oy(r,i,s,u,l,d);return p&&(m.vc=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e;return function(t){return(e=e||(0,N.Z)(function*(r){const i=z(r);M("RemoteStore","RemoteStore shutting down."),i.vu.add(5),yield ua(i),i.Pu.shutdown(),i.bu.set("Unknown")})).apply(this,arguments)}(this.remoteStore)}}function cg(n,e=10240){let t=0;return{read:()=>(0,N.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,N.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class zl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Ye("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ev{constructor(e,t){this.Cc=e,this.serializer=t,this.metadata=new je,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then(r=>{r&&r.Qu()?this.metadata.resolve(r.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.Gu)}`))},r=>this.metadata.reject(r))}close(){return this.Cc.cancel()}getMetadata(){var e=this;return(0,N.Z)(function*(){return e.metadata.promise})()}bc(){var e=this;return(0,N.Z)(function*(){return yield e.getMetadata(),e.Nc()})()}Nc(){var e=this;return(0,N.Z)(function*(){const t=yield e.kc();if(null===t)return null;const r=e.xc.decode(t),i=Number(r);isNaN(i)&&e.Mc(`length string (${r}) is not valid number`);const s=yield e.$c(i);return new Ny(JSON.parse(s),t.length+i)})()}Oc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}kc(){var e=this;return(0,N.Z)(function*(){for(;e.Oc()<0&&!(yield e.Fc()););if(0===e.buffer.length)return null;const t=e.Oc();t<0&&e.Mc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}$c(e){var t=this;return(0,N.Z)(function*(){for(;t.buffer.length<e;)(yield t.Fc())&&t.Mc("Reached the end of bundle when more is expected.");const r=t.xc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Mc(e){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${e}`)}Fc(){var e=this;return(0,N.Z)(function*(){const t=yield e.Cc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class tv{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,N.Z)(function*(){var r;if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new P(k.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const i=yield function(s,u){return(r=r||(0,N.Z)(function*(l,d){const p=z(l),m=yu(p.serializer)+"/documents",v={documents:d.map(U=>mu(p.serializer,U))},E=yield p.vo("BatchGetDocuments",m,v,d.length),S=new Map;E.forEach(U=>{const q=function Em(n,e){return"found"in e?function(t,r){H(!!r.found);const i=Cr(t,r.found.name),s=nt(r.found.updateTime),u=r.found.createTime?nt(r.found.createTime):Y.min(),l=new yt({mapValue:{fields:r.found.fields}});return Ee.newFoundDocument(i,s,u,l)}(n,e):"missing"in e?function(t,r){H(!!r.missing),H(!!r.readTime);const i=Cr(t,r.missing),s=nt(r.readTime);return Ee.newNoDocument(i,s)}(n,e):j()}(p.serializer,U);S.set(q.key.toString(),q)});const D=[];return d.forEach(U=>{const q=S.get(U.toString());H(!!q),D.push(q)}),D})).apply(this,arguments)}(t.datastore,e);return i.forEach(s=>t.recordVersion(s)),i})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ta(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,N.Z)(function*(){var t;if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const r=e.readVersions;e.mutations.forEach(i=>{r.delete(i.key.toString())}),r.forEach((i,s)=>{const u=V.fromPath(s);e.mutations.push(new gd(u,e.precondition(u)))}),yield function(i,s){return(t=t||(0,N.Z)(function*(u,l){const d=z(u),p=yu(d.serializer)+"/documents",m={writes:l.map(v=>vu(d.serializer,v))};yield d.Io("Commit",p,m)})).apply(this,arguments)}(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw j();t=Y.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new P(k.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Y.min())?Ke.exists(!1):Ke.updateTime(t):Ke.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Y.min()))throw new P(k.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ke.updateTime(t)}return Ke.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class nv{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Bc=r.maxAttempts,this.qo=new $d(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){var e=this;this.qo.No((0,N.Z)(function*(){const t=new tv(e.datastore),r=e.qc(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Uc(s)}))}).catch(i=>{e.Uc(i)})}))}qc(e){try{const t=this.updateFunction(e);return!$i(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Lc(),Promise.resolve()))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Lf(t)}return!1}}class rv{constructor(e,t,r,i){var u,s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Qe.UNAUTHENTICATED,this.clientId=$c.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(l){return(u=u||(0,N.Z)(function*(d){M("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d})).apply(this,arguments)}),this.appCheckCredentials.start(r,l=>(M("FirestoreClient","Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}getConfiguration(){var e=this;return(0,N.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new P(k.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,N.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=ha(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function $l(n,e){return(Uc=Uc||(0,N.Z)(function*(t,r){var i;t.asyncQueue.verifyOperationInProgress(),M("FirestoreClient","Initializing OfflineComponentProvider");const s=yield t.getConfiguration();yield r.initialize(s);let u=s.initialUser;t.setCredentialChangeListener(function(l){return(i=i||(0,N.Z)(function*(d){u.isEqual(d)||(yield Pp(r.localStore,d),u=d)})).apply(this,arguments)}),r.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=r})).apply(this,arguments)}function cf(n,e){return(Ba=Ba||(0,N.Z)(function*(t,r){t.asyncQueue.verifyOperationInProgress();const i=yield lf(t);M("FirestoreClient","Initializing OnlineComponentProvider");const s=yield t.getConfiguration();yield r.initialize(i,s),t.setCredentialChangeListener(u=>Qp(r.remoteStore,u)),t.setAppCheckTokenChangeListener((u,l)=>Qp(r.remoteStore,l)),t._onlineComponents=r})).apply(this,arguments)}function lg(n){return"FirebaseError"===n.name?n.code===k.FAILED_PRECONDITION||n.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function lf(n){return(Vc=Vc||(0,N.Z)(function*(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){M("FirestoreClient","Using user provided OfflineComponentProvider");try{yield $l(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!lg(r))throw r;nn("Error using user provided cache. Falling back to memory cache: "+r),yield $l(e,new Nu)}}else M("FirestoreClient","Using default OfflineComponentProvider"),yield $l(e,new Nu);return e._offlineComponents})).apply(this,arguments)}function jl(n){return(Ms=Ms||(0,N.Z)(function*(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(M("FirestoreClient","Using user provided OnlineComponentProvider"),yield cf(e,e._uninitializedComponentsProvider._online)):(M("FirestoreClient","Using default OnlineComponentProvider"),yield cf(e,new ga))),e._onlineComponents})).apply(this,arguments)}function hg(n){return lf(n).then(e=>e.persistence)}function Kl(n){return lf(n).then(e=>e.localStore)}function dg(n){return jl(n).then(e=>e.remoteStore)}function hf(n){return jl(n).then(e=>e.syncEngine)}function ma(n){return(qa=qa||(0,N.Z)(function*(e){const t=yield jl(e),r=t.eventManager;return r.onListen=Ly.bind(null,t.syncEngine),r.onUnlisten=My.bind(null,t.syncEngine),r})).apply(this,arguments)}function pg(n,e,t={}){const r=new je;return n.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return function(i,s,u,l,d){const p=new zl({next:v=>{s.enqueueAndForget(()=>Yd(i,m));const E=v.docs.has(u);!E&&v.fromCache?d.reject(new P(k.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&v.fromCache&&l&&"server"===l.source?d.reject(new P(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),m=new Jd(Hi(u.path),p,{includeMetadataChanges:!0,Ku:!0});return Qd(i,m)}(yield ma(n),n.asyncQueue,e,t,r)})),r.promise}function gg(n,e,t={}){const r=new je;return n.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return function(i,s,u,l,d){const p=new zl({next:v=>{s.enqueueAndForget(()=>Yd(i,m)),v.fromCache&&"server"===l.source?d.reject(new P(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),m=new Jd(u,p,{includeMetadataChanges:!0,Ku:!0});return Qd(i,m)}(yield ma(n),n.asyncQueue,e,t,r)})),r.promise}function mg(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const yg=new Map;function df(n,e,t){if(!t)throw new P(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function vg(n,e,t,r){if(!0===e&&!0===r)throw new P(k.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function _g(n){if(!V.isDocumentKey(n))throw new P(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ig(n){if(V.isDocumentKey(n))throw new P(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Wl(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":j()}function he(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new P(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Wl(n);throw new P(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function wg(n,e){if(e<=0)throw new P(k.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Eg{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new P(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new P(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=mg(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new P(k.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new P(k.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new P(k.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ru{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Eg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new P(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new P(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Eg(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Ph;switch(t.type){case"firstParty":return new Mh(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new P(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=yg.get(e);t&&(M("ComponentProvider","Removing Datastore"),yg.delete(e),t.terminate())}(this),Promise.resolve()}}class Be{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Be(this.firestore,e,this._key)}}class Dt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Dt(this.firestore,e,this._query)}}class kr extends Dt{constructor(e,t,r){super(e,t,Hi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Be(this.firestore,null,new V(e))}withConverter(e){return new kr(this.firestore,e,this._path)}}function Sg(n,e,...t){if(n=(0,fe.m9)(n),df("collection","path",e),n instanceof Ru){const r=oe.fromString(e,...t);return Ig(r),new kr(n,null,r)}{if(!(n instanceof Be||n instanceof kr))throw new P(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(oe.fromString(e,...t));return Ig(r),new kr(n.firestore,null,r)}}function Zl(n,e,...t){if(n=(0,fe.m9)(n),1===arguments.length&&(e=$c.A()),df("doc","path",e),n instanceof Ru){const r=oe.fromString(e,...t);return _g(r),new Be(n,null,new V(r))}{if(!(n instanceof Be||n instanceof kr))throw new P(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(oe.fromString(e,...t));return _g(r),new Be(n.firestore,n instanceof kr?n.converter:null,new V(r))}}function Ag(n,e){return n=(0,fe.m9)(n),e=(0,fe.m9)(e),(n instanceof Be||n instanceof kr)&&(e instanceof Be||e instanceof kr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function ff(n,e){return n=(0,fe.m9)(n),e=(0,fe.m9)(e),n instanceof Dt&&e instanceof Dt&&n.firestore===e.firestore&&Ks(n._query,e._query)&&n.converter===e.converter}class fv{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new $d(this,"async_queue_retry"),this.Xc=()=>{const t=Bl();t&&M("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const e=Bl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Bl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const t=new je;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}ea(){var e=this;return(0,N.Z)(function*(){if(0!==e.Qc.length){try{yield e.Qc[0](),e.Qc.shift(),e.qo.reset()}catch(t){if(!vr(t))throw t;M("AsyncQueue","Operation failed with retryable error: "+t)}e.Qc.length>0&&e.qo.No(()=>e.ea())}})()}ta(e){const t=this.Gc.then(()=>(this.Hc=!0,e().catch(r=>{throw this.Wc=r,this.Hc=!1,Ye("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(r)),r}).then(r=>(this.Hc=!1,r))));return this.Gc=t,t}enqueueAfterDelay(e,t,r){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const i=Hd.createAndSchedule(this,e,t,r,s=>this.na(s));return this.zc.push(i),i}Zc(){this.Wc&&j()}verifyOperationInProgress(){}sa(){var e=this;return(0,N.Z)(function*(){let t;do{t=e.Gc,yield t}while(t!==e.Gc)})()}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function pf(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class pv{constructor(){this._progressObserver={},this._taskCompletionResolver=new je,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class qe extends Ru{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new fv,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||xg(this),this._firestoreClient.terminate()}}function rt(n){return n._firestoreClient||xg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function xg(n){var e,t,r;const i=n._freezeSettings(),s=(l=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new od(n._databaseId,l,n._persistenceKey,(p=i).host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,mg(p.experimentalLongPollingOptions),p.useFetchStreams));var l,p;n._firestoreClient=new rv(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.cache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.cache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function Cg(n,e,t){const r=new je;return n.asyncQueue.enqueue((0,N.Z)(function*(){try{yield $l(n,t),yield cf(n,e),r.resolve()}catch(i){const s=i;if(!lg(s))throw s;nn("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function kg(n){if(n._initialized||n._terminated)throw new P(k.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class br{constructor(e){this._byteString=e}static fromBase64String(e){try{return new br(Xe.fromBase64String(e))}catch(t){throw new P(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new br(Xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ui{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new P(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ae(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class eo{constructor(e){this._methodName=e}}class Hl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new P(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new P(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}}const Av=/^__.*__$/;class xv{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new si(e,this.data,this.fieldMask,t,this.fieldTransforms):new ea(e,this.data,t,this.fieldTransforms)}}class bg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new si(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ng(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}class Ql{constructor(e,t,r,i,s,u){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.ua(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new Ql(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:r,la:!1});return i.fa(e),i}da(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:r,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return Jl(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(Ng(this.ca)&&Av.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Cv{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Cu(e)}ya(e,t,r,i=!1){return new Ql({ca:e,methodName:t,ga:r,path:Ae.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function to(n){const e=n._freezeSettings(),t=Cu(n._databaseId);return new Cv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Yl(n,e,t,r,i,s={}){const u=n.ya(s.merge||s.mergeFields?2:0,e,t,i);vf("Data must be an object, but it was:",u,r);const l=Pg(r,u);let d,p;if(s.merge)d=new Ut(u.fieldMask),p=u.fieldTransforms;else if(s.mergeFields){const m=[];for(const v of s.mergeFields){const E=Ou(e,v,t);if(!u.contains(E))throw new P(k.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Lg(m,E)||m.push(E)}d=new Ut(m),p=u.fieldTransforms.filter(v=>d.covers(v.field))}else d=null,p=u.fieldTransforms;return new xv(new yt(l),d,p)}class Pu extends eo{_toFieldTransform(e){if(2!==e.ca)throw e._a(1===e.ca?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Pu}}function Rg(n,e,t){return new Ql({ca:3,ga:e.settings.ga,methodName:n._methodName,la:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class gf extends eo{_toFieldTransform(e){return new ii(e.path,new pn)}isEqual(e){return e instanceof gf}}class kv extends eo{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=Rg(this,e,!0),r=this.pa.map(s=>no(s,t)),i=new Sr(r);return new ii(e.path,i)}isEqual(e){return this===e}}class bv extends eo{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=Rg(this,e,!0),r=this.pa.map(s=>no(s,t)),i=new Ar(r);return new ii(e.path,i)}isEqual(e){return this===e}}class Nv extends eo{constructor(e,t){super(e),this.Ia=t}_toFieldTransform(e){const t=new xr(e.serializer,Z(e.serializer,this.Ia));return new ii(e.path,t)}isEqual(e){return this===e}}function mf(n,e,t,r){const i=n.ya(1,e,t);vf("Data must be an object, but it was:",i,r);const s=[],u=yt.empty();_r(r,(d,p)=>{const m=Xl(e,d,t);p=(0,fe.m9)(p);const v=i.da(m);if(p instanceof Pu)s.push(m);else{const E=no(p,v);null!=E&&(s.push(m),u.set(m,E))}});const l=new Ut(s);return new bg(u,l,i.fieldTransforms)}function yf(n,e,t,r,i,s){const u=n.ya(1,e,t),l=[Ou(e,r,t)],d=[i];if(s.length%2!=0)throw new P(k.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<s.length;E+=2)l.push(Ou(e,s[E])),d.push(s[E+1]);const p=[],m=yt.empty();for(let E=l.length-1;E>=0;--E)if(!Lg(p,l[E])){const S=l[E];let D=d[E];D=(0,fe.m9)(D);const U=u.da(S);if(D instanceof Pu)p.push(S);else{const q=no(D,U);null!=q&&(p.push(S),m.set(S,q))}}const v=new Ut(p);return new bg(m,v,u.fieldTransforms)}function Dg(n,e,t,r=!1){return no(t,n.ya(r?4:3,e))}function no(n,e){if(Og(n=(0,fe.m9)(n)))return vf("Unsupported field value:",e,n),Pg(n,e);if(n instanceof eo)return function(t,r){if(!Ng(r.ca))throw r._a(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r._a(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,r){const i=[];let s=0;for(const u of t){let l=no(u,r.wa(s));null==l&&(l={nullValue:"NULL_VALUE"}),i.push(l),s++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,fe.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Z(r.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=Oe.fromDate(t);return{timestampValue:na(r.serializer,i)}}if(t instanceof Oe){const i=new Oe(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:na(r.serializer,i)}}if(t instanceof Hl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof br)return{bytesValue:jf(r.serializer,t._byteString)};if(t instanceof Be){const i=r.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw r._a(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Ed(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r._a(`Unsupported field value: ${Wl(t)}`)}(n,e)}function Pg(n,e){const t={};return qo(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_r(n,(r,i)=>{const s=no(i,e.ha(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function Og(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Oe||n instanceof Hl||n instanceof br||n instanceof Be||n instanceof eo)}function vf(n,e,t){if(!Og(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Wl(t);throw e._a("an object"===r?n+" a custom object":n+" "+r)}var r}function Ou(n,e,t){if((e=(0,fe.m9)(e))instanceof ui)return e._internalPath;if("string"==typeof e)return Xl(n,e);throw Jl("Field path arguments must be of type string or ",n,!1,void 0,t)}const Rv=new RegExp("[~\\*/\\[\\]]");function Xl(n,e,t){if(e.search(Rv)>=0)throw Jl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ui(...e.split("."))._internalPath}catch{throw Jl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Jl(n,e,t,r,i){const s=r&&!r.isEmpty(),u=void 0!==i;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(s||u)&&(d+=" (found",s&&(d+=` in field ${r}`),u&&(d+=` in document ${i}`),d+=")"),new P(k.INVALID_ARGUMENT,l+n+d)}function Lg(n,e){return n.some(t=>t.isEqual(e))}class Lu{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Be(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Dv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(eh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Dv extends Lu{data(){return super.data()}}function eh(n,e){return"string"==typeof e?Xl(n,e):e instanceof ui?e._internalPath:e._delegate._internalPath}function Mg(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new P(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _f{}class Mu extends _f{}function is(n,e,...t){let r=[];e instanceof _f&&r.push(e),r=r.concat(t),function(i){const s=i.filter(l=>l instanceof ya).length,u=i.filter(l=>l instanceof Fu).length;if(s>1||s>0&&u>0)throw new P(k.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Fu extends Mu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Fu(e,t,r)}_apply(e){const t=this._parse(e);return Bg(e._query,t),new Dt(e.firestore,e.converter,At(e._query,t))}_parse(e){const t=to(e.firestore);return function(i,s,u,l,d,p,m){let v;if(d.isKeyField()){if("array-contains"===p||"array-contains-any"===p)throw new P(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if("in"===p||"not-in"===p){Vg(m,p);const E=[];for(const S of m)E.push(Ug(l,i,S));v={arrayValue:{values:E}}}else v=Ug(l,i,m)}else"in"!==p&&"not-in"!==p&&"array-contains-any"!==p||Vg(m,p),v=Dg(u,"where",m,"in"===p||"not-in"===p);return ae.create(d,p,v)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class ya extends _f{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ya(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:_e.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,i){let s=r;const u=i.getFlattenedFilters();for(const l of u)Bg(s,l),s=At(s,l)}(e._query,t),new Dt(e.firestore,e.converter,At(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class If extends Mu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new If(e,t)}_apply(e){const t=function(r,i,s){if(null!==r.startAt)throw new P(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new P(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new Wi(i,s);return function(l,d){if(null===Yo(l)){const p=Xo(l);null!==p&&qg(0,p,d.field)}}(r,u),u}(e._query,this._field,this._direction);return new Dt(e.firestore,e.converter,function(r,i){const s=r.explicitOrderBy.concat([i]);return new Yn(r.path,r.collectionGroup,s,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class th extends Mu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new th(e,t,r)}_apply(e){return new Dt(e.firestore,e.converter,Qi(e._query,this._limit,this._limitType))}}class nh extends Mu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new nh(e,t,r)}_apply(e){const t=Fg(e,this.type,this._docOrFields,this._inclusive);return new Dt(e.firestore,e.converter,(i=t,new Yn((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}class rh extends Mu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new rh(e,t,r)}_apply(e){const t=Fg(e,this.type,this._docOrFields,this._inclusive);return new Dt(e.firestore,e.converter,(i=t,new Yn((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function Fg(n,e,t,r){if(t[0]=(0,fe.m9)(t[0]),t[0]instanceof Lu)return function(i,s,u,l,d){if(!l)throw new P(k.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const p=[];for(const m of ni(i))if(m.field.isKeyField())p.push(Jr(s,l.key));else{const v=l.data.field(m.field);if(zo(v))throw new P(k.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===v){const E=m.field.canonicalString();throw new P(k.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${E}' (used as the orderBy) does not exist.`)}p.push(v)}return new Er(p,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=to(n.firestore);return function(s,u,l,d,p,m){const v=s.explicitOrderBy;if(p.length>v.length)throw new P(k.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const E=[];for(let S=0;S<p.length;S++){const D=p[S];if(v[S].field.isKeyField()){if("string"!=typeof D)throw new P(k.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof D}`);if(!au(s)&&-1!==D.indexOf("/"))throw new P(k.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${D}' contains a slash.`);const U=s.path.child(oe.fromString(D));if(!V.isDocumentKey(U))throw new P(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${U}' is not because it contains an odd number of segments.`);const q=new V(U);E.push(Jr(u,q))}else{const U=Dg(l,d,D);E.push(U)}}return new Er(E,m)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Ug(n,e,t){if("string"==typeof(t=(0,fe.m9)(t))){if(""===t)throw new P(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!au(e)&&-1!==t.indexOf("/"))throw new P(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(oe.fromString(t));if(!V.isDocumentKey(r))throw new P(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Jr(n,new V(r))}if(t instanceof Be)return Jr(n,t._key);throw new P(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wl(t)}.`)}function Vg(n,e){if(!Array.isArray(n)||0===n.length)throw new P(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Bg(n,e){if(e.isInequality()){const r=Xo(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new P(k.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=Yo(n);null!==s&&qg(0,i,s)}const t=function(r,i){for(const s of r)for(const u of s.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new P(k.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function qg(n,e,t){if(!t.isEqual(e))throw new P(k.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class wf{convertValue(e,t="none"){switch(Hn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Wn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return _r(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Hl(Ve(e.latitude),Ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=$o(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(qs(e));default:return null}}convertTimestamp(e){const t=Kn(e);return new Oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=oe.fromString(e);H(tp(r));const i=new Zn(r.get(1),r.get(3)),s=new V(r.popFirst(5));return i.isEqual(t)||Ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ih(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class qv extends wf{constructor(e){super(),this.firestore=e}convertBytes(e){return new br(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Be(this.firestore,null,t)}}class ro{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ci extends Lu{constructor(e,t,r,i,s,u){super(e,t,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Uu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(eh("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Uu extends ci{data(e={}){return super.data(e)}}class ss{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ro(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Uu(this._firestore,this._userDataWriter,r.key,r,new ro(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(u=>({type:"added",doc:new Uu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ro(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const l=new Uu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ro(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,p=-1;return 0!==u.type&&(d=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),p=s.indexOf(u.doc.key)),{type:zv(u.type),doc:l,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function zv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function zg(n,e){return n instanceof ci&&e instanceof ci?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ss&&e instanceof ss&&n._firestore===e._firestore&&ff(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class os extends wf{constructor(e){super(),this.firestore=e}convertBytes(e){return new br(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Be(this.firestore,null,t)}}function $g(n,e,t){n=he(n,Be);const r=he(n.firestore,qe),i=ih(n.converter,e,t);return va(r,[Yl(to(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Ke.none())])}function jg(n,e,t,...r){n=he(n,Be);const i=he(n.firestore,qe),s=to(i);let u;return u="string"==typeof(e=(0,fe.m9)(e))||e instanceof ui?yf(s,"updateDoc",n._key,e,t,r):mf(s,"updateDoc",n._key,e),va(i,[u.toMutation(n._key,Ke.exists(!0))])}function Kg(n,...e){var t,r,i;n=(0,fe.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||pf(e[u])||(s=e[u],u++);const l={includeMetadataChanges:s.includeMetadataChanges};if(pf(e[u])){const v=e[u];e[u]=null===(t=v.next)||void 0===t?void 0:t.bind(v),e[u+1]=null===(r=v.error)||void 0===r?void 0:r.bind(v),e[u+2]=null===(i=v.complete)||void 0===i?void 0:i.bind(v)}let d,p,m;if(n instanceof Be)p=he(n.firestore,qe),m=Hi(n._key.path),d={next:v=>{e[u]&&e[u](Ef(p,n,v))},error:e[u+1],complete:e[u+2]};else{const v=he(n,Dt);p=he(v.firestore,qe),m=v._query;const E=new os(p);d={next:S=>{e[u]&&e[u](new ss(p,E,v,S))},error:e[u+1],complete:e[u+2]},Mg(n._query)}return function(v,E,S,D){const U=new zl(D),q=new Jd(E,U,S);return v.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return Qd(yield ma(v),q)})),()=>{U.Dc(),v.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return Yd(yield ma(v),q)}))}}(rt(p),m,l,d)}function va(n,e){return function(t,r){const i=new je;return t.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return function Fy(n,e,t){return(Nc=Nc||(0,N.Z)(function*(r,i,s){const u=af(r);try{const l=yield function(d,p){const m=z(d),v=Oe.now(),E=p.reduce((U,q)=>U.add(q.key),_());let S,D;return m.persistence.runTransaction("Locally write mutations","readwrite",U=>{let q=Vt(),te=_();return m.Zi.getEntries(U,E).next(ie=>{q=ie,q.forEach((Q,se)=>{se.isValidDocument()||(te=te.add(Q))})}).next(()=>m.localDocuments.getOverlayedDocuments(U,q)).next(ie=>{S=ie;const Q=[];for(const se of p){const de=dm(se,S.get(se.key).overlayedDocument);null!=de&&Q.push(new si(se.key,de,Wo(de.value.mapValue),Ke.exists(!0)))}return m.mutationQueue.addMutationBatch(U,v,Q,p)}).next(ie=>{D=ie;const Q=ie.applyToLocalDocumentSet(S,te);return m.documentOverlayCache.saveOverlays(U,ie.batchId,Q)})}).then(()=>({batchId:D.batchId,changes:o(S)}))}(u.localStore,i);u.sharedClientState.addPendingMutation(l.batchId),function(d,p,m){let v=d.Tc[d.currentUser.toKey()];v||(v=new xe(ee)),v=v.insert(p,m),d.Tc[d.currentUser.toKey()]=v}(u,l.batchId,s),yield ai(u,l.changes),yield ca(u.remoteStore)}catch(l){const d=ha(l,"Failed to persist write");s.reject(d)}})).apply(this,arguments)}(yield hf(t),r,i)})),i.promise}(rt(n),e)}function Ef(n,e,t){const r=t.docs.get(e._key),i=new os(n);return new ci(n,i,e._key,r,new ro(t.hasPendingWrites,t.fromCache),e.converter)}const a_={maxAttempts:5};class Wg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=to(e)}set(e,t,r){this._verifyNotCommitted();const i=as(e,this._firestore),s=ih(i.converter,t,r),u=Yl(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(u.toMutation(i._key,Ke.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=as(e,this._firestore);let u;return u="string"==typeof(t=(0,fe.m9)(t))||t instanceof ui?yf(this._dataReader,"WriteBatch.update",s._key,t,r,i):mf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,Ke.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=as(e,this._firestore);return this._mutations=this._mutations.concat(new ta(t._key,Ke.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new P(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function as(n,e){if((n=(0,fe.m9)(n)).firestore!==e)throw new P(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class u_ extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=to(e)}get(e){const t=as(e,this._firestore),r=new qv(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return j();const s=i[0];if(s.isFoundDocument())return new Lu(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Lu(this._firestore,r,t._key,null,t.converter);throw j()})}set(e,t,r){const i=as(e,this._firestore),s=ih(i.converter,t,r),u=Yl(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,r);return this._transaction.set(i._key,u),this}update(e,t,r,...i){const s=as(e,this._firestore);let u;return u="string"==typeof(t=(0,fe.m9)(t))||t instanceof ui?yf(this._dataReader,"Transaction.update",s._key,t,r,i):mf(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=as(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=as(e,this._firestore),r=new os(this._firestore);return super.get(e).then(i=>new ci(this._firestore,r,t._key,i._document,new ro(!1,!1),t.converter))}}function Tf(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new P("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Hg(){if(typeof Uint8Array>"u")throw new P("unimplemented","Uint8Arrays are not available in this environment.")}function Qg(){if(!function Ha(){return typeof atob<"u"}())throw new P("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Vi=$t.SDK_VERSION,(0,$t._registerComponent)(new jt.wA("firestore",(t,{instanceIdentifier:r,options:i})=>{const s=t.getProvider("app").getImmediate(),u=new qe(new Ga(t.getProvider("auth-internal")),new Fh(t.getProvider("app-check-internal")),function(l,d){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new P(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zn(l.options.projectId,d)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,$t.registerVersion)(Ui,"3.13.0",n),(0,$t.registerVersion)(Ui,"3.13.0","esm2017")}();class Vu{constructor(e){this._delegate=e}static fromBase64String(e){return Qg(),new Vu(br.fromBase64String(e))}static fromUint8Array(e){return Hg(),new Vu(br.fromUint8Array(e))}toBase64(){return Qg(),this._delegate.toBase64()}toUint8Array(){return Hg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Sf(n){return function y_(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class v_{enableIndexedDbPersistence(e,t){return function mv(n,e){kg(n=he(n,qe));const t=rt(n);if(t._uninitializedComponentsProvider)throw new P(k.FAILED_PRECONDITION,"SDK cache is already specified.");nn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new ga;return Cg(t,i,new uf(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function yv(n){kg(n=he(n,qe));const e=rt(n);if(e._uninitializedComponentsProvider)throw new P(k.FAILED_PRECONDITION,"SDK cache is already specified.");nn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new ga;return Cg(e,r,new ug(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function vv(n){if(n._initialized&&!n._terminated)throw new P(k.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new je;return n._queue.enqueueAndForgetEvenWhileRestricted((0,N.Z)(function*(){try{var t;yield function(r){return(t=t||(0,N.Z)(function*(i){if(!Qt.D())return Promise.resolve();const s=i+"main";yield Qt.delete(s)})).apply(this,arguments)}(Fd(n._databaseId,n._persistenceKey)),e.resolve()}catch(r){e.reject(r)}})),e.promise}(e._delegate)}}class Yg{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Zn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&nn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Tg(n,e,t,r={}){var i;const s=(n=he(n,Ru))._getSettings(),u=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==u&&nn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:u,ssl:!1})),r.mockUserToken){let l,d;if("string"==typeof r.mockUserToken)l=r.mockUserToken,d=Qe.MOCK_USER;else{l=(0,fe.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new P(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Qe(p)}n._authCredentials=new Oh(new qc(l,d))}}(this._delegate,e,t,r)}enableNetwork(){return function Iv(n){return function iv(n){return n.asyncQueue.enqueue((0,N.Z)(function*(){const e=yield hg(n),t=yield dg(n);return e.setNetworkEnabled(!0),function(r){const i=z(r);return i.vu.delete(0),ku(i)}(t)}))}(rt(n=he(n,qe)))}(this._delegate)}disableNetwork(){return function wv(n){return function sv(n){return n.asyncQueue.enqueue((0,N.Z)(function*(){var e;const t=yield hg(n),r=yield dg(n);return t.setNetworkEnabled(!1),function(i){return(e=e||(0,N.Z)(function*(s){const u=z(s);u.vu.add(0),yield ua(u),u.bu.set("Offline")})).apply(this,arguments)}(r)}))}(rt(n=he(n,qe)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,vg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function _v(n){return function(e){const t=new je;return e.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return function qy(n,e){return(jn=jn||(0,N.Z)(function*(t,r){const i=z(t);ns(i.remoteStore)||M("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=yield function(l){const d=z(l);return d.persistence.runTransaction("Get highest unacknowledged batch id","readonly",p=>d.mutationQueue.getHighestUnacknowledgedBatchId(p))}(i.localStore);if(-1===s)return void r.resolve();const u=i.Ec.get(s)||[];u.push(r),i.Ec.set(s,u)}catch(s){const u=ha(s,"Initialization of waitForPendingWrites() operation failed");r.reject(u)}})).apply(this,arguments)}(yield hf(e),t)})),t.promise}(rt(n=he(n,qe)))}(this._delegate)}onSnapshotsInSync(e){return function Xv(n,e){return function uv(n,e){const t=new zl(e);return n.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return r=yield ma(n),i=t,z(r).ku.add(i),void i.next();var r,i})),()=>{t.Dc(),n.asyncQueue.enqueueAndForget((0,N.Z)(function*(){return r=yield ma(n),i=t,void z(r).ku.delete(i);var r,i}))}}(rt(n=he(n,qe)),pf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new P("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new _a(this,Sg(this._delegate,e))}catch(t){throw Yt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Dn(this,Zl(this._delegate,e))}catch(t){throw Yt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Xt(this,function dv(n,e){if(n=he(n,Ru),df("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new P(k.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Dt(n,null,(t=e,new Yn(oe.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Yt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function c_(n,e,t){n=he(n,qe);const r=Object.assign(Object.assign({},a_),t);return function(i){if(i.maxAttempts<1)throw new P(k.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,s,u){const l=new je;return i.asyncQueue.enqueueAndForget((0,N.Z)(function*(){const d=yield function fg(n){return jl(n).then(e=>e.datastore)}(i);new nv(i.asyncQueue,d,u,s,l).run()})),l.promise}(rt(n),i=>e(new u_(n,i)),r)}(this._delegate,t=>e(new Xg(this,t)))}batch(){return rt(this._delegate),new Jg(new Wg(this._delegate,e=>va(this._delegate,e)))}loadBundle(e){return function Ev(n,e){const t=rt(n=he(n,qe)),r=new pv;return function cv(n,e,t,r){const i=function(s,u){let l;return l="string"==typeof s?Ff().encode(s):s,d=function(d,p){if(d instanceof Uint8Array)return cg(d,p);if(d instanceof ArrayBuffer)return cg(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),new ev(d,u);var d}(t,Cu(e));n.asyncQueue.enqueueAndForget((0,N.Z)(function*(){!function Xy(n,e,t){var r;const i=z(n);(function(s,u,l){return(r=r||(0,N.Z)(function*(d,p,m){try{const v=yield p.getMetadata();if(yield function(U,q){const te=z(U),ie=nt(q.createTime);return te.persistence.runTransaction("hasNewerBundle","readonly",Q=>te.qs.getBundleMetadata(Q,q.id)).then(Q=>!!Q&&Q.createTime.compareTo(ie)>=0)}(d.localStore,v))return yield p.close(),m._completeWith({taskState:"Success",documentsLoaded:(U=v).totalDocuments,bytesLoaded:U.totalBytes,totalDocuments:U.totalDocuments,totalBytes:U.totalBytes}),Promise.resolve(new Set);m._updateProgress(Jp(v));const E=new Ry(v,d.localStore,p.serializer);let S=yield p.bc();for(;S;){const U=yield E.zu(S);U&&m._updateProgress(U),S=yield p.bc()}const D=yield E.complete();return yield ai(d,D.Ju,void 0),yield function(U,q){const te=z(U);return te.persistence.runTransaction("Save bundle","readwrite",ie=>te.qs.saveBundleMetadata(ie,q))}(d.localStore,v),m._completeWith(D.progress),Promise.resolve(D.Hu)}catch(v){return nn("SyncEngine",`Loading bundle failed with ${v}`),m._failWith(v),Promise.resolve(new Set)}var U})).apply(this,arguments)})(i,e,t).then(s=>{i.sharedClientState.notifyBundleLoaded(s)})}(yield hf(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Tv(n,e){return function lv(n,e){return n.asyncQueue.enqueue((0,N.Z)(function*(){return function(t,r){const i=z(t);return i.persistence.runTransaction("Get named query","readonly",s=>i.qs.getNamedQuery(s,r))}(yield Kl(n),e)}))}(rt(n=he(n,qe)),e).then(t=>t?new Dt(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Xt(this,t):null)}}class sh extends wf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vu(new br(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Dn.forKey(t,this.firestore,null)}}class Xg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new sh(e)}get(e){const t=so(e);return this._delegate.get(t).then(r=>new Bu(this._firestore,new ci(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=so(e);return r?(Tf("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=so(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=so(e);return this._delegate.delete(t),this}}class Jg{constructor(e){this._delegate=e}set(e,t,r){const i=so(e);return r?(Tf("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=so(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=so(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class io{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Uu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new qu(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=io.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new io(e,new sh(e),t),i.set(t,s)),s}}io.INSTANCES=new WeakMap;class Dn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new sh(e)}static forPath(e,t,r){if(e.length%2!=0)throw new P("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Dn(t,new Be(t._delegate,r,new V(e)))}static forKey(e,t,r){return new Dn(t,new Be(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new _a(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new _a(this.firestore,Sg(this._delegate,e))}catch(t){throw Yt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,fe.m9)(e))instanceof Be&&Ag(this._delegate,e)}set(e,t){t=Tf("DocumentReference.set",t);try{return t?$g(this._delegate,e,t):$g(this._delegate,e)}catch(r){throw Yt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?jg(this._delegate,e):jg(this._delegate,e,t,...r)}catch(i){throw Yt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function Qv(n){return va(he(n.firestore,qe),[new ta(n._key,Ke.none())])}(this._delegate)}onSnapshot(...e){const t=em(e),r=tm(e,i=>new Bu(this.firestore,new ci(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Kg(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function jv(n){n=he(n,Be);const e=he(n.firestore,qe),t=rt(e),r=new os(e);return function ov(n,e){const t=new je;return n.asyncQueue.enqueueAndForget((0,N.Z)(function*(){var r;return function(i,s,u){return(r=r||(0,N.Z)(function*(l,d,p){try{const m=yield function(v,E){const S=z(v);return S.persistence.runTransaction("read document","readonly",D=>S.localDocuments.getDocument(D,E))}(l,d);m.isFoundDocument()?p.resolve(m):m.isNoDocument()?p.resolve(null):p.reject(new P(k.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(m){const v=ha(m,`Failed to get document '${d} from cache`);p.reject(v)}})).apply(this,arguments)}(yield Kl(n),e,t)})),t.promise}(t,n._key).then(i=>new ci(e,r,n._key,i,new ro(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function Kv(n){n=he(n,Be);const e=he(n.firestore,qe);return pg(rt(e),n._key,{source:"server"}).then(t=>Ef(e,n,t))}(this._delegate):function $v(n){n=he(n,Be);const e=he(n.firestore,qe);return pg(rt(e),n._key).then(t=>Ef(e,n,t))}(this._delegate),t.then(r=>new Bu(this.firestore,new ci(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Dn(this.firestore,this._delegate.withConverter(e?io.getInstance(this.firestore,e):null))}}function Yt(n,e,t){return n.message=n.message.replace(e,t),n}function em(n){for(const e of n)if("object"==typeof e&&!Sf(e))return e;return{}}function tm(n,e){var t,r;let i;return i=Sf(n[0])?n[0]:Sf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Bu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Dn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return zg(this._delegate,e._delegate)}}class qu extends Bu{data(e){const t=this._delegate.data(e);return function Dh(n,e){n||j()}(void 0!==t),t}}class Xt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new sh(e)}where(e,t,r){try{return new Xt(this.firestore,is(this._delegate,function Pv(n,e,t){const r=e,i=eh("where",n);return Fu._create(i,r,t)}(e,t,r)))}catch(i){throw Yt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Xt(this.firestore,is(this._delegate,function Ov(n,e="asc"){const t=e,r=eh("orderBy",n);return If._create(r,t)}(e,t)))}catch(r){throw Yt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Xt(this.firestore,is(this._delegate,function Lv(n){return wg("limit",n),th._create("limit",n,"F")}(e)))}catch(t){throw Yt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Xt(this.firestore,is(this._delegate,function Mv(n){return wg("limitToLast",n),th._create("limitToLast",n,"L")}(e)))}catch(t){throw Yt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Xt(this.firestore,is(this._delegate,function Fv(...n){return nh._create("startAt",n,!0)}(...e)))}catch(t){throw Yt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Xt(this.firestore,is(this._delegate,function Uv(...n){return nh._create("startAfter",n,!1)}(...e)))}catch(t){throw Yt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Xt(this.firestore,is(this._delegate,function Vv(...n){return rh._create("endBefore",n,!1)}(...e)))}catch(t){throw Yt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Xt(this.firestore,is(this._delegate,function Bv(...n){return rh._create("endAt",n,!0)}(...e)))}catch(t){throw Yt(t,"endAt()","Query.endAt()")}}isEqual(e){return ff(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function Zv(n){n=he(n,Dt);const e=he(n.firestore,qe),t=rt(e),r=new os(e);return function av(n,e){const t=new je;return n.asyncQueue.enqueueAndForget((0,N.Z)(function*(){var r;return function(i,s,u){return(r=r||(0,N.Z)(function*(l,d,p){try{const m=yield Ml(l,d,!0),v=new ng(d,m.ir),E=v.sc(m.documents),S=v.applyChanges(E,!1);p.resolve(S.snapshot)}catch(m){const v=ha(m,`Failed to execute query '${d} against cache`);p.reject(v)}})).apply(this,arguments)}(yield Kl(n),e,t)})),t.promise}(t,n._query).then(i=>new ss(e,r,n,i))}(this._delegate):"server"===e?.source?function Hv(n){n=he(n,Dt);const e=he(n.firestore,qe),t=rt(e),r=new os(e);return gg(t,n._query,{source:"server"}).then(i=>new ss(e,r,n,i))}(this._delegate):function Wv(n){n=he(n,Dt);const e=he(n.firestore,qe),t=rt(e),r=new os(e);return Mg(n._query),gg(t,n._query).then(i=>new ss(e,r,n,i))}(this._delegate),t.then(r=>new Af(this.firestore,new ss(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=em(e),r=tm(e,i=>new Af(this.firestore,new ss(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Kg(this._delegate,t,r)}withConverter(e){return new Xt(this.firestore,this._delegate.withConverter(e?io.getInstance(this.firestore,e):null))}}class I_{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new qu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Af{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Xt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new qu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new I_(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new qu(this._firestore,r))})}isEqual(e){return zg(this._delegate,e._delegate)}}class _a extends Xt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Dn(this.firestore,e):null}doc(e){try{return new Dn(this.firestore,void 0===e?Zl(this._delegate):Zl(this._delegate,e))}catch(t){throw Yt(t,"doc()","CollectionReference.doc()")}}add(e){return function Yv(n,e){const t=he(n.firestore,qe),r=Zl(n),i=ih(n.converter,e);return va(t,[Yl(to(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Ke.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Dn(this.firestore,t))}isEqual(e){return Ag(this._delegate,e._delegate)}withConverter(e){return new _a(this.firestore,this._delegate.withConverter(e?io.getInstance(this.firestore,e):null))}}function so(n){return he(n,Be)}class xf{constructor(...e){this._delegate=new ui(...e)}static documentId(){return new xf(Ae.keyField().canonicalString())}isEqual(e){return(e=(0,fe.m9)(e))instanceof ui&&this._delegate._internalPath.isEqual(e._internalPath)}}class oo{constructor(e){this._delegate=e}static serverTimestamp(){const e=function h_(){return new gf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new oo(e)}static delete(){const e=function l_(){return new Pu("deleteField")}();return e._methodName="FieldValue.delete",new oo(e)}static arrayUnion(...e){const t=function d_(...n){return new kv("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new oo(t)}static arrayRemove(...e){const t=function f_(...n){return new bv("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new oo(t)}static increment(e){const t=function p_(n){return new Nv("increment",n)}(e);return t._methodName="FieldValue.increment",new oo(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const w_={Firestore:Yg,GeoPoint:Hl,Timestamp:Oe,Blob:Vu,Transaction:Xg,WriteBatch:Jg,DocumentReference:Dn,DocumentSnapshot:Bu,Query:Xt,QueryDocumentSnapshot:qu,QuerySnapshot:Af,CollectionReference:_a,FieldPath:xf,FieldValue:oo,setLogLevel:function __(n){!function Rh(n){Nn.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function T_(n){(function E_(n,e){n.INTERNAL.registerComponent(new jt.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},w_)))})(n,(e,t)=>new Yg(e,t,new v_)),n.registerVersion("@firebase/firestore-compat","0.3.12")}(cs.Z);var us=$(6796),S_=$(14);function nm(n,e){return function A_(n,e=_t.z){return new O.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function Cf(n,e){return nm(n,e).pipe((0,We.U)(t=>({payload:t,type:"query"})))}function oh(n,e){return Cf(n,e).pipe((0,et.O)(void 0),st(),(0,We.U)(([t,r])=>{const i=r.payload.docChanges(),s=i.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((u,l)=>{const d=i.find(m=>m.doc.ref.isEqual(u.ref)),p=t?.payload.docs.find(m=>m.ref.isEqual(u.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(u.metadata)||!d&&p&&JSON.stringify(p.metadata)===JSON.stringify(u.metadata)||s.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:u}})}),s}))}function rm(n,e,t){return oh(n,t).pipe((0,Gt.R)((r,i)=>function C_(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function k_(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return kf(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return kf(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return kf(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,zt.x)(),(0,We.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function kf(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function im(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}$(120);class sm{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=oh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,We.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,et.O)(void 0),st(),(0,On.h)(([r,i])=>i.length>0||!r),(0,We.U)(([r,i])=>i),Je.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Gt.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=im(e);return rm(this.query,t,this.afs.schedulers.outsideAngular).pipe(Je.iC)}valueChanges(e={}){return Cf(this.query,this.afs.schedulers.outsideAngular).pipe((0,We.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Je.iC)}get(e){return(0,Ge.D)(this.query.get(e)).pipe(Je.iC)}add(e){return this.ref.add(e)}doc(e){return new om(this.ref.doc(e),this.afs)}}class om{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=am(r,t);return new sm(i,s,this.afs)}snapshotChanges(){return function x_(n,e){return nm(n,e).pipe((0,et.O)(void 0),st(),(0,We.U)(([t,r])=>r.exists?t?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Je.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,We.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Ge.D)(this.ref.get(e)).pipe(Je.iC)}}class b_{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?oh(this.query,this.afs.schedulers.outsideAngular).pipe((0,We.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,On.h)(t=>t.length>0),Je.iC):oh(this.query,this.afs.schedulers.outsideAngular).pipe(Je.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Gt.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=im(e);return rm(this.query,t,this.afs.schedulers.outsideAngular).pipe(Je.iC)}valueChanges(e={}){return Cf(this.query,this.afs.schedulers.outsideAngular).pipe((0,We.U)(r=>r.payload.docs.map(i=>e.idField?Object.assign({[e.idField]:i.id},i.data()):i.data())),Je.iC)}get(e){return(0,Ge.D)(this.query.get(e)).pipe(Je.iC)}}const N_=new I.OlP("angularfire2.enableFirestorePersistence"),R_=new I.OlP("angularfire2.firestore.persistenceSettings"),D_=new I.OlP("angularfire2.firestore.settings"),P_=new I.OlP("angularfire2.firestore.use-emulator");function am(n,e=(t=>t)){return{query:e(n),ref:n}}let O_=(()=>{class n{constructor(t,r,i,s,u,l,d,p,m,v,E,S,D,U,q,te,ie){this.schedulers=d;const Q=(0,gn.on)(t,l,r),se=m;v&&(0,us.nw)(Q,l,E,D,U,q,S,te),[this.firestore,this.persistenceEnabled$]=(0,gn.cc)(`${Q.name}.firestore`,"AngularFirestore",Q.name,()=>{const de=l.runOutsideAngular(()=>Q.firestore());if(s&&de.settings(s),se&&de.useEmulator(...se),i&&!(0,hi.PM)(u)){const Le=()=>{try{return(0,Ge.D)(de.enablePersistence(p||void 0).then(()=>!0,()=>!1))}catch(Pt){return typeof console<"u"&&console.warn(Pt),(0,sn.of)(!1)}};return[de,l.runOutsideAngular(Le)]}return[de,(0,sn.of)(!1)]},[s,se,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:u}=am(i,r),l=this.schedulers.ngZone.run(()=>s);return new sm(l,u,this)}collectionGroup(t,r){const i=r||(u=>u),s=this.firestore.collectionGroup(t);return new b_(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new om(i,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(I.LFG(gn.Dh),I.LFG(gn.xv,8),I.LFG(N_,8),I.LFG(D_,8),I.LFG(I.Lbi),I.LFG(I.R0b),I.LFG(Je.HU),I.LFG(R_,8),I.LFG(P_,8),I.LFG(us.zQ,8),I.LFG(us.Qv,8),I.LFG(us.L6,8),I.LFG(us._Q,8),I.LFG(us.rT,8),I.LFG(us.lh,8),I.LFG(us.f7,8),I.LFG(S_.nm,8))},n.\u0275prov=I.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})()},2333:(Gu,Nr,$)=>{$.d(Nr,{e:()=>Je});var I=$(5861),_t=$(7398),O=$(5879),Ge=$(6796),sn=$(8022);let Je=(()=>{var et;class it{constructor(st,We){this.afauth=st,this.firestore=We}register(st,We){var Gt=this;return(0,I.Z)(function*(){try{return yield Gt.afauth.createUserWithEmailAndPassword(st,We)}catch(zt){return console.log("error en login: ",zt),null}})()}login(st,We){var Gt=this;return(0,I.Z)(function*(){try{const zt=yield Gt.afauth.signInWithEmailAndPassword(st,We);if(!zt.user)return null;const On=zt.user,gn=new Date;return yield Gt.firestore.collection("users").doc(On.uid).set({fechaIngreso:gn},{merge:!0}),On}catch(zt){return console.log("error en login: ",zt),null}})()}getUserLogged(){return this.afauth.authState}logout(){this.afauth.signOut()}getUserEmail(){return this.getUserLogged().pipe((0,_t.U)(st=>st?st.email:null))}}return(et=it).\u0275fac=function(st){return new(st||et)(O.LFG(Ge.zQ),O.LFG(sn.ST))},et.\u0275prov=O.Yz7({token:et,factory:et.\u0275fac,providedIn:"root"}),it})()},8977:(Gu,Nr,$)=>{$.r(Nr);var it,Pn,st,We,Gt,zt,On,gn,hi,di,cs,N,$t,jt,Ot,fe,mn,ht,B,yn,X,on,Jt,tr,vn,fi,Ie,me,ne,pe,ue,J,Re,ot,Me,Ln,Fe,pi,an,nr,It,en,_n,be,wt,un,we,at,kt,ls,gi,Rr,mi,yi,In,vi,Dr,ao,rr,uo,co,ir,Pr,hs,Fn,ds,Or,Lr,sr,or,_i,Ii,fs,ar,ps,Mr,Fr,Ur,gs,ms,cn,I=$(5861),_t=$(3399),O=$(9058),Ge=$(7592),sn=$(7582),Je=$(7879),et=$(4537);const Un={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const Ia=function vs(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},wa=function lo(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},_s=new O.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Vr=new Je.Yd("@firebase/auth");function wn(h,...o){Vr.logLevel<=Je.in.ERROR&&Vr.error(`Auth (${Ge.SDK_VERSION}): ${h}`,...o)}function De(h,...o){throw Bn(h,...o)}function Ze(h,...o){return Bn(h,...o)}function wi(h,o,a){const c=Object.assign(Object.assign({},wa()),{[o]:a});return new O.LL("auth","Firebase",c).create(o,{appName:h.name})}function Vn(h,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&De(h,"argument-error"),wi(h,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Bn(h,...o){if("string"!=typeof h){const a=o[0],c=[...o.slice(1)];return c[0]&&(c[0].appName=h.name),h._errorFactory.create(a,...c)}return _s.create(h,...o)}function F(h,o,...a){if(!h)throw Bn(o,...a)}function bt(h){const o="INTERNAL ASSERTION FAILED: "+h;throw wn(o),new Error(o)}function Kt(h,o){h||bt(o)}function Br(){var h;return typeof self<"u"&&(null===(h=self.location)||void 0===h?void 0:h.href)||""}function ur(){return"http:"===fo()||"https:"===fo()}function fo(){var h;return typeof self<"u"&&(null===(h=self.location)||void 0===h?void 0:h.protocol)||null}class En{constructor(o,a){this.shortDelay=o,this.longDelay=a,Kt(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,O.uI)()||(0,O.b$)()}get(){return function Ea(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ur()||(0,O.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ei(h,o){Kt(h.emulator,"Emulator should always be set here");const{url:a}=h.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class po{static initialize(o,a,c){this.fetchImpl=o,a&&(this.headersImpl=a),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void bt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void bt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void bt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const qn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ws=new En(3e4,6e4);function Te(h,o){return h.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:h.tenantId}):o}function ve(h,o,a,c){return(it=it||(0,I.Z)(function*(f,g,y,_,A={}){return qr(f,A,(0,I.Z)(function*(){let b={},K={};_&&("GET"===g?K=_:b={body:JSON.stringify(_)});const G=(0,O.xO)(Object.assign({key:f.config.apiKey},K)).slice(1),Z=yield f._getAdditionalHeaders();return Z["Content-Type"]="application/json",f.languageCode&&(Z["X-Firebase-Locale"]=f.languageCode),po.fetch()(Es(f,f.config.apiHost,y,G),Object.assign({method:g,headers:Z,referrerPolicy:"no-referrer"},b))}))})).apply(this,arguments)}function qr(h,o,a){return(Pn=Pn||(0,I.Z)(function*(c,f,g){c._canInitEmulator=!1;const y=Object.assign(Object.assign({},qn),f);try{const _=new Ti(c),A=yield Promise.race([g(),_.promise]);_.clearNetworkTimeout();const b=yield A.json();if("needConfirmation"in b)throw cr(c,"account-exists-with-different-credential",b);if(A.ok&&!("errorMessage"in b))return b;{const K=A.ok?b.errorMessage:b.error.message,[G,Z]=K.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===G)throw cr(c,"credential-already-in-use",b);if("EMAIL_EXISTS"===G)throw cr(c,"email-already-in-use",b);if("USER_DISABLED"===G)throw cr(c,"user-disabled",b);const re=y[G]||G.toLowerCase().replace(/[_\s]+/g,"-");if(Z)throw wi(c,re,Z);De(c,re)}}catch(_){if(_ instanceof O.ZR)throw _;De(c,"network-request-failed",{message:String(_)})}})).apply(this,arguments)}function Wt(h,o,a,c){return(st=st||(0,I.Z)(function*(f,g,y,_,A={}){const b=yield ve(f,g,y,_,A);return"mfaPendingCredential"in b&&De(f,"multi-factor-auth-required",{_serverResponse:b}),b})).apply(this,arguments)}function Es(h,o,a,c){const f=`${o}${a}?${c}`;return h.config.emulator?Ei(h.config,f):`${h.config.apiScheme}://${f}`}class Ti{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,c)=>{this.timer=setTimeout(()=>c(Ze(this.auth,"network-request-failed")),ws.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function cr(h,o,a){const c={appName:h.name};a.email&&(c.email=a.email),a.phoneNumber&&(c.phoneNumber=a.phoneNumber);const f=Ze(h,o,c);return f.customData._tokenResponse=a,f}function Tn(h){if(h)try{const o=new Date(Number(h));if(!isNaN(o.getTime()))return o.toUTCString()}catch{}}function Ts(h){return 1e3*Number(h)}function Ai(h){const[o,a,c]=h.split(".");if(void 0===o||void 0===a||void 0===c)return wn("JWT malformed, contained fewer than 3 sections"),null;try{const f=(0,O.tV)(a);return f?JSON.parse(f):(wn("Failed to decode base64 JWT payload"),null)}catch(f){return wn("Caught error parsing JWT payload as JSON",f?.toString()),null}}function T(h,o){return(gn=gn||(0,I.Z)(function*(a,c,f=!1){if(f)return c;try{return yield c}catch(g){throw g instanceof O.ZR&&function w({code:h}){return"auth/user-disabled"===h||"auth/user-token-expired"===h}(g)&&a.auth.currentUser===a&&(yield a.auth.signOut()),g}})).apply(this,arguments)}class C{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const c=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),c}{this.errorBackoff=3e4;const f=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,f)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const c=this.getInterval(o);this.timerId=setTimeout((0,I.Z)(function*(){yield a.iteration()}),c)}iteration(){var o=this;return(0,I.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===a?.code&&o.schedule(!0))}o.schedule()})()}}class R{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tn(this.lastLoginAt),this.creationTime=Tn(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function L(h){return(hi=hi||(0,I.Z)(function*(o){var a;const c=o.auth,f=yield o.getIdToken(),g=yield T(o,function Si(h,o){return(zt=zt||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:lookup",c)})).apply(this,arguments)}(c,{idToken:f}));F(g?.users.length,c,"internal-error");const y=g.users[0];o._notifyReloadListener(y);const _=null!==(a=y.providerUserInfo)&&void 0!==a&&a.length?function Ne(h){return h.map(o=>{var{providerId:a}=o,c=(0,sn._T)(o,["providerId"]);return{providerId:a,uid:c.rawId||"",displayName:c.displayName||null,email:c.email||null,phoneNumber:c.phoneNumber||null,photoURL:c.photoUrl||null}})}(y.providerUserInfo):[],A=function ce(h,o){return[...h.filter(c=>!o.some(f=>f.providerId===c.providerId)),...o]}(o.providerData,_),G=!!o.isAnonymous&&!(o.email&&y.passwordHash||A?.length),Z={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:A,metadata:new R(y.createdAt,y.lastLoginAt),isAnonymous:G};Object.assign(o,Z)})).apply(this,arguments)}class le{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){F(o.idToken,"internal-error"),F(typeof o.idToken<"u","internal-error"),F(typeof o.refreshToken<"u","internal-error");const a="expiresIn"in o&&typeof o.expiresIn<"u"?Number(o.expiresIn):function xi(h){const o=Ai(h);return F(o,"internal-error"),F(typeof o.exp<"u","internal-error"),F(typeof o.iat<"u","internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var c=this;return(0,I.Z)(function*(){return F(!c.accessToken||c.refreshToken,o,"user-token-expired"),a||!c.accessToken||c.isExpired?c.refreshToken?(yield c.refresh(o,c.refreshToken),c.accessToken):null:c.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var c=this;return(0,I.Z)(function*(){const{accessToken:f,refreshToken:g,expiresIn:y}=yield function ze(h,o){return(cs=cs||(0,I.Z)(function*(a,c){const f=yield qr(a,{},(0,I.Z)(function*(){const g=(0,O.xO)({grant_type:"refresh_token",refresh_token:c}).slice(1),{tokenApiHost:y,apiKey:_}=a.config,A=Es(a,y,"/v1/token",`key=${_}`),b=yield a._getAdditionalHeaders();return b["Content-Type"]="application/x-www-form-urlencoded",po.fetch()(A,{method:"POST",headers:b,body:g})}));return{accessToken:f.access_token,expiresIn:f.expires_in,refreshToken:f.refresh_token}})).apply(this,arguments)}(o,a);c.updateTokensAndExpiration(f,g,Number(y))})()}updateTokensAndExpiration(o,a,c){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(o,a){const{refreshToken:c,accessToken:f,expirationTime:g}=a,y=new le;return c&&(F("string"==typeof c,"internal-error",{appName:o}),y.refreshToken=c),f&&(F("string"==typeof f,"internal-error",{appName:o}),y.accessToken=f),g&&(F("number"==typeof g,"internal-error",{appName:o}),y.expirationTime=g),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new le,this.toJSON())}_performRefresh(){return bt("not implemented")}}function ft(h,o){F("string"==typeof h||typeof h>"u","internal-error",{appName:o})}class Lt{constructor(o){var{uid:a,auth:c,stsTokenManager:f}=o,g=(0,sn._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new C(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=c,this.stsTokenManager=f,this.accessToken=f.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new R(g.createdAt||void 0,g.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,I.Z)(function*(){const c=yield T(a,a.stsTokenManager.getToken(a.auth,o));return F(c,a.auth,"internal-error"),a.accessToken!==c&&(a.accessToken=c,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),c})()}getIdTokenResult(o){return function go(h){return(On=On||(0,I.Z)(function*(o,a=!1){const c=(0,O.m9)(o),f=yield c.getIdToken(a),g=Ai(f);F(g&&g.exp&&g.auth_time&&g.iat,c.auth,"internal-error");const y="object"==typeof g.firebase?g.firebase:void 0,_=y?.sign_in_provider;return{claims:g,token:f,authTime:Tn(Ts(g.auth_time)),issuedAtTime:Tn(Ts(g.iat)),expirationTime:Tn(Ts(g.exp)),signInProvider:_||null,signInSecondFactor:y?.sign_in_second_factor||null}})).apply(this,arguments)}(this,o)}reload(){return function W(h){return(di=di||(0,I.Z)(function*(o){const a=(0,O.m9)(o);yield L(a),yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)})).apply(this,arguments)}(this)}_assign(o){this!==o&&(F(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){const a=new Lt(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}));return a.metadata._copy(this.metadata),a}_onReload(o){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var c=this;return(0,I.Z)(function*(){let f=!1;o.idToken&&o.idToken!==c.stsTokenManager.accessToken&&(c.stsTokenManager.updateFromServerResponse(o),f=!0),a&&(yield L(c)),yield c.auth._persistUserIfCurrent(c),f&&c.auth._notifyListenersIfCurrent(c)})()}delete(){var o=this;return(0,I.Z)(function*(){const a=yield o.getIdToken();return yield T(o,function dt(h,o){return(We=We||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:delete",c)})).apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var c,f,g,y,_,A,b,K;const G=null!==(c=a.displayName)&&void 0!==c?c:void 0,Z=null!==(f=a.email)&&void 0!==f?f:void 0,re=null!==(g=a.phoneNumber)&&void 0!==g?g:void 0,ke=null!==(y=a.photoURL)&&void 0!==y?y:void 0,xt=null!==(_=a.tenantId)&&void 0!==_?_:void 0,Rt=null!==(A=a._redirectEventId)&&void 0!==A?A:void 0,pn=null!==(b=a.createdAt)&&void 0!==b?b:void 0,Sr=null!==(K=a.lastLoginAt)&&void 0!==K?K:void 0,{uid:Jo,emailVerified:Ar,isAnonymous:lu,providerData:xr,stsTokenManager:hu}=a;F(Jo&&hu,o,"internal-error");const Il=le.fromJSON(this.name,hu);F("string"==typeof Jo,o,"internal-error"),ft(G,o.name),ft(Z,o.name),F("boolean"==typeof Ar,o,"internal-error"),F("boolean"==typeof lu,o,"internal-error"),ft(re,o.name),ft(ke,o.name),ft(xt,o.name),ft(Rt,o.name),ft(pn,o.name),ft(Sr,o.name);const ii=new Lt({uid:Jo,auth:o,email:Z,emailVerified:Ar,displayName:G,isAnonymous:lu,photoURL:ke,phoneNumber:re,tenantId:xt,stsTokenManager:Il,createdAt:pn,lastLoginAt:Sr});return xr&&Array.isArray(xr)&&(ii.providerData=xr.map(pd=>Object.assign({},pd))),Rt&&(ii._redirectEventId=Rt),ii}static _fromIdTokenResponse(o,a,c=!1){return(0,I.Z)(function*(){const f=new le;f.updateFromServerResponse(a);const g=new Lt({uid:a.localId,auth:o,stsTokenManager:f,isAnonymous:c});return yield L(g),g})()}}const Ci=new Map;function Pe(h){Kt(h instanceof Function,"Expected a class definition");let o=Ci.get(h);return o?(Kt(o instanceof h,"Instance stored in cache mismatched with class"),o):(o=new h,Ci.set(h,o),o)}const Gr=(()=>{class h{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.Z)(function*(){return!0})()}_set(a,c){var f=this;return(0,I.Z)(function*(){f.storage[a]=c})()}_get(a){var c=this;return(0,I.Z)(function*(){const f=c.storage[a];return void 0===f?null:f})()}_remove(a){var c=this;return(0,I.Z)(function*(){delete c.storage[a]})()}_addListener(a,c){}_removeListener(a,c){}}return h.type="NONE",h})();function Sn(h,o,a){return`firebase:${h}:${o}:${a}`}class An{constructor(o,a,c){this.persistence=o,this.auth=a,this.userKey=c;const{config:f,name:g}=this.auth;this.fullUserKey=Sn(this.userKey,f.apiKey,g),this.fullPersistenceKey=Sn("persistence",f.apiKey,g),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?Lt._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,I.Z)(function*(){if(a.persistence===o)return;const c=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,c?a.setCurrentUser(c):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,c="authUser"){return(0,I.Z)(function*(){var f,g;if(!a.length)return new An(Pe(Gr),o,c);const y=(yield Promise.all(a.map(function(G){return(f=f||(0,I.Z)(function*(Z){if(yield Z._isAvailable())return Z})).apply(this,arguments)}))).filter(G=>G);let _=y[0]||Pe(Gr);const A=Sn(c,o.config.apiKey,o.name);let b=null;for(const G of a)try{const Z=yield G._get(A);if(Z){const re=Lt._fromJSON(o,Z);G!==_&&(b=re),_=G;break}}catch{}const K=y.filter(G=>G._shouldAllowMigration);return _._shouldAllowMigration&&K.length?(_=K[0],b&&(yield _._set(A,b.toJSON())),yield Promise.all(a.map(function(G){return(g=g||(0,I.Z)(function*(Z){if(Z!==_)try{yield Z._remove(A)}catch{}})).apply(this,arguments)})),new An(_,o,c)):new An(_,o,c)})()}}function lr(h){const o=h.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(xa(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(yo(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(ju(o))return"Blackberry";if(hr(o))return"Webos";if(Aa(o))return"Safari";if((o.includes("chrome/")||$u(o))&&!o.includes("edge/"))return"Chrome";if(ki(o))return"Android";{const c=h.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===c?.length)return c[1]}return"Other"}function yo(h=(0,O.z$)()){return/firefox\//i.test(h)}function Aa(h=(0,O.z$)()){const o=h.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function $u(h=(0,O.z$)()){return/crios\//i.test(h)}function xa(h=(0,O.z$)()){return/iemobile/i.test(h)}function ki(h=(0,O.z$)()){return/android/i.test(h)}function ju(h=(0,O.z$)()){return/blackberry/i.test(h)}function hr(h=(0,O.z$)()){return/webos/i.test(h)}function Mt(h=(0,O.z$)()){return/iphone|ipad|ipod/i.test(h)||/macintosh/i.test(h)&&/mobile/i.test(h)}function Se(h=(0,O.z$)()){return Mt(h)||ki(h)||hr(h)||ju(h)||/windows phone/i.test(h)||xa(h)}function bi(h,o=[]){let a;switch(h){case"Browser":a=lr((0,O.z$)());break;case"Worker":a=`${lr((0,O.z$)())}-${h}`;break;default:a=h}const c=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${Ge.SDK_VERSION}/${c}`}function Wu(h,o){return($t=$t||(0,I.Z)(function*(a,c){return ve(a,"GET","/v2/recaptchaConfig",Te(a,c))})).apply(this,arguments)}function Ca(h){return void 0!==h&&void 0!==h.getResponse}function Zu(h){return void 0!==h&&void 0!==h.enterprise}class Hu{constructor(o){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===o.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=o.recaptchaKey.split("/")[3],this.emailPasswordEnabled=o.recaptchaEnforcementState.some(a=>"EMAIL_PASSWORD_PROVIDER"===a.provider&&"OFF"!==a.enforcementState)}}function ka(h){return new Promise((o,a)=>{const c=document.createElement("script");c.setAttribute("src",h),c.onload=o,c.onerror=f=>{const g=Ze("internal-error");g.customData=f,a(g)},c.type="text/javascript",c.charset="UTF-8",function uh(){var h,o;return null!==(o=null===(h=document.getElementsByTagName("head"))||void 0===h?void 0:h[0])&&void 0!==o?o:document}().appendChild(c)})}function Ni(h){return`__${h}${Math.floor(1e6*Math.random())}`}class ba{constructor(o){this.type="recaptcha-enterprise",this.auth=Ue(o)}verify(o="verify",a=!1){var c=this;return(0,I.Z)(function*(){var f;function y(_,A,b){const K=window.grecaptcha;Zu(K)?K.enterprise.ready(()=>{K.enterprise.execute(_,{action:o}).then(G=>{A(G)}).catch(()=>{A("NO_RECAPTCHA")})}):b(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((_,A)=>{(function g(_){return(f=f||(0,I.Z)(function*(A){var b;if(!a){if(null==A.tenantId&&null!=A._agentRecaptchaConfig)return A._agentRecaptchaConfig.siteKey;if(null!=A.tenantId&&void 0!==A._tenantRecaptchaConfigs[A.tenantId])return A._tenantRecaptchaConfigs[A.tenantId].siteKey}return new Promise(function(K,G){return(b=b||(0,I.Z)(function*(Z,re){Wu(A,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ke=>{if(void 0!==ke.recaptchaKey){const xt=new Hu(ke);return null==A.tenantId?A._agentRecaptchaConfig=xt:A._tenantRecaptchaConfigs[A.tenantId]=xt,Z(xt.siteKey)}re(new Error("recaptcha Enterprise site key undefined"))}).catch(ke=>{re(ke)})})).apply(this,arguments)})})).apply(this,arguments)})(c.auth).then(b=>{if(!a&&Zu(window.grecaptcha))y(b,_,A);else{if(typeof window>"u")return void A(new Error("RecaptchaVerifier is only supported in browser"));ka("https://www.google.com/recaptcha/enterprise.js?render="+b).then(()=>{y(b,_,A)}).catch(K=>{A(K)})}}).catch(b=>{A(b)})})})()}}function Zt(h,o,a){return(jt=jt||(0,I.Z)(function*(c,f,g,y=!1){const _=new ba(c);let A;try{A=yield _.verify(g)}catch{A=yield _.verify(g,!0)}const b=Object.assign({},f);return Object.assign(b,y?{captchaResp:A}:{captchaResponse:A}),Object.assign(b,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(b,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),b})).apply(this,arguments)}class ch{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const c=g=>new Promise((y,_)=>{try{y(o(g))}catch(A){_(A)}});c.onAbort=a,this.queue.push(c);const f=this.queue.length-1;return()=>{this.queue[f]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,I.Z)(function*(){if(a.auth.currentUser===o)return;const c=[];try{for(const f of a.queue)yield f(o),f.onAbort&&c.push(f.onAbort)}catch(f){c.reverse();for(const g of c)try{g()}catch{}throw a.auth._errorFactory.create("login-blocked",{originalMessage:f?.message})}})()}}class lh{constructor(o,a,c,f){this.app=o,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=c,this.config=f,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xu(this),this.idTokenSubscription=new Xu(this),this.beforeStateQueue=new ch(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_s,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=f.sdkClientVersion}_initializeWithPersistence(o,a){var c=this;return a&&(this._popupRedirectResolver=Pe(a)),this._initializationPromise=this.queue((0,I.Z)(function*(){var f,g;if(!c._deleted&&(c.persistenceManager=yield An.create(c,o),!c._deleted)){if(null!==(f=c._popupRedirectResolver)&&void 0!==f&&f._shouldInitProactively)try{yield c._popupRedirectResolver._initialize(c)}catch{}yield c.initializeCurrentUser(a),c.lastNotifiedUid=(null===(g=c.currentUser)||void 0===g?void 0:g.uid)||null,!c._deleted&&(c._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,I.Z)(function*(){var c;const f=yield a.assertedPersistence.getCurrentUser();let g=f,y=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const _=null===(c=a.redirectUser)||void 0===c?void 0:c._redirectEventId,A=g?._redirectEventId,b=yield a.tryRedirectSignIn(o);(!_||_===A)&&b?.user&&(g=b.user,y=!0)}if(!g)return a.directlySetCurrentUser(null);if(!g._redirectEventId){if(y)try{yield a.beforeStateQueue.runMiddleware(g)}catch(_){g=f,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(_))}return g?a.reloadAndSetCurrentUserOrClear(g):a.directlySetCurrentUser(null)}return F(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===g._redirectEventId?a.directlySetCurrentUser(g):a.reloadAndSetCurrentUserOrClear(g)})()}tryRedirectSignIn(o){var a=this;return(0,I.Z)(function*(){let c=null;try{c=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch{yield a._setRedirectUser(null)}return c})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,I.Z)(function*(){try{yield L(o)}catch(c){if("auth/network-request-failed"!==c?.code)return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function Ta(){if(typeof navigator>"u")return null;const h=navigator;return h.languages&&h.languages[0]||h.language||null}()}_delete(){var o=this;return(0,I.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,I.Z)(function*(){const c=o?(0,O.m9)(o):null;return c&&F(c.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(c&&c._clone(a))})()}_updateCurrentUser(o,a=!1){var c=this;return(0,I.Z)(function*(){if(!c._deleted)return o&&F(c.tenantId===o.tenantId,c,"tenant-id-mismatch"),a||(yield c.beforeStateQueue.runMiddleware(o)),c.queue((0,I.Z)(function*(){yield c.directlySetCurrentUser(o),c.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,I.Z)(function*(){yield a.assertedPersistence.setPersistence(Pe(o))}))}initializeRecaptchaConfig(){var o=this;return(0,I.Z)(function*(){const a=yield Wu(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),c=new Hu(a);null==o.tenantId?o._agentRecaptchaConfig=c:o._tenantRecaptchaConfigs[o.tenantId]=c,c.emailPasswordEnabled&&new ba(o).verify()})()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new O.LL("auth","Firebase",o())}onAuthStateChanged(o,a,c){return this.registerStateListener(this.authStateSubscription,o,a,c)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,c){return this.registerStateListener(this.idTokenSubscription,o,a,c)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var c=this;return(0,I.Z)(function*(){const f=yield c.getOrInitRedirectPersistenceManager(a);return null===o?f.removeCurrentUser():f.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,I.Z)(function*(){if(!a.redirectPersistenceManager){const c=o&&Pe(o)||a._popupRedirectResolver;F(c,a,"argument-error"),a.redirectPersistenceManager=yield An.create(a,[Pe(c._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,I.Z)(function*(){var c,f;return a._isInitialized&&(yield a.queue((0,I.Z)(function*(){}))),(null===(c=a._currentUser)||void 0===c?void 0:c._redirectEventId)===o?a._currentUser:(null===(f=a.redirectUser)||void 0===f?void 0:f._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,I.Z)(function*(){if(o===a.currentUser)return a.queue((0,I.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const c=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==c&&(this.lastNotifiedUid=c,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,c,f){if(this._deleted)return()=>{};const g="function"==typeof a?a:a.next.bind(a),y=this._isInitialized?Promise.resolve():this._initializationPromise;return F(y,this,"internal-error"),y.then(()=>g(this.currentUser)),"function"==typeof a?o.addObserver(a,c,f):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,I.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=bi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.Z)(function*(){var a;const c={"X-Client-Version":o.clientVersion};o.app.options.appId&&(c["X-Firebase-gmpid"]=o.app.options.appId);const f=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();f&&(c["X-Firebase-Client"]=f);const g=yield o._getAppCheckToken();return g&&(c["X-Firebase-AppCheck"]=g),c})()}_getAppCheckToken(){var o=this;return(0,I.Z)(function*(){var a;const c=yield null===(a=o.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getToken();return c?.error&&function ho(h,...o){Vr.logLevel<=Je.in.WARN&&Vr.warn(`Auth (${Ge.SDK_VERSION}): ${h}`,...o)}(`Error while retrieving App Check token: ${c.error}`),c?.token})()}}function Ue(h){return(0,O.m9)(h)}class Xu{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,O.ne)(a=>this.observer=a)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Eo(h){const o=h.indexOf(":");return o<0?"":h.substr(0,o+1)}function Na(h){if(!h)return null;const o=Number(h);return isNaN(o)?null:o}class Ri{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return bt("not implemented")}_getIdTokenResponse(o){return bt("not implemented")}_linkToIdToken(o,a){return bt("not implemented")}_getReauthenticationResolver(o){return bt("not implemented")}}function nc(h,o){return(Ot=Ot||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:resetPassword",Te(a,c))})).apply(this,arguments)}function rc(h,o){return(fe=fe||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:update",c)})).apply(this,arguments)}function zr(h,o){return(ht=ht||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signInWithPassword",Te(a,c))})).apply(this,arguments)}function $r(h,o){return(B=B||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:sendOobCode",Te(a,c))})).apply(this,arguments)}function So(h,o){return(X=X||(0,I.Z)(function*(a,c){return $r(a,c)})).apply(this,arguments)}function jr(h,o){return(on=on||(0,I.Z)(function*(a,c){return $r(a,c)})).apply(this,arguments)}class Di extends Ri{constructor(o,a,c,f=null){super("password",c),this._email=o,this._password=a,this._tenantId=f}static _fromEmailAndPassword(o,a){return new Di(o,a,"password")}static _fromEmailAndCode(o,a,c=null){return new Di(o,a,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if(a?.email&&a?.password){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,I.Z)(function*(){var c;switch(a.signInMethod){case"password":const g={returnSecureToken:!0,email:a._email,password:a._password,clientType:"CLIENT_TYPE_WEB"};if(null!==(c=o._getRecaptchaConfig())&&void 0!==c&&c.emailPasswordEnabled){const y=yield Zt(o,g,"signInWithPassword");return zr(o,y)}var f;return zr(o,g).catch(function(y){return(f=f||(0,I.Z)(function*(_){if("auth/missing-recaptcha-token"===_.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const A=yield Zt(o,g,"signInWithPassword");return zr(o,A)}return Promise.reject(_)})).apply(this,arguments)});case"emailLink":return function dh(h,o){return(tr=tr||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signInWithEmailLink",Te(a,c))})).apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:De(o,"internal-error")}})()}_linkToIdToken(o,a){var c=this;return(0,I.Z)(function*(){switch(c.signInMethod){case"password":return rc(o,{idToken:a,returnSecureToken:!0,email:c._email,password:c._password});case"emailLink":return function $e(h,o){return(vn=vn||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signInWithEmailLink",Te(a,c))})).apply(this,arguments)}(o,{idToken:a,email:c._email,oobCode:c._password});default:De(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function Gn(h,o){return(fi=fi||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signInWithIdp",Te(a,c))})).apply(this,arguments)}class xn extends Ri{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new xn(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):De("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:c,signInMethod:f}=a,g=(0,sn._T)(a,["providerId","signInMethod"]);if(!c||!f)return null;const y=new xn(c,f);return y.idToken=g.idToken||void 0,y.accessToken=g.accessToken||void 0,y.secret=g.secret,y.nonce=g.nonce,y.pendingToken=g.pendingToken||null,y}_getIdTokenResponse(o){return Gn(o,this.buildRequest())}_linkToIdToken(o,a){const c=this.buildRequest();return c.idToken=a,Gn(o,c)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,Gn(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,O.xO)(a)}return o}}const Ao={USER_NOT_FOUND:"user-not-found"};class Et extends Ri{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new Et({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new Et({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function sc(h,o){return(me=me||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signInWithPhoneNumber",Te(a,c))})).apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function oc(h,o){return(ne=ne||(0,I.Z)(function*(a,c){const f=yield Wt(a,"POST","/v1/accounts:signInWithPhoneNumber",Te(a,c));if(f.temporaryProof)throw cr(a,"account-exists-with-different-credential",f);return f})).apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function ac(h,o){return(pe=pe||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signInWithPhoneNumber",Te(a,Object.assign(Object.assign({},c),{operation:"REAUTH"})),Ao)})).apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:c,verificationCode:f}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:c,code:f}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:c,phoneNumber:f,temporaryProof:g}=o;return c||a||f||g?new Et({verificationId:a,verificationCode:c,phoneNumber:f,temporaryProof:g}):null}}class Pi{constructor(o){var a,c,f,g,y,_;const A=(0,O.zd)((0,O.pd)(o)),b=null!==(a=A.apiKey)&&void 0!==a?a:null,K=null!==(c=A.oobCode)&&void 0!==c?c:null,G=function uc(h){switch(h){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(f=A.mode)&&void 0!==f?f:null);F(b&&K&&G,"argument-error"),this.apiKey=b,this.operation=G,this.code=K,this.continueUrl=null!==(g=A.continueUrl)&&void 0!==g?g:null,this.languageCode=null!==(y=A.languageCode)&&void 0!==y?y:null,this.tenantId=null!==(_=A.tenantId)&&void 0!==_?_:null}static parseLink(o){const a=function ph(h){const o=(0,O.zd)((0,O.pd)(h)).link,a=o?(0,O.zd)((0,O.pd)(o)).deep_link_id:null,c=(0,O.zd)((0,O.pd)(h)).deep_link_id;return(c?(0,O.zd)((0,O.pd)(c)).link:null)||c||a||o||h}(o);try{return new Pi(a)}catch{return null}}}let Kr=(()=>{class h{constructor(){this.providerId=h.PROVIDER_ID}static credential(a,c){return Di._fromEmailAndPassword(a,c)}static credentialWithLink(a,c){const f=Pi.parseLink(c);return F(f,"argument-error"),Di._fromEmailAndCode(a,f.code,f.tenantId)}}return h.PROVIDER_ID="password",h.EMAIL_PASSWORD_SIGN_IN_METHOD="password",h.EMAIL_LINK_SIGN_IN_METHOD="emailLink",h})();class Cn{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class fr extends Cn{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class zn extends fr{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return F("providerId"in a&&"signInMethod"in a,"argument-error"),xn._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return F(o.idToken||o.accessToken,"argument-error"),xn._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return zn.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return zn.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:c,oauthTokenSecret:f,pendingToken:g,nonce:y,providerId:_}=o;if(!c&&!f&&!a&&!g||!_)return null;try{return new zn(_)._credential({idToken:a,accessToken:c,nonce:y,pendingToken:g})}catch{return null}}}let Da=(()=>{class h extends fr{constructor(){super("facebook.com")}static credential(a){return xn._fromParams({providerId:h.PROVIDER_ID,signInMethod:h.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return h.credentialFromTaggedObject(a)}static credentialFromError(a){return h.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return h.credential(a.oauthAccessToken)}catch{return null}}}return h.FACEBOOK_SIGN_IN_METHOD="facebook.com",h.PROVIDER_ID="facebook.com",h})(),xs=(()=>{class h extends fr{constructor(){super("google.com"),this.addScope("profile")}static credential(a,c){return xn._fromParams({providerId:h.PROVIDER_ID,signInMethod:h.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:c})}static credentialFromResult(a){return h.credentialFromTaggedObject(a)}static credentialFromError(a){return h.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:c,oauthAccessToken:f}=a;if(!c&&!f)return null;try{return h.credential(c,f)}catch{return null}}}return h.GOOGLE_SIGN_IN_METHOD="google.com",h.PROVIDER_ID="google.com",h})(),lc=(()=>{class h extends fr{constructor(){super("github.com")}static credential(a){return xn._fromParams({providerId:h.PROVIDER_ID,signInMethod:h.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return h.credentialFromTaggedObject(a)}static credentialFromError(a){return h.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return h.credential(a.oauthAccessToken)}catch{return null}}}return h.GITHUB_SIGN_IN_METHOD="github.com",h.PROVIDER_ID="github.com",h})();class kn extends Ri{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return Gn(o,this.buildRequest())}_linkToIdToken(o,a){const c=this.buildRequest();return c.idToken=a,Gn(o,c)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,Gn(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:c,signInMethod:f,pendingToken:g}=a;return c&&f&&g&&c===f?new kn(c,g):null}static _create(o,a){return new kn(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Cs extends Cn{constructor(o){F(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Cs.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Cs.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=kn.fromJSON(o);return F(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:c}=o;if(!a||!c)return null;try{return kn._create(c,a)}catch{return null}}}let xo=(()=>{class h extends fr{constructor(){super("twitter.com")}static credential(a,c){return xn._fromParams({providerId:h.PROVIDER_ID,signInMethod:h.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:c})}static credentialFromResult(a){return h.credentialFromTaggedObject(a)}static credentialFromError(a){return h.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:c,oauthTokenSecret:f}=a;if(!c||!f)return null;try{return h.credential(c,f)}catch{return null}}}return h.TWITTER_SIGN_IN_METHOD="twitter.com",h.PROVIDER_ID="twitter.com",h})();function Oi(h,o){return(ue=ue||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signUp",Te(a,c))})).apply(this,arguments)}class Ht{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,c,f=!1){return(0,I.Z)(function*(){const g=yield Lt._fromIdTokenResponse(o,c,f),y=ks(c);return new Ht({user:g,providerId:y,_tokenResponse:c,operationType:a})})()}static _forOperation(o,a,c){return(0,I.Z)(function*(){yield o._updateTokensIfNecessary(c,!0);const f=ks(c);return new Ht({user:o,providerId:f,_tokenResponse:c,operationType:a})})()}}function ks(h){return h.providerId?h.providerId:"phoneNumber"in h?"phone":null}class bs extends O.ZR{constructor(o,a,c,f){var g;super(a.code,a.message),this.operationType=c,this.user=f,Object.setPrototypeOf(this,bs.prototype),this.customData={appName:o.name,tenantId:null!==(g=o.tenantId)&&void 0!==g?g:void 0,_serverResponse:a.customData._serverResponse,operationType:c}}static _fromErrorAndOperation(o,a,c,f){return new bs(o,a,c,f)}}function pr(h,o,a,c){return("reauthenticate"===o?a._getReauthenticationResolver(h):a._getIdTokenResponse(h)).catch(g=>{throw"auth/multi-factor-auth-required"===g.code?bs._fromErrorAndOperation(h,g,o,c):g})}function Pa(h){return new Set(h.map(({providerId:o})=>o).filter(o=>!!o))}function Co(h,o){return(ot=ot||(0,I.Z)(function*(a,c,f=!1){const g=yield T(a,c._linkToIdToken(a.auth,yield a.getIdToken()),f);return Ht._forOperation(a,"link",g)})).apply(this,arguments)}function Ns(h,o,a){return(Me=Me||(0,I.Z)(function*(c,f,g){yield L(f);const _=!1===c?"provider-already-linked":"no-such-provider";F(Pa(f.providerData).has(g)===c,f.auth,_)})).apply(this,arguments)}function Rs(h,o){return(Ln=Ln||(0,I.Z)(function*(a,c,f=!1){const{auth:g}=a,y="reauthenticate";try{const _=yield T(a,pr(g,y,c,a),f);F(_.idToken,g,"internal-error");const A=Ai(_.idToken);F(A,g,"internal-error");const{sub:b}=A;return F(a.uid===b,g,"user-mismatch"),Ht._forOperation(a,y,_)}catch(_){throw"auth/user-not-found"===_?.code&&De(g,"user-mismatch"),_}})).apply(this,arguments)}function Ft(h,o){return(Fe=Fe||(0,I.Z)(function*(a,c,f=!1){const g="signIn",y=yield pr(a,g,c),_=yield Ht._fromIdTokenResponse(a,g,y);return f||(yield a._updateCurrentUser(_.user)),_})).apply(this,arguments)}function Ds(h,o){return(pi=pi||(0,I.Z)(function*(a,c){return Ft(Ue(a),c)})).apply(this,arguments)}function Oa(h,o){return(an=an||(0,I.Z)(function*(a,c){const f=(0,O.m9)(a);return yield Ns(!1,f,c.providerId),Co(f,c)})).apply(this,arguments)}function Wr(h,o){return(nr=nr||(0,I.Z)(function*(a,c){return Rs((0,O.m9)(a),c)})).apply(this,arguments)}class Zr{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?ye._fromServerResponse(o,a):"totpInfo"in a?La._fromServerResponse(o,a):De(o,"internal-error")}}class ye extends Zr{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new ye(a)}}class La extends Zr{constructor(o){super("totp",o)}static _fromServerResponse(o,a){return new La(a)}}function gr(h,o,a){var c;F((null===(c=a.url)||void 0===c?void 0:c.length)>0,h,"invalid-continue-uri"),F(typeof a.dynamicLinkDomain>"u"||a.dynamicLinkDomain.length>0,h,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(F(a.iOS.bundleId.length>0,h,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(F(a.android.packageName.length>0,h,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function Hr(h,o){return(un=un||(0,I.Z)(function*(a,c){const f=(0,O.m9)(a),g=yield nc(f,{oobCode:c}),y=g.requestType;switch(F(y,f,"internal-error"),y){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":F(g.newEmail,f,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":F(g.mfaInfo,f,"internal-error");default:F(g.email,f,"internal-error")}let _=null;return g.mfaInfo&&(_=Zr._fromServerResponse(Ue(f),g.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===g.requestType?g.newEmail:g.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===g.requestType?g.email:g.newEmail)||null,multiFactorInfo:_},operation:y}})).apply(this,arguments)}function vc(h,o,a){return(Dr=Dr||(0,I.Z)(function*(c,f,g){const{auth:y}=c,A={idToken:yield c.getIdToken(),returnSecureToken:!0};f&&(A.email=f),g&&(A.password=g);const b=yield T(c,rc(y,A));yield c._updateTokensIfNecessary(b,!0)})).apply(this,arguments)}class Qr{constructor(o,a,c={}){this.isNewUser=o,this.providerId=a,this.profile=c}}class _c extends Qr{constructor(o,a,c,f){super(o,a,c),this.username=f}}class Ro extends Qr{constructor(o,a){super(o,"facebook.com",a)}}class _h extends _c{constructor(o,a){super(o,"github.com",a,"string"==typeof a?.login?a?.login:null)}}class Ih extends Qr{constructor(o,a){super(o,"google.com",a)}}class Mi extends _c{constructor(o,a,c){super(o,"twitter.com",a,c)}}function Ic(h){const{user:o,_tokenResponse:a}=h;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function vh(h){var o,a;if(!h)return null;const{providerId:c}=h,f=h.rawUserInfo?JSON.parse(h.rawUserInfo):{},g=h.isNewUser||"identitytoolkit#SignupNewUserResponse"===h.kind;if(!c&&h?.idToken){const y=null===(a=null===(o=Ai(h.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(y)return new Qr(g,"anonymous"!==y&&"custom"!==y?y:null)}if(!c)return null;switch(c){case"facebook.com":return new Ro(g,f);case"github.com":return new _h(g,f);case"google.com":return new Ih(g,f);case"twitter.com":return new Mi(g,f,h.screenName||null);case"custom":case"anonymous":return new Qr(g,null);default:return new Qr(g,c,f)}}(a)}class mr{constructor(o,a,c){this.type=o,this.credential=a,this.auth=c}static _fromIdtoken(o,a){return new mr("enroll",o,a)}static _fromMfaPendingCredential(o){return new mr("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,c;if(o?.multiFactorSession){if(null!==(a=o.multiFactorSession)&&void 0!==a&&a.pendingCredential)return mr._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null!==(c=o.multiFactorSession)&&void 0!==c&&c.idToken)return mr._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Do{constructor(o,a,c){this.session=o,this.hints=a,this.signInResolver=c}static _fromError(o,a){var c;const f=Ue(o),g=a.customData._serverResponse,y=(g.mfaInfo||[]).map(A=>Zr._fromServerResponse(f,A));F(g.mfaPendingCredential,f,"internal-error");const _=mr._fromMfaPendingCredential(g.mfaPendingCredential);return new Do(_,y,function(A){return(c=c||(0,I.Z)(function*(b){const K=yield b._process(f,_);delete g.mfaInfo,delete g.mfaPendingCredential;const G=Object.assign(Object.assign({},g),{idToken:K.idToken,refreshToken:K.refreshToken});switch(a.operationType){case"signIn":const Z=yield Ht._fromIdTokenResponse(f,a.operationType,G);return yield f._updateCurrentUser(Z.user),Z;case"reauthenticate":return F(a.user,f,"internal-error"),Ht._forOperation(a.user,a.operationType,G);default:De(f,"internal-error")}})).apply(this,arguments)})}resolveSignIn(o){var a=this;return(0,I.Z)(function*(){return a.signInResolver(o)})()}}class Po{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(c=>Zr._fromServerResponse(o.auth,c)))})}static _fromUser(o){return new Po(o)}getSession(){var o=this;return(0,I.Z)(function*(){return mr._fromIdtoken(yield o.user.getIdToken(),o.user.auth)})()}enroll(o,a){var c=this;return(0,I.Z)(function*(){const f=o,g=yield c.getSession(),y=yield T(c.user,f._process(c.user.auth,g,a));return yield c.user._updateTokensIfNecessary(y),c.user.reload()})()}unenroll(o){var a=this;return(0,I.Z)(function*(){const c="string"==typeof o?o:o.uid,f=yield a.user.getIdToken();try{const g=yield T(a.user,function Cc(h,o){return ve(h,"POST","/v2/accounts/mfaEnrollment:withdraw",Te(h,o))}(a.user.auth,{idToken:f,mfaEnrollmentId:c}));a.enrolledFactors=a.enrolledFactors.filter(({uid:y})=>y!==c),yield a.user._updateTokensIfNecessary(g),yield a.user.reload()}catch(g){throw g}})()}}const Oo=new WeakMap,Os="__sak";class Va{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Os,"1"),this.storage.removeItem(Os),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ls=(()=>{class h extends Va{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,c)=>this.onStorageEvent(a,c),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function bc(){const h=(0,O.z$)();return Aa(h)||Mt(h)}()&&function Io(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Se(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const c of Object.keys(this.listeners)){const f=this.storage.getItem(c),g=this.localCache[c];f!==g&&a(c,g,f)}}onStorageEvent(a,c=!1){if(!a.key)return void this.forAllChangedKeys((_,A,b)=>{this.notifyListeners(_,b)});const f=a.key;if(c?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const _=this.storage.getItem(f);if(a.newValue!==_)null!==a.newValue?this.storage.setItem(f,a.newValue):this.storage.removeItem(f);else if(this.localCache[f]===a.newValue&&!c)return}const g=()=>{const _=this.storage.getItem(f);!c&&this.localCache[f]===_||this.notifyListeners(f,_)},y=this.storage.getItem(f);!function Ku(){return(0,O.w1)()&&10===document.documentMode}()||y===a.newValue||a.newValue===a.oldValue?g():setTimeout(g,10)}notifyListeners(a,c){this.localCache[a]=c;const f=this.listeners[a];if(f)for(const g of Array.from(f))g(c&&JSON.parse(c))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,c,f)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:c,newValue:f}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,c){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(c)}_removeListener(a,c){this.listeners[a]&&(this.listeners[a].delete(c),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,c){var f=()=>super._set,g=this;return(0,I.Z)(function*(){yield f().call(g,a,c),g.localCache[a]=JSON.stringify(c)})()}_get(a){var c=()=>super._get,f=this;return(0,I.Z)(function*(){const g=yield c().call(f,a);return f.localCache[a]=JSON.stringify(g),g})()}_remove(a){var c=()=>super._remove,f=this;return(0,I.Z)(function*(){yield c().call(f,a),delete f.localCache[a]})()}}return h.type="LOCAL",h})(),jn=(()=>{class h extends Va{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,c){}_removeListener(a,c){}}return h.type="SESSION",h})();let Pc=(()=>{class h{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const c=this.receivers.find(g=>g.isListeningto(a));if(c)return c;const f=new h(a);return this.receivers.push(f),f}isListeningto(a){return this.eventTarget===a}handleEvent(a){var c=this;return(0,I.Z)(function*(){var f;const g=a,{eventId:y,eventType:_,data:A}=g.data,b=c.handlersMap[_];if(!b?.size)return;g.ports[0].postMessage({status:"ack",eventId:y,eventType:_});const K=Array.from(b).map(function(Z){return(f=f||(0,I.Z)(function*(re){return re(g.origin,A)})).apply(this,arguments)}),G=yield function Dc(h){var o;return Promise.all(h.map(function(a){return(o=o||(0,I.Z)(function*(c){try{return{fulfilled:!0,value:yield c}}catch(f){return{fulfilled:!1,reason:f}}})).apply(this,arguments)}))}(K);g.ports[0].postMessage({status:"done",eventId:y,eventType:_,response:G})})()}_subscribe(a,c){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(c)}_unsubscribe(a,c){this.handlersMap[a]&&c&&this.handlersMap[a].delete(c),(!c||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return h.receivers=[],h})();function Fi(h="",o=10){let a="";for(let c=0;c<o;c++)a+=Math.floor(10*Math.random());return h+a}class Oc{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,c=50){var f=this;return(0,I.Z)(function*(){const g=typeof MessageChannel<"u"?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let y,_;return new Promise((A,b)=>{const K=Fi("",20);g.port1.start();const G=setTimeout(()=>{b(new Error("unsupported_event"))},c);_={messageChannel:g,onMessage(Z){const re=Z;if(re.data.eventId===K)switch(re.data.status){case"ack":clearTimeout(G),y=setTimeout(()=>{b(new Error("timeout"))},3e3);break;case"done":clearTimeout(y),A(re.data.response);break;default:clearTimeout(G),clearTimeout(y),b(new Error("invalid_response"))}}},f.handlers.add(_),g.port1.addEventListener("message",_.onMessage),f.target.postMessage({eventType:o,eventId:K,data:a},[g.port2])}).finally(()=>{_&&f.removeMessageHandler(_)})})()}}function He(){return window}function Lo(){return typeof He().WorkerGlobalScope<"u"&&"function"==typeof He().importScripts}const Ba="firebaseLocalStorageDb",Ms="firebaseLocalStorage",qa="fbase_key";class Ui{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Qe(h,o){return h.transaction([Ms],o?"readwrite":"readonly").objectStore(Ms)}function Nn(){const h=indexedDB.open(Ba,1);return new Promise((o,a)=>{h.addEventListener("error",()=>{a(h.error)}),h.addEventListener("upgradeneeded",()=>{const c=h.result;try{c.createObjectStore(Ms,{keyPath:qa})}catch(f){a(f)}}),h.addEventListener("success",(0,I.Z)(function*(){const c=h.result;c.objectStoreNames.contains(Ms)?o(c):(c.close(),yield function Vi(){const h=indexedDB.deleteDatabase(Ba);return new Ui(h).toPromise()}(),o(yield Nn()))}))})}function Mo(h,o,a){return(rr=rr||(0,I.Z)(function*(c,f,g){const y=Qe(c,!0).put({[qa]:f,value:g});return new Ui(y).toPromise()})).apply(this,arguments)}function M(h,o){const a=Qe(h,!0).delete(o);return new Ui(a).toPromise()}const j=(()=>{class h{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,I.Z)(function*(){return a.db||(a.db=yield Nn()),a.db})()}_withRetries(a){var c=this;return(0,I.Z)(function*(){let f=0;for(;;)try{const g=yield c._openDb();return yield a(g)}catch(g){if(f++>3)throw g;c.db&&(c.db.close(),c.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,I.Z)(function*(){return Lo()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,I.Z)(function*(){var c,f;a.receiver=Pc._getInstance(function Uc(){return Lo()?self:null}()),a.receiver._subscribe("keyChanged",function(g,y){return(c=c||(0,I.Z)(function*(_,A){return{keyProcessed:(yield a._poll()).includes(A.key)}})).apply(this,arguments)}),a.receiver._subscribe("ping",function(g,y){return(f=f||(0,I.Z)(function*(_,A){return["keyChanged"]})).apply(this,arguments)})})()}initializeSender(){var a=this;return(0,I.Z)(function*(){var c,f;if(a.activeServiceWorker=yield function Mc(){return(ao=ao||(0,I.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new Oc(a.activeServiceWorker);const g=yield a.sender._send("ping",{},800);g&&null!==(c=g[0])&&void 0!==c&&c.fulfilled&&null!==(f=g[0])&&void 0!==f&&f.value.includes("keyChanged")&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var c=this;return(0,I.Z)(function*(){if(c.sender&&c.activeServiceWorker&&function Fc(){var h;return(null===(h=navigator?.serviceWorker)||void 0===h?void 0:h.controller)||null}()===c.activeServiceWorker)try{yield c.sender._send("keyChanged",{key:a},c.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,I.Z)(function*(){try{if(!indexedDB)return!1;const a=yield Nn();return yield Mo(a,Os,"1"),yield M(a,Os),!0}catch{}return!1})()}_withPendingWrite(a){var c=this;return(0,I.Z)(function*(){c.pendingWrites++;try{yield a()}finally{c.pendingWrites--}})()}_set(a,c){var f=this;return(0,I.Z)(function*(){return f._withPendingWrite((0,I.Z)(function*(){return yield f._withRetries(g=>Mo(g,a,c)),f.localCache[a]=c,f.notifyServiceWorker(a)}))})()}_get(a){var c=this;return(0,I.Z)(function*(){const f=yield c._withRetries(g=>function Rh(h,o){return(uo=uo||(0,I.Z)(function*(a,c){const f=Qe(a,!1).get(c),g=yield new Ui(f).toPromise();return void 0===g?null:g.value})).apply(this,arguments)}(g,a));return c.localCache[a]=f,f})()}_remove(a){var c=this;return(0,I.Z)(function*(){return c._withPendingWrite((0,I.Z)(function*(){return yield c._withRetries(f=>M(f,a)),delete c.localCache[a],c.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,I.Z)(function*(){const c=yield a._withRetries(y=>{const _=Qe(y,!1).getAll();return new Ui(_).toPromise()});if(!c)return[];if(0!==a.pendingWrites)return[];const f=[],g=new Set;for(const{fbase_key:y,value:_}of c)g.add(y),JSON.stringify(a.localCache[y])!==JSON.stringify(_)&&(a.notifyListeners(y,_),f.push(y));for(const y of Object.keys(a.localCache))a.localCache[y]&&!g.has(y)&&(a.notifyListeners(y,null),f.push(y));return f})()}notifyListeners(a,c){this.localCache[a]=c;const f=this.listeners[a];if(f)for(const g of Array.from(f))g(c)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,I.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,c){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(c)}_removeListener(a,c){this.listeners[a]&&(this.listeners[a].delete(c),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return h.type="LOCAL",h})(),je=1e12;class qc{constructor(o){this.auth=o,this.counter=je,this._widgets=new Map}render(o,a){const c=this.counter;return this._widgets.set(c,new Ph(o,this.auth.name,a||{})),this.counter++,c}reset(o){var a;const c=o||je;null===(a=this._widgets.get(c))||void 0===a||a.delete(),this._widgets.delete(c)}getResponse(o){var a;return(null===(a=this._widgets.get(o||je))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,I.Z)(function*(){var c;return null===(c=a._widgets.get(o||je))||void 0===c||c.execute(),""})()}}class Ph{constructor(o,a,c){this.params=c,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const f="string"==typeof o?document.getElementById(o):o;F(f,"argument-error",{appName:a}),this.container=f,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Oh(h){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let c=0;c<h;c++)o.push(a.charAt(Math.floor(62*Math.random())));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ga=Ni("rcb"),Lh=new En(3e4,6e4);class Gc{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(o=He().grecaptcha)||void 0===o||!o.render)}load(o,a=""){return F(function Fh(h){return h.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(h)}(a),o,"argument-error"),this.shouldResolveImmediately(a)&&Ca(He().grecaptcha)?Promise.resolve(He().grecaptcha):new Promise((c,f)=>{const g=He().setTimeout(()=>{f(Ze(o,"network-request-failed"))},Lh.get());He()[Ga]=()=>{He().clearTimeout(g),delete He()[Ga];const _=He().grecaptcha;if(!_||!Ca(_))return void f(Ze(o,"internal-error"));const A=_.render;_.render=(b,K)=>{const G=A(b,K);return this.counter++,G},this.hostLanguage=a,c(_)},ka(`https://www.google.com/recaptcha/api.js??${(0,O.xO)({onload:Ga,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(g),f(Ze(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!(null===(a=He().grecaptcha)||void 0===a||!a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class bf{load(o){return(0,I.Z)(function*(){return new qc(o)})()}clearedOneInstance(){}}const zc="recaptcha",$c={theme:"light",type:"image"};class ee{constructor(o,a=Object.assign({},$c),c){this.parameters=a,this.type=zc,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ue(c),this.isInvisible="invisible"===this.parameters.size,F(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const f="string"==typeof o?document.getElementById(o):o;F(f,this.auth,"argument-error"),this.container=f,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new bf:new Gc,this.validateStartingState()}verify(){var o=this;return(0,I.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),c=o.getAssertedRecaptcha();return c.getResponse(a)||new Promise(g=>{const y=_=>{_&&(o.tokenChangeListeners.delete(y),g(_))};o.tokenChangeListeners.add(y),o.isInvisible&&c.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){F(!this.parameters.sitekey,this.auth,"argument-error"),F(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),F(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(c=>c(a)),"function"==typeof o)o(a);else if("string"==typeof o){const c=He()[o];"function"==typeof c&&c(a)}}}assertNotDestroyed(){F(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const c=document.createElement("div");a.appendChild(c),a=c}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.Z)(function*(){F(ur()&&!Lo(),o.auth,"internal-error"),yield function Bi(){let h=null;return new Promise(o=>{"complete"!==document.readyState?(h=()=>o(),window.addEventListener("load",h)):o()}).catch(o=>{throw h&&window.removeEventListener("load",h),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function Ss(h){return(N=N||(0,I.Z)(function*(o){return(yield ve(o,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}(o.auth);F(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return F(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Fo{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=Et._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function oe(h,o,a){return(hs=hs||(0,I.Z)(function*(c,f,g){var y;const _=yield g.verify();try{let A;if(F("string"==typeof _,c,"argument-error"),F(g.type===zc,c,"argument-error"),A="string"==typeof f?{phoneNumber:f}:f,"session"in A){const b=A.session;if("phoneNumber"in A)return F("enroll"===b.type,c,"internal-error"),(yield function Sc(h,o){return ve(h,"POST","/v2/accounts/mfaEnrollment:start",Te(h,o))}(c,{idToken:b.credential,phoneEnrollmentInfo:{phoneNumber:A.phoneNumber,recaptchaToken:_}})).phoneSessionInfo.sessionInfo;{F("signin"===b.type,c,"internal-error");const K=(null===(y=A.multiFactorHint)||void 0===y?void 0:y.uid)||A.multiFactorUid;return F(K,c,"missing-multi-factor-info"),(yield function H(h,o){return ve(h,"POST","/v2/accounts/mfaSignIn:start",Te(h,o))}(c,{mfaPendingCredential:b.credential,mfaEnrollmentId:K,phoneSignInInfo:{recaptchaToken:_}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:b}=yield function ic(h,o){return(Ie=Ie||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:sendVerificationCode",Te(a,c))})).apply(this,arguments)}(c,{phoneNumber:A.phoneNumber,recaptchaToken:_});return b}}finally{g._reset()}})).apply(this,arguments)}let Ae=(()=>{class h{constructor(a){this.providerId=h.PROVIDER_ID,this.auth=Ue(a)}verifyPhoneNumber(a,c){return oe(this.auth,a,(0,O.m9)(c))}static credential(a,c){return Et._fromVerification(a,c)}static credentialFromResult(a){return h.credentialFromTaggedObject(a)}static credentialFromError(a){return h.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:c,temporaryProof:f}=a;return c&&f?Et._fromTokenResponse(c,f):null}}return h.PROVIDER_ID="phone",h.PHONE_SIGN_IN_METHOD="phone",h})();function V(h,o){return o?Pe(o):(F(h._popupRedirectResolver,h,"argument-error"),h._popupRedirectResolver)}class qi extends Ri{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return Gn(o,this._buildIdpRequest())}_linkToIdToken(o,a){return Gn(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return Gn(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function za(h){return Ft(h.auth,new qi(h),h.bypassAuthState)}function Yr(h){const{auth:o,user:a}=h;return F(a,o,"internal-error"),Rs(a,new qi(h),h.bypassAuthState)}function Vh(h){return(ds=ds||(0,I.Z)(function*(o){const{auth:a,user:c}=o;return F(c,a,"internal-error"),Co(c,new qi(o),o.bypassAuthState)})).apply(this,arguments)}class Us{constructor(o,a,c,f,g=!1){this.auth=o,this.resolver=c,this.user=f,this.bypassAuthState=g,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var a,o=this;return new Promise(function(c,f){return(a=a||(0,I.Z)(function*(g,y){o.pendingPromise={resolve:g,reject:y};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(_){o.reject(_)}})).apply(this,arguments)})}onAuthEvent(o){var a=this;return(0,I.Z)(function*(){const{urlResponse:c,sessionId:f,postBody:g,tenantId:y,error:_,type:A}=o;if(_)return void a.reject(_);const b={auth:a.auth,requestUri:c,sessionId:f,tenantId:y||void 0,postBody:g||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(A)(b))}catch(K){a.reject(K)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return za;case"linkViaPopup":case"linkViaRedirect":return Vh;case"reauthViaPopup":case"reauthViaRedirect":return Yr;default:De(this.auth,"internal-error")}}resolve(o){Kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){Kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Bh=new En(2e3,1e4);let Nt=(()=>{class h extends Us{constructor(a,c,f,g,y){super(a,c,g,y),this.provider=f,this.authWindow=null,this.pollId=null,h.currentPopupAction&&h.currentPopupAction.cancel(),h.currentPopupAction=this}executeNotNull(){var a=this;return(0,I.Z)(function*(){const c=yield a.execute();return F(c,a.auth,"internal-error"),c})()}onExecution(){var a=this;return(0,I.Z)(function*(){Kt(1===a.filter.length,"Popup operations only handle one event");const c=Fi();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],c),a.authWindow.associatedEvent=c,a.resolver._originValidation(a.auth).catch(f=>{a.reject(f)}),a.resolver._isIframeWebStorageSupported(a.auth,f=>{f||a.reject(Ze(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(Ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,h.currentPopupAction=null}pollUserCancellation(){const a=()=>{var c,f;this.pollId=null!==(f=null===(c=this.authWindow)||void 0===c?void 0:c.window)&&void 0!==f&&f.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Ze(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(a,Bh.get())};a()}}return h.currentPopupAction=null,h})();const $a="pendingRedirect",Gi=new Map;class Wc extends Us{constructor(o,a,c=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,c),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,I.Z)(function*(){let c=Gi.get(a.auth._key());if(!c){try{const g=(yield function yr(h,o){return(or=or||(0,I.Z)(function*(a,c){const f=zi(c),g=Zc(a);if(!(yield g._isAvailable()))return!1;const y="true"===(yield g._get(f));return yield g._remove(f),y})).apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;c=()=>Promise.resolve(g)}catch(f){c=()=>Promise.reject(f)}Gi.set(a.auth._key(),c)}return a.bypassAuthState||Gi.set(a.auth._key(),()=>Promise.resolve(null)),c()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,c=this;return(0,I.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(c,o);if("unknown"!==o.type){if(o.eventId){const f=yield c.auth._redirectUserForId(o.eventId);if(f)return c.user=f,a().call(c,o);c.resolve(null)}}else c.resolve(null)})()}onExecution(){return(0,I.Z)(function*(){})()}cleanUp(){}}function x(h,o){return(_i=_i||(0,I.Z)(function*(a,c){return Zc(a)._set(zi(c),"true")})).apply(this,arguments)}function Qt(h,o){Gi.set(h._key(),o)}function Zc(h){return Pe(h._redirectPersistence)}function zi(h){return Sn($a,h.config.apiKey,h.name)}function Tt(h,o){return(Mr=Mr||(0,I.Z)(function*(a,c,f=!1){const g=Ue(a),y=V(g,c),A=yield new Wc(g,y,f).execute();return A&&!f&&(delete A.user._redirectEventId,yield g._persistUserIfCurrent(A.user),yield g._setRedirectUser(null,c)),A})).apply(this,arguments)}function $i(h){return(Fr=Fr||(0,I.Z)(function*(o){const a=Fi(`${o.uid}:::`);return o._redirectEventId=a,yield o.auth._setRedirectUser(o),yield o.auth._persistUserIfCurrent(o),a})).apply(this,arguments)}class Ka{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(c=>{this.isEventForConsumer(o,c)&&(a=!0,this.sendToConsumer(o,c),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Yc(h){switch(h.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qc(h);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var c;if(o.error&&!Qc(o)){const f=(null===(c=o.error.code)||void 0===c?void 0:c.split("auth/")[1])||"internal-error";a.onError(Ze(this.auth,f))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const c=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&c}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(gt(o))}saveEventToCache(o){this.cachedEventUids.add(gt(o)),this.lastProcessedEventTime=Date.now()}}function gt(h){return[h.type,h.eventId,h.sessionId,h.tenantId].filter(o=>o).join("-")}function Qc({type:h,error:o}){return"unknown"===h&&"auth/no-auth-event"===o?.code}function dn(h){return(Ur=Ur||(0,I.Z)(function*(o,a={}){return ve(o,"GET","/v1/projects",a)})).apply(this,arguments)}const Xc=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vo=/^https?/;function $h(h){const o=Br(),{protocol:a,hostname:c}=new URL(o);if(h.startsWith("chrome-extension://")){const y=new URL(h);return""===y.hostname&&""===c?"chrome-extension:"===a&&h.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&y.hostname===c}if(!Vo.test(a))return!1;if(Xc.test(h))return c===h;const f=h.replace(/\./g,"\\.");return new RegExp("^(.+\\."+f+"|"+f+")$","i").test(c)}const jh=new En(3e4,6e4);function el(){const h=He().___jsl;if(h?.H)for(const o of Object.keys(h.H))if(h.H[o].r=h.H[o].r||[],h.H[o].L=h.H[o].L||[],h.H[o].r=[...h.H[o].L],h.CP)for(let a=0;a<h.CP.length;a++)h.CP[a]=null}let Bo=null;const Zh=new En(5e3,15e3),Yh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Xh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Jh(h){const o=h.config;F(o.authDomain,h,"auth-domain-config-required");const a=o.emulator?Ei(o,"emulator/auth/iframe"):`https://${h.config.authDomain}/__/auth/iframe`,c={apiKey:o.apiKey,appName:h.name,v:Ge.SDK_VERSION},f=Xh.get(h.config.apiHost);f&&(c.eid=f);const g=h._getFrameworks();return g.length&&(c.fw=g.join(",")),`${a}?${(0,O.xO)(c).slice(1)}`}const td={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Wa{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const ct="__/auth/handler",rl="emulator/auth/handler",_r=encodeURIComponent("fac");function qo(h,o,a,c,f,g){return(cn=cn||(0,I.Z)(function*(y,_,A,b,K,G){F(y.config.authDomain,y,"auth-domain-config-required"),F(y.config.apiKey,y,"invalid-api-key");const Z={apiKey:y.config.apiKey,appName:y.name,authType:A,redirectUrl:b,v:Ge.SDK_VERSION,eventId:K};if(_ instanceof Cn){_.setDefaultLanguage(y.languageCode),Z.providerId=_.providerId||"",(0,O.xb)(_.getCustomParameters())||(Z.customParameters=JSON.stringify(_.getCustomParameters()));for(const[Rt,pn]of Object.entries(G||{}))Z[Rt]=pn}if(_ instanceof fr){const Rt=_.getScopes().filter(pn=>""!==pn);Rt.length>0&&(Z.scopes=Rt.join(","))}y.tenantId&&(Z.tid=y.tenantId);const re=Z;for(const Rt of Object.keys(re))void 0===re[Rt]&&delete re[Rt];const ke=yield y._getAppCheckToken(),xt=ke?`#${_r}=${encodeURIComponent(ke)}`:"";return`${function xe({config:h}){return h.emulator?Ei(h,rl):`https://${h.authDomain}/${ct}`}(y)}?${(0,O.xO)(re).slice(1)}${xt}`})).apply(this,arguments)}const ji="webStorageSupport",Ce=class mt{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=jn,this._completeRedirectFn=Tt,this._overrideRedirectResult=Qt}_openPopup(o,a,c,f){var g=this;return(0,I.Z)(function*(){var y;Kt(null===(y=g.eventManagers[o._key()])||void 0===y?void 0:y.manager,"_initialize() not called before _openPopup()");const _=yield qo(o,a,c,Br(),f);return function id(h,o,a,c=500,f=600){const g=Math.max((window.screen.availHeight-f)/2,0).toString(),y=Math.max((window.screen.availWidth-c)/2,0).toString();let _="";const A=Object.assign(Object.assign({},td),{width:c.toString(),height:f.toString(),top:g,left:y}),b=(0,O.z$)().toLowerCase();a&&(_=$u(b)?"_blank":a),yo(b)&&(o=o||"http://localhost",A.scrollbars="yes");const K=Object.entries(A).reduce((Z,[re,ke])=>`${Z}${re}=${ke},`,"");if(function _o(h=(0,O.z$)()){var o;return Mt(h)&&!(null===(o=window.navigator)||void 0===o||!o.standalone)}(b)&&"_self"!==_)return function Za(h,o){const a=document.createElement("a");a.href=h,a.target=o;const c=document.createEvent("MouseEvent");c.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(c)}(o||"",_),new Wa(null);const G=window.open(o||"",_,K);F(G,h,"popup-blocked");try{G.focus()}catch{}return new Wa(G)}(o,_,Fi())})()}_openRedirect(o,a,c,f){var g=this;return(0,I.Z)(function*(){return yield g._originValidation(o),function Lc(h){He().location.href=h}(yield qo(o,a,c,Br(),f)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:f,promise:g}=this.eventManagers[a];return f?Promise.resolve(f):(Kt(g,"If manager is not set, promise should be"),g)}const c=this.initAndGetManager(o);return this.eventManagers[a]={promise:c},c.catch(()=>{delete this.eventManagers[a]}),c}initAndGetManager(o){var a=this;return(0,I.Z)(function*(){const c=yield function ed(h){return(ms=ms||(0,I.Z)(function*(o){const a=yield function Wh(h){return Bo=Bo||function Kh(h){return new Promise((o,a)=>{var c,f,g;function y(){el(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{el(),a(Ze(h,"network-request-failed"))},timeout:jh.get()})}if(null!==(f=null===(c=He().gapi)||void 0===c?void 0:c.iframes)&&void 0!==f&&f.Iframe)o(gapi.iframes.getContext());else{if(null===(g=He().gapi)||void 0===g||!g.load){const _=Ni("iframefcb");return He()[_]=()=>{gapi.load?y():a(Ze(h,"network-request-failed"))},ka(`https://apis.google.com/js/api.js?onload=${_}`).catch(A=>a(A))}y()}}).catch(o=>{throw Bo=null,o})}(h),Bo}(o),c=He().gapi;return F(c,o,"internal-error"),a.open({where:document.body,url:Jh(o),messageHandlersFilter:c.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yh,dontclear:!0},f=>{var g;return new Promise(function(y,_){return(g=g||(0,I.Z)(function*(A,b){yield f.restyle({setHideOnLeave:!1});const K=Ze(o,"network-request-failed"),G=He().setTimeout(()=>{b(K)},Zh.get());function Z(){He().clearTimeout(G),A(f)}f.ping(Z).then(Z,()=>{b(K)})})).apply(this,arguments)})})})).apply(this,arguments)}(o),f=new Ka(o);return c.register("authEvent",g=>(F(g?.authEvent,o,"invalid-auth-event"),{status:f.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:f},a.iframes[o._key()]=c,f})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(ji,{type:ji},f=>{var g;const y=null===(g=f?.[0])||void 0===g?void 0:g[ji];void 0!==y&&a(!!y),De(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Jc(h){return(gs=gs||(0,I.Z)(function*(o){if(o.config.emulator)return;const{authorizedDomains:a}=yield dn(o);for(const c of a)try{if($h(c))return}catch{}De(o,"unauthorized-domain")})).apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return Se()||Aa()||Mt()}};class il{constructor(o){this.factorId=o}_process(o,a,c){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,c);case"signin":return this._finalizeSignIn(o,a.credential);default:return bt("unexpected MultiFactorSessionType")}}}class Ir extends il{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new Ir(o)}_finalizeEnroll(o,a,c){return function Ac(h,o){return ve(h,"POST","/v2/accounts/mfaEnrollment:finalize",Te(h,o))}(o,{idToken:a,displayName:c,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function Dh(h,o){return ve(h,"POST","/v2/accounts/mfaSignIn:finalize",Te(h,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Ut=(()=>{class h{constructor(){}static assertion(a){return Ir._fromCredential(a)}}return h.FACTOR_ID="phone",h})();var Hn,fn,Ki,Qn,Ya,Kn="@firebase/auth";class Wn{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,I.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(c=>{o(c?.stsTokenManager.accessToken||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);a&&(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function rn(){return window}(0,O.Pz)("authIdTokenMaxAge"),function $o(h){(0,Ge._registerComponent)(new et.wA("auth",(o,{options:a})=>{const c=o.getProvider("app").getImmediate(),f=o.getProvider("heartbeat"),g=o.getProvider("app-check-internal"),{apiKey:y,authDomain:_}=c.options;F(y&&!y.includes(":"),"invalid-api-key",{appName:c.name});const A={apiKey:y,authDomain:_,clientPlatform:h,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:bi(h)},b=new lh(c,f,g,A);return function ec(h,o){const a=o?.persistence||[],c=(Array.isArray(a)?a:[a]).map(Pe);o?.errorMap&&h._updateErrorMap(o.errorMap),h._initializeWithPersistence(c,o?.popupRedirectResolver)}(b,a),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,c)=>{o.getProvider("auth-internal").initialize()})),(0,Ge._registerComponent)(new et.wA("auth-internal",o=>{const a=Ue(o.getProvider("auth").getImmediate());return new Wn(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,Ge.registerVersion)(Kn,"0.23.2",function zo(h){switch(h){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(h)),(0,Ge.registerVersion)(Kn,"0.23.2","esm2017")}("Browser");class al extends Ka{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,I.Z)(function*(){yield o.initPromise})()}}function eu(h){return(Ya=Ya||(0,I.Z)(function*(o){const a=yield Wo()._get(Ee(o));return a&&(yield Wo()._remove(Ee(o))),a})).apply(this,arguments)}function yt(){const h=[];for(let a=0;a<20;a++){const c=Math.floor(62*Math.random());h.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(c))}return h.join("")}function Wo(){return Pe(Ls)}function Ee(h){return Sn("authEvent",h.config.apiKey,h.name)}function $s(h){if(!h?.includes("?"))return{};const[o,...a]=h.split("?");return(0,O.zd)(a.join("?"))}const ll=class cd{constructor(){this._redirectPersistence=jn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Tt,this._overrideRedirectResult=Qt}_initialize(o){var a=this;return(0,I.Z)(function*(){const c=o._key();let f=a.eventManagers.get(c);return f||(f=new al(o),a.eventManagers.set(c,f),a.attachCallbackListeners(o,f)),f})()}_openPopup(o){De(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,c,f){var g=this;return(0,I.Z)(function*(){!function sl(h){var o,a,c,f,g,y,_,A,b,K;const G=rn();F("function"==typeof(null===(o=G?.universalLinks)||void 0===o?void 0:o.subscribe),h,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),F(typeof(null===(a=G?.BuildInfo)||void 0===a?void 0:a.packageName)<"u",h,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),F("function"==typeof(null===(g=null===(f=null===(c=G?.cordova)||void 0===c?void 0:c.plugins)||void 0===f?void 0:f.browsertab)||void 0===g?void 0:g.openUrl),h,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),F("function"==typeof(null===(A=null===(_=null===(y=G?.cordova)||void 0===y?void 0:y.plugins)||void 0===_?void 0:_.browsertab)||void 0===A?void 0:A.isAvailable),h,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),F("function"==typeof(null===(K=null===(b=G?.cordova)||void 0===b?void 0:b.InAppBrowser)||void 0===K?void 0:K.open),h,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const y=yield g._initialize(o);yield y.initialized(),y.resetRedirect(),function Uo(){Gi.clear()}(),yield g._originValidation(o);const _=function ad(h,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:yt(),postBody:null,tenantId:h.tenantId,error:Ze(h,"no-auth-event")}}(o,c,f);yield function ud(h,o){return Wo()._set(Ee(h),o)}(o,_);const A=yield function jo(h,o,a){return(Hn=Hn||(0,I.Z)(function*(c,f,g){var y;const{BuildInfo:_}=rn();Kt(f.sessionId,"AuthEvent did not contain a session ID");const A=yield function ol(h){return(Qn=Qn||(0,I.Z)(function*(o){const a=function Ko(h){if(Kt(/[0-9a-zA-Z]+/.test(h),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(h);const o=new ArrayBuffer(h.length),a=new Uint8Array(o);for(let c=0;c<h.length;c++)a[c]=h.charCodeAt(c);return a}(o),c=yield crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(c)).map(g=>g.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}(f.sessionId),b={};return Mt()?b.ibi=_.packageName:ki()?b.apn=_.packageName:De(c,"operation-not-supported-in-this-environment"),_.displayName&&(b.appDisplayName=_.displayName),b.sessionId=A,qo(c,g,f.type,void 0,null!==(y=f.eventId)&&void 0!==y?y:void 0,b)})).apply(this,arguments)}(o,_,a),b=yield function Ja(h){const{cordova:o}=rn();return new Promise(a=>{o.plugins.browsertab.isAvailable(c=>{let f=null;c?o.plugins.browsertab.openUrl(h):f=o.InAppBrowser.open(h,function vo(h=(0,O.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(h)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(h)}()?"_blank":"_system","location=yes"),a(f)})})}(A);return function Gs(h,o,a){return(Ki=Ki||(0,I.Z)(function*(c,f,g){const{cordova:y}=rn();let _=()=>{};try{yield new Promise((A,b)=>{let K=null;function G(){var ke;A();const xt=null===(ke=y.plugins.browsertab)||void 0===ke?void 0:ke.close;"function"==typeof xt&&xt(),"function"==typeof g?.close&&g.close()}function Z(){K||(K=window.setTimeout(()=>{b(Ze(c,"redirect-cancelled-by-user"))},2e3))}function re(){"visible"===document?.visibilityState&&Z()}f.addPassiveListener(G),document.addEventListener("resume",Z,!1),ki()&&document.addEventListener("visibilitychange",re,!1),_=()=>{f.removePassiveListener(G),document.removeEventListener("resume",Z,!1),document.removeEventListener("visibilitychange",re,!1),K&&window.clearTimeout(K)}})}finally{_()}})).apply(this,arguments)}(o,y,b)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Jr(h){return(fn=fn||(0,I.Z)(function*(o){const{BuildInfo:a}=rn(),c={};Mt()?c.iosBundleId=a.packageName:ki()?c.androidPackageName=a.packageName:De(o,"operation-not-supported-in-this-environment"),yield dn(o,c)})).apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){var c,f;const{universalLinks:g,handleOpenURL:y,BuildInfo:_}=rn(),A=setTimeout((0,I.Z)(function*(){yield eu(o),a.onEvent(ae())}),500),b=function(re){return(c=c||(0,I.Z)(function*(ke){clearTimeout(A);const xt=yield eu(o);let Rt=null;xt&&ke?.url&&(Rt=function ul(h,o){var a,c;const f=function cl(h){const o=$s(h),a=o.link?decodeURIComponent(o.link):void 0,c=$s(a).link,f=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return $s(f).link||f||c||a||h}(o);if(f.includes("/__/auth/callback")){const g=$s(f),y=g.firebaseError?function Er(h){try{return JSON.parse(h)}catch{return null}}(decodeURIComponent(g.firebaseError)):null,_=null===(c=null===(a=y?.code)||void 0===a?void 0:a.split("auth/"))||void 0===c?void 0:c[1],A=_?Ze(_):null;return A?{type:h.type,eventId:h.eventId,tenantId:h.tenantId,error:A,urlResponse:null,sessionId:null,postBody:null}:{type:h.type,eventId:h.eventId,tenantId:h.tenantId,sessionId:h.sessionId,urlResponse:f,postBody:null}}return null}(xt,ke.url)),a.onEvent(Rt||ae())})).apply(this,arguments)};typeof g<"u"&&"function"==typeof g.subscribe&&g.subscribe(null,b);const K=y,G=`${_.packageName.toLowerCase()}://`;rn().handleOpenURL=function(Z){return(f=f||(0,I.Z)(function*(re){if(re.toLowerCase().startsWith(G)&&b({url:re}),"function"==typeof K)try{K(re)}catch(ke){console.error(ke)}})).apply(this,arguments)}}};function ae(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ze("no-auth-event")}}var ei,Zo,Ho;function Zi(){var h;return(null===(h=self?.location)||void 0===h?void 0:h.protocol)||null}function pl(h=(0,O.z$)()){return!("file:"!==Zi()&&"ionic:"!==Zi()&&"capacitor:"!==Zi()||!h.toLowerCase().match(/iphone|ipad|ipod|android/))}function nu(){try{const h=self.localStorage,o=Fi();if(h)return h.setItem(o,"1"),h.removeItem(o),!function dd(h=(0,O.z$)()){return function hd(){return(0,O.w1)()&&11===document?.documentMode}()||function gl(h=(0,O.z$)()){return/Edge\/\d+/.test(h)}(h)}()||(0,O.hl)()}catch{return ru()&&(0,O.hl)()}return!1}function ru(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function iu(){return(function fl(){return"http:"===Zi()||"https:"===Zi()}()||(0,O.ru)()||pl())&&!function ld(){return(0,O.b$)()||(0,O.UG)()}()&&nu()&&!ru()}function ml(){return pl()&&typeof document<"u"}const vt={LOCAL:"local",NONE:"none",SESSION:"session"},Tr=F,js="persistence";function Qo(h){return(Zo=Zo||(0,I.Z)(function*(o){yield o._initializationPromise;const a=ou(),c=Sn(js,o.config.apiKey,o.name);a&&a.setItem(c,o._getPersistence())})).apply(this,arguments)}function ou(){var h;try{return(null===(h=function ti(){return typeof window<"u"?window:null}())||void 0===h?void 0:h.sessionStorage)||null}catch{return null}}const Hi=F;class Xn{constructor(){this.browserResolver=Pe(Ce),this.cordovaResolver=Pe(ll),this.underlyingResolver=null,this._redirectPersistence=jn,this._completeRedirectFn=Tt,this._overrideRedirectResult=Qt}_initialize(o){var a=this;return(0,I.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,c,f){var g=this;return(0,I.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openPopup(o,a,c,f)})()}_openRedirect(o,a,c,f){var g=this;return(0,I.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openRedirect(o,a,c,f)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return ml()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Hi(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,I.Z)(function*(){if(o.underlyingResolver)return;const a=yield function su(){return(ei=ei||(0,I.Z)(function*(){return!!ml()&&new Promise(h=>{const o=setTimeout(()=>{h(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),h(!0)})})})).apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function Yo(h){return h.unwrap()}function au(h){return St(h)}function St(h){const{_tokenResponse:o}=h instanceof O.ZR?h.customData:h;if(!o)return null;if(!(h instanceof O.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Ae.credentialFromResult(h);const a=o.providerId;if(!a||a===Un.PASSWORD)return null;let c;switch(a){case Un.GOOGLE:c=xs;break;case Un.FACEBOOK:c=Da;break;case Un.GITHUB:c=lc;break;case Un.TWITTER:c=xo;break;default:const{oauthIdToken:f,oauthAccessToken:g,oauthTokenSecret:y,pendingToken:_,nonce:A}=o;return g||y||f||_?_?a.startsWith("saml.")?kn._create(a,_):xn._fromParams({providerId:a,signInMethod:a,pendingToken:_,idToken:f,accessToken:g}):new zn(a).credential({idToken:f,accessToken:g,rawNonce:A}):null}return h instanceof O.ZR?c.credentialFromError(h):c.credentialFromResult(h)}function At(h,o){return o.catch(a=>{throw a instanceof O.ZR&&function ni(h,o){var a;const c=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===o?.code)o.resolver=new Ks(h,function Tc(h,o){var a;const c=(0,O.m9)(h),f=o;return F(o.customData.operationType,c,"argument-error"),F(null===(a=f.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,c,"argument-error"),Do._fromError(c,f)}(h,o));else if(c){const f=St(o),g=o;f&&(g.credential=f,g.tenantId=c.tenantId||void 0,g.email=c.email||void 0,g.phoneNumber=c.phoneNumber||void 0)}}(h,a),a}).then(a=>{const f=a.user;return{operationType:a.operationType,credential:au(a),additionalUserInfo:Ic(a),user:Rn.getOrCreate(f)}})}function Qi(h,o){return(Ho=Ho||(0,I.Z)(function*(a,c){const f=yield c;return{verificationId:f.verificationId,confirm:g=>At(a,f.confirm(g))}})).apply(this,arguments)}class Ks{constructor(o,a){this.resolver=a,this.auth=function Xo(h){return h.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return At(Yo(this.auth),this.resolver.resolveSignIn(o))}}class Rn{constructor(o){this._delegate=o,this.multiFactor=function kc(h){const o=(0,O.m9)(h);return Oo.has(o)||Oo.set(o,Po._fromUser(o)),Oo.get(o)}(o)}static getOrCreate(o){return Rn.USER_MAP.has(o)||Rn.USER_MAP.set(o,new Rn(o)),Rn.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,I.Z)(function*(){return At(a.auth,Oa(a._delegate,o))})()}linkWithPhoneNumber(o,a){var c=this;return(0,I.Z)(function*(){return Qi(c.auth,function Y(h,o,a){return(ir=ir||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c);yield Ns(!1,y,"phone");const _=yield oe(y.auth,f,(0,O.m9)(g));return new Fo(_,A=>Oa(y,A))})).apply(this,arguments)}(c._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,I.Z)(function*(){return At(a.auth,function Kc(h,o,a){return(sr=sr||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c);Vn(y.auth,f,Cn);const _=V(y.auth,g);return new Nt(y.auth,"linkViaPopup",f,_,y).executeNotNull()})).apply(this,arguments)}(a._delegate,o,Xn))})()}linkWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield Qo(Ue(a.auth)),function ja(h,o,a){return function Gh(h,o,a){return(ar=ar||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c);Vn(y.auth,f,Cn),yield y.auth._initializationPromise;const _=V(y.auth,g);yield Ns(!1,y,f.providerId),yield x(_,y.auth);const A=yield $i(y);return _._openRedirect(y.auth,f,"linkViaRedirect",A)})).apply(this,arguments)}(h,o,a)}(a._delegate,o,Xn)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,I.Z)(function*(){return At(a.auth,Wr(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return Qi(this.auth,function Fs(h,o,a){return(Pr=Pr||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c),_=yield oe(y.auth,f,(0,O.m9)(g));return new Fo(_,A=>Wr(y,A))})).apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return At(this.auth,function jc(h,o,a){return(Lr=Lr||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c);Vn(y.auth,f,Cn);const _=V(y.auth,g);return new Nt(y.auth,"reauthViaPopup",f,_,y).executeNotNull()})).apply(this,arguments)}(this._delegate,o,Xn))}reauthenticateWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield Qo(Ue(a.auth)),function Xr(h,o,a){return function Hc(h,o,a){return(fs=fs||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c);Vn(y.auth,f,Cn),yield y.auth._initializationPromise;const _=V(y.auth,g);yield x(_,y.auth);const A=yield $i(y);return _._openRedirect(y.auth,f,"reauthViaRedirect",A)})).apply(this,arguments)}(h,o,a)}(a._delegate,o,Xn)})()}sendEmailVerification(o){return function No(h,o){return(mi=mi||(0,I.Z)(function*(a,c){const f=(0,O.m9)(a),y={requestType:"VERIFY_EMAIL",idToken:yield a.getIdToken()};c&&gr(f.auth,y,c);const{email:_}=yield function Ra(h,o){return(yn=yn||(0,I.Z)(function*(a,c){return $r(a,c)})).apply(this,arguments)}(f.auth,y);_!==a.email&&(yield a.reload())})).apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,I.Z)(function*(){return yield function pc(h,o){return(Re=Re||(0,I.Z)(function*(a,c){const f=(0,O.m9)(a);yield Ns(!0,f,c);const{providerUserInfo:g}=yield function Sa(h,o){return(Gt=Gt||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:update",c)})).apply(this,arguments)}(f.auth,{idToken:yield f.getIdToken(),deleteProvider:[c]}),y=Pa(g||[]);return f.providerData=f.providerData.filter(_=>y.has(_.providerId)),y.has("phone")||(f.phoneNumber=null),yield f.auth._persistUserIfCurrent(f),f})).apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function yh(h,o){return vc((0,O.m9)(h),o,null)}(this._delegate,o)}updatePassword(o){return function Ua(h,o){return vc((0,O.m9)(h),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function Uh(h,o){return(Fn=Fn||(0,I.Z)(function*(a,c){yield Co((0,O.m9)(a),c)})).apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function mh(h,o){return(vi=vi||(0,I.Z)(function*(a,{displayName:c,photoURL:f}){if(void 0===c&&void 0===f)return;const g=(0,O.m9)(a),_={idToken:yield g.getIdToken(),displayName:c,photoUrl:f,returnSecureToken:!0},A=yield T(g,function Li(h,o){return(In=In||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:update",c)})).apply(this,arguments)}(g.auth,_));g.displayName=A.displayName||null,g.photoURL=A.photoUrl||null;const b=g.providerData.find(({providerId:K})=>"password"===K);b&&(b.displayName=g.displayName,b.photoURL=g.photoURL),yield g._updateTokensIfNecessary(A)})).apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function yc(h,o,a){return(yi=yi||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c),A={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:f};g&&gr(y.auth,A,g);const{email:b}=yield function As(h,o){return(Jt=Jt||(0,I.Z)(function*(a,c){return $r(a,c)})).apply(this,arguments)}(y.auth,A);b!==c.email&&(yield c.reload())})).apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Rn.USER_MAP=new WeakMap;const ri=F;let Yi=(()=>{class h{constructor(a,c){if(this.app=a,c.isInitialized())return this._delegate=c.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:f}=a.options;ri(f,"invalid-api-key",{appName:a.name}),ri(f,"invalid-api-key",{appName:a.name});const g=typeof window<"u"?Xn:void 0;this._delegate=c.initialize({options:{persistence:vl(f,a.name),popupRedirectResolver:g}}),this._delegate._updateErrorMap(Ia),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Rn.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,c){!function wo(h,o,a){const c=Ue(h);F(c._canInitEmulator,c,"emulator-config-failed"),F(/^https?:\/\//.test(o),c,"invalid-emulator-scheme");const f=!!a?.disableWarnings,g=Eo(o),{host:y,port:_}=function tc(h){const o=Eo(h),a=/(\/\/)?([^?#/]+)/.exec(h.substr(o.length));if(!a)return{host:"",port:null};const c=a[2].split("@").pop()||"",f=/^(\[[^\]]+\])(:|$)/.exec(c);if(f){const g=f[1];return{host:g,port:Na(c.substr(g.length+1))}}{const[g,y]=c.split(":");return{host:g,port:Na(y)}}}(o);c.config.emulator={url:`${g}//${y}${null===_?"":`:${_}`}/`},c.settings.appVerificationDisabledForTesting=!0,c.emulatorConfig=Object.freeze({host:y,port:_,protocol:g.replace(":",""),options:Object.freeze({disableWarnings:f})}),f||function hh(){function h(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",h):h())}()}(this._delegate,a,c)}applyActionCode(a){return function Ma(h,o){return(wt=wt||(0,I.Z)(function*(a,c){yield function To(h,o){return(mn=mn||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:update",Te(a,c))})).apply(this,arguments)}((0,O.m9)(a),{oobCode:c})})).apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return Hr(this._delegate,a)}confirmPasswordReset(a,c){return function gc(h,o,a){return(be=be||(0,I.Z)(function*(c,f,g){yield nc((0,O.m9)(c),{oobCode:f,newPassword:g})})).apply(this,arguments)}(this._delegate,a,c)}createUserWithEmailAndPassword(a,c){var f=this;return(0,I.Z)(function*(){return At(f._delegate,function mc(h,o,a){return(at=at||(0,I.Z)(function*(c,f,g){var y;const _=Ue(c),A={returnSecureToken:!0,email:f,password:g,clientType:"CLIENT_TYPE_WEB"};let b;if(null!==(y=_._getRecaptchaConfig())&&void 0!==y&&y.emailPasswordEnabled){const re=yield Zt(_,A,"signUpPassword");b=Oi(_,re)}else{var K;b=Oi(_,A).catch(function(re){return(K=K||(0,I.Z)(function*(ke){if("auth/missing-recaptcha-token"===ke.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const xt=yield Zt(_,A,"signUpPassword");return Oi(_,xt)}return Promise.reject(ke)})).apply(this,arguments)})}const G=yield b.catch(re=>Promise.reject(re)),Z=yield Ht._fromIdTokenResponse(_,"signIn",G);return yield _._updateCurrentUser(Z.user),Z})).apply(this,arguments)}(f._delegate,a,c))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function Ps(h,o){return(Rr=Rr||(0,I.Z)(function*(a,c){const g={identifier:c,continueUri:ur()?Br():"http://localhost"},{signinMethods:y}=yield function bo(h,o){return(gi=gi||(0,I.Z)(function*(a,c){return ve(a,"POST","/v1/accounts:createAuthUri",Te(a,c))})).apply(this,arguments)}((0,O.m9)(a),g);return y||[]})).apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function pt(h,o){const a=Pi.parseLink(o);return"EMAIL_SIGNIN"===a?.operation}(0,a)}getRedirectResult(){var a=this;return(0,I.Z)(function*(){ri(iu(),a._delegate,"operation-not-supported-in-this-environment");const c=yield function zh(h,o){return(ps=ps||(0,I.Z)(function*(a,c){return yield Ue(a)._initializationPromise,Tt(a,c,!1)})).apply(this,arguments)}(a._delegate,Xn);return c?At(a._delegate,Promise.resolve(c)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function _e(h,o){Ue(h)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,c,f){const{next:g,error:y,complete:_}=uu(a,c,f);return this._delegate.onAuthStateChanged(g,y,_)}onIdTokenChanged(a,c,f){const{next:g,error:y,complete:_}=uu(a,c,f);return this._delegate.onIdTokenChanged(g,y,_)}sendSignInLinkToEmail(a,c){return function tn(h,o,a){return(kt=kt||(0,I.Z)(function*(c,f,g){var y;const _=Ue(c),A={requestType:"EMAIL_SIGNIN",email:f,clientType:"CLIENT_TYPE_WEB"};function b(G,Z){F(Z.handleCodeInApp,_,"argument-error"),Z&&gr(_,G,Z)}if(null!==(y=_._getRecaptchaConfig())&&void 0!==y&&y.emailPasswordEnabled){const G=yield Zt(_,A,"getOobCode",!0);b(G,g),yield jr(_,G)}else{var K;b(A,g),yield jr(_,A).catch(function(G){return(K=K||(0,I.Z)(function*(Z){if("auth/missing-recaptcha-token"!==Z.code)return Promise.reject(Z);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const re=yield Zt(_,A,"getOobCode",!0);b(re,g),yield jr(_,re)}})).apply(this,arguments)})}})).apply(this,arguments)}(this._delegate,a,c)}sendPasswordResetEmail(a,c){return function bn(h,o,a){return(_n=_n||(0,I.Z)(function*(c,f,g){var y;const _=Ue(c),A={requestType:"PASSWORD_RESET",email:f,clientType:"CLIENT_TYPE_WEB"};if(null!==(y=_._getRecaptchaConfig())&&void 0!==y&&y.emailPasswordEnabled){const K=yield Zt(_,A,"getOobCode",!0);g&&gr(_,K,g),yield So(_,K)}else{var b;g&&gr(_,A,g),yield So(_,A).catch(function(K){return(b=b||(0,I.Z)(function*(G){if("auth/missing-recaptcha-token"!==G.code)return Promise.reject(G);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const Z=yield Zt(_,A,"getOobCode",!0);g&&gr(_,Z,g),yield So(_,Z)}})).apply(this,arguments)})}})).apply(this,arguments)}(this._delegate,a,c||void 0)}setPersistence(a){var c=this;return(0,I.Z)(function*(){let f;switch(function yl(h,o){Tr(Object.values(vt).includes(o),h,"invalid-persistence-type"),(0,O.b$)()?Tr(o!==vt.SESSION,h,"unsupported-persistence-type"):(0,O.UG)()?Tr(o===vt.NONE,h,"unsupported-persistence-type"):ru()?Tr(o===vt.NONE||o===vt.LOCAL&&(0,O.hl)(),h,"unsupported-persistence-type"):Tr(o===vt.NONE||nu(),h,"unsupported-persistence-type")}(c._delegate,a),a){case vt.SESSION:f=jn;break;case vt.LOCAL:f=(yield Pe(j)._isAvailable())?j:Ls;break;case vt.NONE:f=Gr;break;default:return De("argument-error",{appName:c._delegate.name})}return c._delegate.setPersistence(f)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return At(this._delegate,function fc(h){return(J=J||(0,I.Z)(function*(o){var a;const c=Ue(o);if(yield c._initializationPromise,null!==(a=c.currentUser)&&void 0!==a&&a.isAnonymous)return new Ht({user:c.currentUser,providerId:null,operationType:"signIn"});const f=yield Oi(c,{returnSecureToken:!0}),g=yield Ht._fromIdTokenResponse(c,"signIn",f,!0);return yield c._updateCurrentUser(g.user),g})).apply(this,arguments)}(this._delegate))}signInWithCredential(a){return At(this._delegate,Ds(this._delegate,a))}signInWithCustomToken(a){return At(this._delegate,function hn(h,o){return(en=en||(0,I.Z)(function*(a,c){const f=Ue(a),g=yield function gh(h,o){return(It=It||(0,I.Z)(function*(a,c){return Wt(a,"POST","/v1/accounts:signInWithCustomToken",Te(a,c))})).apply(this,arguments)}(f,{token:c,returnSecureToken:!0}),y=yield Ht._fromIdTokenResponse(f,"signIn",g);return yield f._updateCurrentUser(y.user),y})).apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,c){return At(this._delegate,function $n(h,o,a){return Ds((0,O.m9)(h),Kr.credential(o,a))}(this._delegate,a,c))}signInWithEmailLink(a,c){return At(this._delegate,function ko(h,o,a){return(ls=ls||(0,I.Z)(function*(c,f,g){const y=(0,O.m9)(c),_=Kr.credentialWithLink(f,g||Br());return F(_._tenantId===(y.tenantId||null),y,"tenant-id-mismatch"),Ds(y,_)})).apply(this,arguments)}(this._delegate,a,c))}signInWithPhoneNumber(a,c){return Qi(this._delegate,function Oe(h,o,a){return(co=co||(0,I.Z)(function*(c,f,g){const y=Ue(c),_=yield oe(y,f,(0,O.m9)(g));return new Fo(_,A=>Ds(y,A))})).apply(this,arguments)}(this._delegate,a,c))}signInWithPopup(a){var c=this;return(0,I.Z)(function*(){return ri(iu(),c._delegate,"operation-not-supported-in-this-environment"),At(c._delegate,function Vs(h,o,a){return(Or=Or||(0,I.Z)(function*(c,f,g){const y=Ue(c);Vn(c,f,Cn);const _=V(y,g);return new Nt(y,"signInViaPopup",f,_).executeNotNull()})).apply(this,arguments)}(c._delegate,a,Xn))})()}signInWithRedirect(a){var c=this;return(0,I.Z)(function*(){return ri(iu(),c._delegate,"operation-not-supported-in-this-environment"),yield Qo(c._delegate),function vr(h,o,a){return function qh(h,o,a){return(Ii=Ii||(0,I.Z)(function*(c,f,g){const y=Ue(c);Vn(c,f,Cn),yield y._initializationPromise;const _=V(y,g);return yield x(_,y),_._openRedirect(y,f,"signInViaRedirect")})).apply(this,arguments)}(h,o,a)}(c._delegate,a,Xn)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function Fa(h,o){return(we=we||(0,I.Z)(function*(a,c){const{data:f}=yield Hr((0,O.m9)(a),c);return f.email})).apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return h.Persistence=vt,h})();function uu(h,o,a){let c=h;"function"!=typeof h&&({next:c,error:o,complete:a}=h);const f=c;return{next:y=>f(y&&Rn.getOrCreate(y)),error:o,complete:a}}function vl(h,o){const a=function Yn(h,o){const a=ou();if(!a)return[];const c=Sn(js,h,o);switch(a.getItem(c)){case vt.NONE:return[Gr];case vt.LOCAL:return[j,jn];case vt.SESSION:return[jn];default:return[]}}(h,o);if(typeof self<"u"&&!a.includes(j)&&a.push(j),typeof window<"u")for(const c of[Ls,jn])a.includes(c)||a.push(c);return a.includes(Gr)||a.push(Gr),a}class cu{constructor(){this.providerId="phone",this._delegate=new Ae(Yo(_t.Z.auth()))}static credential(o,a){return Ae.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}cu.PHONE_SIGN_IN_METHOD=Ae.PHONE_SIGN_IN_METHOD,cu.PROVIDER_ID=Ae.PROVIDER_ID;const Jn=F;class fd{constructor(o,a,c=_t.Z.app()){var f;Jn(null===(f=c.options)||void 0===f?void 0:f.apiKey,"invalid-api-key",{appName:c.name}),this._delegate=new ee(o,a,c.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function _l(h){h.INTERNAL.registerComponent(new et.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),c=o.getProvider("auth");return new Yi(a,c)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Kr,FacebookAuthProvider:Da,GithubAuthProvider:lc,GoogleAuthProvider:xs,OAuthProvider:zn,SAMLAuthProvider:Cs,PhoneAuthProvider:cu,PhoneMultiFactorGenerator:Ut,RecaptchaVerifier:fd,TwitterAuthProvider:xo,Auth:Yi,AuthCredential:Ri,Error:O.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),h.registerVersion("@firebase/auth-compat","0.4.2")}(_t.Z)}}]);